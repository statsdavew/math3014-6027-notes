<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Blocking | MATH3014-6027 Design (and Analysis) of Experiments</title>
  <meta name="description" content="Lecture notes for the modules MATH3014 and MATH6027 at the University of Southampton" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Blocking | MATH3014-6027 Design (and Analysis) of Experiments" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Lecture notes for the modules MATH3014 and MATH6027 at the University of Southampton" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Blocking | MATH3014-6027 Design (and Analysis) of Experiments" />
  
  <meta name="twitter:description" content="Lecture notes for the modules MATH3014 and MATH6027 at the University of Southampton" />
  

<meta name="author" content="Dave Woods" />


<meta name="date" content="2022-02-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="crd.html"/>
<link rel="next" href="factorial.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">MATH3014-6027</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Motivation, introduction and revision</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#motivation"><i class="fa fa-check"></i><b>1.1</b> Motivation</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#aims-of-experimentation-and-some-examples"><i class="fa fa-check"></i><b>1.2</b> Aims of experimentation and some examples</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#some-definitions"><i class="fa fa-check"></i><b>1.3</b> Some definitions</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#principles"><i class="fa fa-check"></i><b>1.4</b> Principles of experimentation</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="intro.html"><a href="intro.html#replication"><i class="fa fa-check"></i><b>1.4.1</b> Replication</a></li>
<li class="chapter" data-level="1.4.2" data-path="intro.html"><a href="intro.html#randomisation"><i class="fa fa-check"></i><b>1.4.2</b> Randomisation</a></li>
<li class="chapter" data-level="1.4.3" data-path="intro.html"><a href="intro.html#intro-blocking"><i class="fa fa-check"></i><b>1.4.3</b> Stratification (or blocking)</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#lin-model-rev"><i class="fa fa-check"></i><b>1.5</b> Revision on the linear model</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="intro.html"><a href="intro.html#variance-of-a-predictionfitted-value"><i class="fa fa-check"></i><b>1.5.1</b> Variance of a Prediction/Fitted Value</a></li>
<li class="chapter" data-level="1.5.2" data-path="intro.html"><a href="intro.html#analysis-of-variance-and-r2-as-model-comparison"><i class="fa fa-check"></i><b>1.5.2</b> Analysis of Variance and R<span class="math inline">\(^{2}\)</span> as Model Comparison</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#exercises"><i class="fa fa-check"></i><b>1.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="crd.html"><a href="crd.html"><i class="fa fa-check"></i><b>2</b> Completely randomised designs</a>
<ul>
<li class="chapter" data-level="2.1" data-path="crd.html"><a href="crd.html#a-unit-treatment-linear-model"><i class="fa fa-check"></i><b>2.1</b> A unit-treatment linear model</a></li>
<li class="chapter" data-level="2.2" data-path="crd.html"><a href="crd.html#the-partitioned-linear-model"><i class="fa fa-check"></i><b>2.2</b> The partitioned linear model</a></li>
<li class="chapter" data-level="2.3" data-path="crd.html"><a href="crd.html#reduced-normal-equations-for-the-crd"><i class="fa fa-check"></i><b>2.3</b> Reduced normal equations for the CRD</a></li>
<li class="chapter" data-level="2.4" data-path="crd.html"><a href="crd.html#contrasts"><i class="fa fa-check"></i><b>2.4</b> Contrasts</a></li>
<li class="chapter" data-level="2.5" data-path="crd.html"><a href="crd.html#contrast-crd"><i class="fa fa-check"></i><b>2.5</b> Treatment contrast estimators in the CRD</a></li>
<li class="chapter" data-level="2.6" data-path="crd.html"><a href="crd.html#r-crd"><i class="fa fa-check"></i><b>2.6</b> Analysing CRDs in R</a></li>
<li class="chapter" data-level="2.7" data-path="crd.html"><a href="crd.html#multiple-comp"><i class="fa fa-check"></i><b>2.7</b> Multiple comparisons</a></li>
<li class="chapter" data-level="2.8" data-path="crd.html"><a href="crd.html#impact-of-design-choices-on-estimation"><i class="fa fa-check"></i><b>2.8</b> Impact of design choices on estimation</a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="crd.html"><a href="crd.html#crd-opt-all"><i class="fa fa-check"></i><b>2.8.1</b> Optimal treatment allocation</a></li>
<li class="chapter" data-level="2.8.2" data-path="crd.html"><a href="crd.html#crd-size"><i class="fa fa-check"></i><b>2.8.2</b> Overall size of the experiment</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="crd.html"><a href="crd.html#exercises-1"><i class="fa fa-check"></i><b>2.9</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="blocking.html"><a href="blocking.html"><i class="fa fa-check"></i><b>3</b> Blocking</a>
<ul>
<li class="chapter" data-level="3.1" data-path="blocking.html"><a href="blocking.html#unit-block-treatment-model"><i class="fa fa-check"></i><b>3.1</b> Unit-block-treatment model</a></li>
<li class="chapter" data-level="3.2" data-path="blocking.html"><a href="blocking.html#normal-equations"><i class="fa fa-check"></i><b>3.2</b> Normal equations</a></li>
<li class="chapter" data-level="3.3" data-path="blocking.html"><a href="blocking.html#analysis-of-variance"><i class="fa fa-check"></i><b>3.3</b> Analysis of variance</a></li>
<li class="chapter" data-level="3.4" data-path="blocking.html"><a href="blocking.html#rcdb"><i class="fa fa-check"></i><b>3.4</b> Randomised complete block designs</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="factorial.html"><a href="factorial.html"><i class="fa fa-check"></i><b>4</b> Factorial experiments</a></li>
<li class="chapter" data-level="5" data-path="block-factorial.html"><a href="block-factorial.html"><i class="fa fa-check"></i><b>5</b> Blocking in factorial designs</a></li>
<li class="chapter" data-level="6" data-path="fractional-factorial.html"><a href="fractional-factorial.html"><i class="fa fa-check"></i><b>6</b> Fractional factorial designs</a></li>
<li class="chapter" data-level="7" data-path="response-surface-methodology.html"><a href="response-surface-methodology.html"><i class="fa fa-check"></i><b>7</b> Response surface methodology</a></li>
<li class="chapter" data-level="8" data-path="optimal-design-of-experiments.html"><a href="optimal-design-of-experiments.html"><i class="fa fa-check"></i><b>8</b> Optimal design of experiments</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MATH3014-6027 Design (and Analysis) of Experiments</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="blocking" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Blocking</h1>
<p>The completely randomised design (CRD) works well when there is sufficient homogeneous experimental units to perform the whole experiment under the same, or very similar, conditions and there are no restrictions on the randomisation of treatments to units. The only systematic (non-random) differences in the observed responses result from differences between the treatments. While such designs are commonly and successfully used, especially in smaller experiments, their application can often be unrealistic or impractical in many settings.</p>
<p>A common way in which the CRD fails is a lack of sufficiently similar experimental units. If there are systemtic differences between different batches, or <strong>blocks</strong> of units, these differences should be taken into account in both the allocation of treatments to units and the modelling of the resultant data. Otherwise, block-to-block differences may bias treatment comparisons and/or inflate our estimate of the background variability and hence reduce our ability to detect important treatment effects.</p>
<div class="example">
<p><span id="exm:blocks-bars" class="example"><strong>Example 3.1  </strong></span>Steel bar experiment <span class="citation">(<a href="#ref-Morris2011" role="doc-biblioref">Morris, 2011</a>, ch. 4)</span></p>
<p><span class="citation"><a href="#ref-KSN2005" role="doc-biblioref">Kocaoz <em>et al.</em></a> (<a href="#ref-KSN2005" role="doc-biblioref">2005</a>)</span> described an experiment to assess the strength of steel reinforcement bars from <span class="math inline">\(t=4\)</span> coatings<a href="#fn18" class="footnote-ref" id="fnref18"><sup>18</sup></a> (treatments). In total <span class="math inline">\(n=32\)</span> different bars (units) were available, but the testing process meant sets of four bars were tested together. To account for potential test-specific features (e.g. environmental or operational), these different test sets were assumed to form <span class="math inline">\(b=8\)</span> blocks of size <span class="math inline">\(k=4\)</span>. The data are shown in Table <a href="blocking.html#tab:bar-expt-data">3.1</a> below.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="blocking.html#cb58-1" aria-hidden="true" tabindex="-1"></a>bar <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">coating =</span> <span class="fu">rep</span>(<span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>), <span class="dv">8</span>),</span>
<span id="cb58-2"><a href="blocking.html#cb58-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">block =</span> <span class="fu">rep</span>(<span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>), <span class="fu">rep</span>(<span class="dv">4</span>, <span class="dv">8</span>)), </span>
<span id="cb58-3"><a href="blocking.html#cb58-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">strength =</span> <span class="fu">c</span>(<span class="dv">136</span>, <span class="dv">147</span>, <span class="dv">138</span>, <span class="dv">149</span>, <span class="dv">136</span>, <span class="dv">143</span>, <span class="dv">122</span>, <span class="dv">153</span>, <span class="dv">150</span>, <span class="dv">142</span>, <span class="dv">131</span>, <span class="dv">136</span>,</span>
<span id="cb58-4"><a href="blocking.html#cb58-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="dv">155</span>, <span class="dv">148</span>, <span class="dv">130</span>, <span class="dv">129</span>, <span class="dv">145</span>, <span class="dv">149</span>, <span class="dv">136</span>, <span class="dv">139</span>, <span class="dv">150</span>, <span class="dv">149</span>, <span class="dv">147</span>, <span class="dv">144</span>,</span>
<span id="cb58-5"><a href="blocking.html#cb58-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="dv">147</span>, <span class="dv">150</span>, <span class="dv">125</span>, <span class="dv">140</span>, <span class="dv">148</span>, <span class="dv">149</span>, <span class="dv">118</span>, <span class="dv">145</span>)</span>
<span id="cb58-6"><a href="blocking.html#cb58-6" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb58-7"><a href="blocking.html#cb58-7" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb58-8"><a href="blocking.html#cb58-8" aria-hidden="true" tabindex="-1"></a> tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(bar, <span class="at">names_from =</span> coating, <span class="at">values_from =</span> strength),</span>
<span id="cb58-9"><a href="blocking.html#cb58-9" aria-hidden="true" tabindex="-1"></a> <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Block&quot;</span>, <span class="fu">paste</span>(<span class="st">&quot;Coating&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)),</span>
<span id="cb58-10"><a href="blocking.html#cb58-10" aria-hidden="true" tabindex="-1"></a> <span class="at">caption =</span> <span class="st">&quot;Steel bar experiment: tensile strength values (kliograms per square inch, ksi) from steel bars with four different coatings.&quot;</span></span>
<span id="cb58-11"><a href="blocking.html#cb58-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<table>
<caption><span id="tab:bar-expt-data">Table 3.1: </span>Steel bar experiment: tensile strength values (kliograms per square inch, ksi) from steel bars with four different coatings.</caption>
<thead>
<tr class="header">
<th align="left">Block</th>
<th align="right">Coating 1</th>
<th align="right">Coating 2</th>
<th align="right">Coating 3</th>
<th align="right">Coating 4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">136</td>
<td align="right">147</td>
<td align="right">138</td>
<td align="right">149</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">136</td>
<td align="right">143</td>
<td align="right">122</td>
<td align="right">153</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">150</td>
<td align="right">142</td>
<td align="right">131</td>
<td align="right">136</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="right">155</td>
<td align="right">148</td>
<td align="right">130</td>
<td align="right">129</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="right">145</td>
<td align="right">149</td>
<td align="right">136</td>
<td align="right">139</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="right">150</td>
<td align="right">149</td>
<td align="right">147</td>
<td align="right">144</td>
</tr>
<tr class="odd">
<td align="left">7</td>
<td align="right">147</td>
<td align="right">150</td>
<td align="right">125</td>
<td align="right">140</td>
</tr>
<tr class="even">
<td align="left">8</td>
<td align="right">148</td>
<td align="right">149</td>
<td align="right">118</td>
<td align="right">145</td>
</tr>
</tbody>
</table>
<p>Here, each block has size 4, which is equal to the number of treatments in the experiment, and each treatment is applied in each block. This is an example of a <strong>randomised complete block design</strong>.</p>
<p>We can study the data graphically, plotting by treatment and by block.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="blocking.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(strength <span class="sc">~</span> block, <span class="at">data =</span> bar)</span>
<span id="cb59-2"><a href="blocking.html#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(strength <span class="sc">~</span> coating, <span class="at">data =</span> bar)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:bar-expt-boxplots"></span>
<img src="bookdown_math3014-6027_files/figure-html/bar-expt-boxplots-1.png" alt="Steel bar experiment: distributions of tensile strength (ksi) from the eight blocks (top) and the four coatings (bottom)." width="672" /><img src="bookdown_math3014-6027_files/figure-html/bar-expt-boxplots-2.png" alt="Steel bar experiment: distributions of tensile strength (ksi) from the eight blocks (top) and the four coatings (bottom)." width="672" />
<p class="caption">
Figure 3.1: Steel bar experiment: distributions of tensile strength (ksi) from the eight blocks (top) and the four coatings (bottom).
</p>
</div>
<p>The box plots within each plot in Figure <a href="blocking.html#fig:bar-expt-boxplots">3.1</a> are comparable, as every treatment has occured with every block the same number of times (once). For example, when we compare the box plots for treatments 1 and 3, we know each of then display one observation from each block. Therefore, differences between treatments will not be influenced by large differences between blocks. This <strong>balance</strong> makes our analysis more straighforward. By eye, it appears here there may be differences between both coating 3 and the other three coatings.</p>
</div>
<div class="example">
<p><span id="exm:blocks-tyres" class="example"><strong>Example 3.2  </strong></span>Tyre experiment <span class="citation">(<a href="#ref-WH2009" role="doc-biblioref">Wu and Hamada, 2009</a>, ch. 3)</span></p>
<p><span class="citation"><a href="#ref-Davies1954" role="doc-biblioref">Davies</a> (<a href="#ref-Davies1954" role="doc-biblioref">1954</a>)</span>, p.200, examined the effect of <span class="math inline">\(t=4\)</span> different rubber compounds (treatments) on the lifetime of a tyre. Each tyre is only large enough to split into <span class="math inline">\(k=3\)</span> segments whilst still containing a representative amount of each compound. When tested, each tyre is subjected to the same road conditions, and hence is treated as a block. A design with <span class="math inline">\(b=4\)</span> blocks was used, as displayed in Table <a href="blocking.html#tab:tyre-expt-data">3.2</a>.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="blocking.html#cb60-1" aria-hidden="true" tabindex="-1"></a>tyre <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">compound =</span> <span class="fu">as.factor</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)),</span>
<span id="cb60-2"><a href="blocking.html#cb60-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">block =</span> <span class="fu">rep</span>(<span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>), <span class="fu">rep</span>(<span class="dv">3</span>, <span class="dv">4</span>)), </span>
<span id="cb60-3"><a href="blocking.html#cb60-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">wear =</span> <span class="fu">c</span>(<span class="dv">238</span>, <span class="dv">238</span>, <span class="dv">279</span>, <span class="dv">196</span>, <span class="dv">213</span>, <span class="dv">308</span>, <span class="dv">254</span>, <span class="dv">334</span>, <span class="dv">367</span>, <span class="dv">312</span>, <span class="dv">421</span>, <span class="dv">412</span>)</span>
<span id="cb60-4"><a href="blocking.html#cb60-4" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb60-5"><a href="blocking.html#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">knitr.kable.NA =</span> <span class="st">&#39;&#39;</span>)</span>
<span id="cb60-6"><a href="blocking.html#cb60-6" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb60-7"><a href="blocking.html#cb60-7" aria-hidden="true" tabindex="-1"></a> tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(tyre, <span class="at">names_from =</span> compound, <span class="at">values_from =</span> wear),</span>
<span id="cb60-8"><a href="blocking.html#cb60-8" aria-hidden="true" tabindex="-1"></a> <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Block&quot;</span>, <span class="fu">paste</span>(<span class="st">&quot;Compound&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)),</span>
<span id="cb60-9"><a href="blocking.html#cb60-9" aria-hidden="true" tabindex="-1"></a> <span class="at">caption =</span> <span class="st">&quot;Tyre experiment: relative wear measurements (unitless) from tires made with four different rubber compounds.&quot;</span></span>
<span id="cb60-10"><a href="blocking.html#cb60-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<table>
<caption><span id="tab:tyre-expt-data">Table 3.2: </span>Tyre experiment: relative wear measurements (unitless) from tires made with four different rubber compounds.</caption>
<thead>
<tr class="header">
<th align="left">Block</th>
<th align="right">Compound 1</th>
<th align="right">Compound 2</th>
<th align="right">Compound 3</th>
<th align="right">Compound 4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">238</td>
<td align="right">238</td>
<td align="right">279</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">196</td>
<td align="right">213</td>
<td align="right"></td>
<td align="right">308</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">254</td>
<td align="right"></td>
<td align="right">334</td>
<td align="right">367</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="right"></td>
<td align="right">312</td>
<td align="right">421</td>
<td align="right">412</td>
</tr>
</tbody>
</table>
<p>Here, each block has size <span class="math inline">\(k=3\)</span>, which is smaller than the number of treatments (<span class="math inline">\(t=4\)</span>). Hence, each block cannot contain an application of each treatment. This is an example of an <strong>incomplete block design</strong>.</p>
<p>Graphical exploration of the data is a little more problematic in this example. As each treatment does not occur in each block, box plots such as Figure <a href="blocking.html#fig:tyre-expt-boxplots">3.2</a> are not as informative. Do compounds three and four have higher average wear because they were the only compounds to both occur in blocks 3 and 4? Or do blocks 3 and 4 have a higher mean because they contain both compounds 3 and 4? The design cannot help us entirely disentangle the impact of blocks and treatments<a href="#fn19" class="footnote-ref" id="fnref19"><sup>19</sup></a>. In our modelling, we will assume variation should first be described by blocks (which are generally fixed aspects of the experiment) and then treatments (which are more directly under the experimenter’s control).</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="blocking.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(wear <span class="sc">~</span> block, <span class="at">data =</span> tyre)</span>
<span id="cb61-2"><a href="blocking.html#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(wear <span class="sc">~</span> compound, <span class="at">data =</span> tyre)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:tyre-expt-boxplots"></span>
<img src="bookdown_math3014-6027_files/figure-html/tyre-expt-boxplots-1.png" alt="Tyre experiment: distributions of wear from the four blocks (top) and the four compounds (bottom)." width="672" /><img src="bookdown_math3014-6027_files/figure-html/tyre-expt-boxplots-2.png" alt="Tyre experiment: distributions of wear from the four blocks (top) and the four compounds (bottom)." width="672" />
<p class="caption">
Figure 3.2: Tyre experiment: distributions of wear from the four blocks (top) and the four compounds (bottom).
</p>
</div>
</div>
<div id="unit-block-treatment-model" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Unit-block-treatment model</h2>
<p>If <span class="math inline">\(n_{ij}\)</span> is the number of times treatment <span class="math inline">\(j\)</span> occurs in block <span class="math inline">\(i\)</span>, a common statistical model to describe data from a blocked experiment has the form</p>
<p><span class="math display" id="eq:block-model">\[\begin{equation}
y_{ijl} = \mu + \beta_i + \tau_i + \varepsilon_{ijl}\,, \qquad i = 1,\ldots, b; j = 1, \ldots, t; l = 1,\ldots,n_{ij}\,,
\tag{3.1}
\end{equation}\]</span>
where <span class="math inline">\(y_{ijl}\)</span> is the response from the <span class="math inline">\(l\)</span>th application of the <span class="math inline">\(j\)</span>th treatment in the <span class="math inline">\(i\)</span>th block, <span class="math inline">\(\mu\)</span> is a constant parameter, <span class="math inline">\(\beta_i\)</span> is the effect of the <span class="math inline">\(i\)</span>th block, <span class="math inline">\(\tau_j\)</span> is the effect of treatment <span class="math inline">\(j\)</span>, and <span class="math inline">\(\varepsilon_{ijl}\sim N(0, \sigma^2)\)</span> are once again random individual effects from each experimental unit, assumed independent. The total number of runs in the experiment is given by <span class="math inline">\(n = \sum_{i=1}^b\sum_{j=1}^t n_{ij}\)</span>.</p>
<p>For Example <a href="blocking.html#exm:blocks-bars">3.1</a>, there are <span class="math inline">\(t=4\)</span> experiments, <span class="math inline">\(b = 8\)</span> blocks and each treatment occurs once in each block, so <span class="math inline">\(n_{ij} = 1\)</span> for all <span class="math inline">\(i, j\)</span>. In Example <a href="blocking.html#exm:blocks-tyres">3.2</a>, there are again <span class="math inline">\(t=4\)</span> treatments but now only <span class="math inline">\(b=4\)</span> blocks and not every treatment occurs in every block. In fact, we have <span class="math inline">\(n_{11} = n_{12} = n_{13} = 1\)</span>, <span class="math inline">\(n_{14} = 0\)</span>, <span class="math inline">\(n_{21} = n_{22} =n_{24} = 1\)</span>, <span class="math inline">\(n_{23} = 0\)</span>, <span class="math inline">\(n_{31} = n_{33} =n_{34} = 1\)</span>, <span class="math inline">\(n_{32} = 0\)</span>, <span class="math inline">\(n_{41} = 0\)</span> and <span class="math inline">\(n_{42} = n_{43} =n_{44} = 1\)</span>.</p>
<p>Writing model <a href="blocking.html#eq:block-model">(3.1)</a> is matrix form as a partitioned linear model, we obtain</p>
<p><span class="math display" id="eq:block-plm">\[\begin{equation}
\boldsymbol{y}= \mu\boldsymbol{1}_n + X_1\boldsymbol{\beta} + X_2\boldsymbol{\tau} + \boldsymbol{\varepsilon}\,,
\tag{3.2}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\boldsymbol{y}\)</span> the <span class="math inline">\(n\)</span>-vector of responses, <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span> <span class="math inline">\(n\times b\)</span> and <span class="math inline">\(n\times t\)</span> model matrices for blocks and treatments, respectively, <span class="math inline">\(\boldsymbol{\beta} = (\beta_1,\ldots, \beta_b)^{\mathrm{T}}\)</span>, <span class="math inline">\(\boldsymbol{\tau} = (\tau_1,\ldots, \tau_t)^{\mathrm{T}}\)</span> and <span class="math inline">\(\boldsymbol{\varepsilon}\)</span> the <span class="math inline">\(n\)</span>-vector of errors.</p>
<p>In equation<a href="blocking.html#eq:block-plm">(3.2)</a>, assuming without loss of generality that runs of the experiment are ordered by block, the matrix <span class="math inline">\(X_1\)</span> has the form</p>
<p><span class="math display">\[
X_1 = \bigoplus_{i = 1}^b \boldsymbol{1}_{k_i} = \begin{bmatrix}
\boldsymbol{1}_{k_1} &amp; \boldsymbol{0}_{k_1} &amp; \cdots &amp;  \boldsymbol{0}_{k_1} \\
\boldsymbol{0}_{k_2} &amp; \boldsymbol{1}_{k_2} &amp; \cdots &amp;  \boldsymbol{0}_{k_2} \\
\vdots &amp; &amp; \ddots &amp; \vdots \\
\boldsymbol{0}_{k_b} &amp; \boldsymbol{0}_{k_b} &amp; \cdots &amp;  \boldsymbol{1}_{k_b} \\
\end{bmatrix}\,,
\]</span>
where <span class="math inline">\(k_i = \sum_{j=1}^t n_{ij}\)</span>, the number of units in the <span class="math inline">\(i\)</span>th block. The structure of matrix <span class="math inline">\(X_2\)</span> is harder to describe so distinctly, but each row includes a single non-zero entry, equal to one, indicating which treatment was applied in that run of the experiment. The first <span class="math inline">\(k_1\)</span> rows correspond to block 1, the second <span class="math inline">\(k_2\)</span> to block 2, and so on. We will see special cases later.</p>
</div>
<div id="normal-equations" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Normal equations</h2>
<p>Writing as a partitioned model <span class="math inline">\(\boldsymbol{y}= W\boldsymbol{\alpha} + \boldsymbol{\varepsilon}\)</span>, with <span class="math inline">\(W = [\boldsymbol{1} | X_1 | X_2]\)</span> and <span class="math inline">\(\boldsymbol{\alpha}^{\mathrm{T}} = [\mu | \boldsymbol{\beta}^{\mathrm{T}} | \boldsymbol{\tau}^{\mathrm{T}}]\)</span>, the least squares normal equations</p>
<p><span class="math display" id="eq:bne">\[\begin{equation}
W^{\mathrm{T}}W \hat{\boldsymbol{\alpha}} = W^{\mathrm{T}}\boldsymbol{y}
\tag{3.3}
\end{equation}\]</span></p>
<p>can be written as a set of three matrix equations:</p>
<p><span class="math display">\[\begin{align}
n\hat{\mu} + \boldsymbol{1}_n^{\mathrm{T}}X_1\hat{\boldsymbol{\beta}} + \boldsymbol{1}_n^{\mathrm{T}}X_2\hat{\boldsymbol{\tau}} &amp; = \boldsymbol{1}_n^{\mathrm{T}}\boldsymbol{y}\,, \\
X_1^{\mathrm{T}}\boldsymbol{1}_n\hat{\mu} + X_1^{\mathrm{T}}X_1\hat{\boldsymbol{\beta}} + X_1^{\mathrm{T}}X_2\hat{\boldsymbol{\tau}} &amp; = X_1^{\mathrm{T}}\boldsymbol{y}\,, \\
X_2^{\mathrm{T}}\boldsymbol{1}_n\hat{\mu} + X_2^{\mathrm{T}}X_1\hat{\boldsymbol{\beta}} + X_2^{\mathrm{T}}X_2\hat{\boldsymbol{\tau}} &amp; = X_2^{\mathrm{T}}\boldsymbol{y}\,. \\
\end{align}\]</span></p>
<p>Above, the matrices <span class="math inline">\(X_1^{\mathrm{T}}X_1 = \mathrm{diag}(k_1,\ldots,k_b)\)</span> and <span class="math inline">\(X_2^{\mathrm{T}}X_2 = \mathrm{diag}(n_1,\ldots,n_t)\)</span> have simple forms as diagonal matrices with entries equal to the size of each block and the number of replications of each treatment, respectively.</p>
<p>The <span class="math inline">\(t\times b\)</span> matrix <span class="math inline">\(N = X_2^{\mathcal{T}}X_1\)</span> is particularly important in block designs, and is called the <strong>incidence</strong> matrix. Each of the <span class="math inline">\(i\)</span>th row of <span class="math inline">\(N\)</span> indicates in which blocks the <span class="math inline">\(i\)</span>th treatment occurs.</p>
<p>We can eliminate the explicit dependence on <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\boldsymbol{\beta}\)</span> to find reduced normal equations for <span class="math inline">\(\boldsymbol{\tau}\)</span> by multiplying the middle equation by <span class="math inline">\(X_2^{\mathrm{T}}X_1(X_1^{\mathrm{T}}X_1)^{-1}\)</span>:</p>
<p><span class="math display">\[\begin{multline}
X_2^{\mathrm{T}}X_1(X_1^{\mathrm{T}}X_1)^{-1}X_1^{\mathrm{T}}\boldsymbol{1}_n\hat{\mu} + X_2^{\mathrm{T}}X_1(X_1^{\mathrm{T}}X_1)^{-1}X_1^{\mathrm{T}}X_1\hat{\boldsymbol{\beta}} + X_2^{\mathrm{T}}X_1(X_1^{\mathrm{T}}X_1)^{-1}X_1^{\mathrm{T}}X_2\hat{\boldsymbol{\tau}} \\
 = X_2^{\mathrm{T}}X_1(X_1^{\mathrm{T}}X_1)^{-1}X_1^{\mathrm{T}}\boldsymbol{1}_n\hat{\mu} + X_2^{\mathrm{T}}X_1\hat{\boldsymbol{\beta}} + X_2^{\mathrm{T}}X_1(X_1^{\mathrm{T}}X_1)^{-1}X_1^{\mathrm{T}}X_2\hat{\boldsymbol{\tau}} \\
 = X_2^{\mathrm{T}}X_1(X_1^{\mathrm{T}}X_1)^{-1}X_1^{\mathrm{T}}\boldsymbol{y}\\
\end{multline}\]</span></p>
<p>and subtracting from the final equation:</p>
<p><span class="math display">\[\begin{multline}
X_2^{\mathrm{T}}\left(\boldsymbol{1}_n - X_1(X_1^{\mathrm{T}}X_1)^{-1}X_1^{\mathrm{T}}\boldsymbol{1}_n\right)\hat{\mu} + \left(X_2^{\mathrm{T}}X_1 - X_2^{\mathrm{T}}X_1\right)\boldsymbol{\beta} \\ + X_2^{\mathrm{T}}\left(I_n - X_1(X_1^{\mathrm{T}}X_1)^{-1}X_1^{\mathrm{T}}\right)X_2\boldsymbol{\tau}\\
= X_2^{\mathrm{T}}\left(I_n - X_1(X_1^{\mathrm{T}}X_1)^{-1}X_1^{\mathrm{T}}\right)\boldsymbol{y}\,.
\end{multline}\]</span>
Clearly, a zero matrix is multiplying the block effects <span class="math inline">\(\boldsymbol{\beta}\)</span>. Also,</p>
<p><span class="math display">\[
X_1(X_1^{\mathrm{T}}X_1)^{-1}X_1^{\mathrm{T}}\boldsymbol{1}_n = \boldsymbol{1}_n\,,
\]</span>
as</p>
<p><span class="math display">\[
X_1(X_1^{\mathrm{T}}X_1)^{-1} = \bigoplus_{i = 1}^b \frac{1}{k_i}\boldsymbol{1}_{k_i} = \begin{bmatrix}
\frac{1}{k_1}\boldsymbol{1}_{k_1} &amp; \boldsymbol{0}_{k_1} &amp; \cdots &amp;  \boldsymbol{0}_{k_1} \\
\boldsymbol{0}_{k_2} &amp; \frac{1}{k_2}\boldsymbol{1}_{k_2} &amp; \cdots &amp;  \boldsymbol{0}_{k_2} \\
\vdots &amp; &amp; \ddots &amp; \vdots \\
\boldsymbol{0}_{k_b} &amp; \boldsymbol{0}_{k_b} &amp; \cdots &amp;  \frac{1}{k_b}\boldsymbol{1}_{k_b} \\
\end{bmatrix}\,,
\]</span>
and hence</p>
<p><span class="math display">\[
X_1(X_1^{\mathrm{T}}X_1)^{-1}X_1^{\mathrm{T}} = \bigoplus_{i = 1}^b \frac{1}{k_i}J_{k_i} = \begin{bmatrix}
\frac{1}{k_1}J_{k_1} &amp; \boldsymbol{0}_{k_1\times k_2} &amp; \cdots &amp;  \boldsymbol{0}_{k_1\times k_b} \\
\boldsymbol{0}_{k_2\times k_1} &amp; \frac{1}{k_2}J_{k_2} &amp; \cdots &amp;  \boldsymbol{0}_{k_2\times k_b} \\
\vdots &amp; &amp; \ddots &amp; \vdots \\
\boldsymbol{0}_{k_b\times k_1} &amp; \boldsymbol{0}_{k_b\times k_2} &amp; \cdots &amp;  \frac{1}{k_b}J_{k_b} \\
\end{bmatrix}\,.
\]</span></p>
<p>Writing <span class="math inline">\(H_1 = X_1(X_1^{\mathrm{T}}X_1)^{-1}X_1^{\mathrm{T}}\)</span>, we then get the reduced normal equations for <span class="math inline">\(\boldsymbol{\tau}\)</span>:</p>
<p><span class="math display" id="eq:block-rne">\[\begin{equation}
X_2^{\mathrm{T}}\left(I_n - H_1\right)X_2\boldsymbol{\tau}= X_2^{\mathrm{T}}\left(I_n - H_1\right)\boldsymbol{y}\,.
\tag{3.4}
\end{equation}\]</span></p>
<p>We can demonstrate the form of these matrices through our two examples.</p>
<p>For Example <a href="blocking.html#exm:blocks-bars">3.1</a>:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="blocking.html#cb62-1" aria-hidden="true" tabindex="-1"></a>one <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb62-2"><a href="blocking.html#cb62-2" aria-hidden="true" tabindex="-1"></a>X1 <span class="ot">&lt;-</span> <span class="fu">kronecker</span>(<span class="fu">diag</span>(<span class="dv">1</span>, <span class="at">nrow =</span> <span class="dv">8</span>), one)</span>
<span id="cb62-3"><a href="blocking.html#cb62-3" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span>, <span class="at">nrow =</span> <span class="dv">4</span>)</span>
<span id="cb62-4"><a href="blocking.html#cb62-4" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, <span class="fu">replicate</span>(<span class="dv">8</span>, X2, <span class="at">simplify =</span> <span class="cn">FALSE</span>))</span>
<span id="cb62-5"><a href="blocking.html#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="co">#incidence matrix</span></span>
<span id="cb62-6"><a href="blocking.html#cb62-6" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">t</span>(X2) <span class="sc">%*%</span> X1</span>
<span id="cb62-7"><a href="blocking.html#cb62-7" aria-hidden="true" tabindex="-1"></a>X1tX1 <span class="ot">&lt;-</span> <span class="fu">t</span>(X1) <span class="sc">%*%</span> X1 <span class="co"># diagonal</span></span>
<span id="cb62-8"><a href="blocking.html#cb62-8" aria-hidden="true" tabindex="-1"></a>X2tX2 <span class="ot">&lt;-</span> <span class="fu">t</span>(X2) <span class="sc">%*%</span> X2 <span class="co"># diagonal</span></span>
<span id="cb62-9"><a href="blocking.html#cb62-9" aria-hidden="true" tabindex="-1"></a>H1 <span class="ot">&lt;-</span> X1 <span class="sc">%*%</span> <span class="fu">solve</span>(<span class="fu">t</span>(X1) <span class="sc">%*%</span> X1) <span class="sc">%*%</span> <span class="fu">t</span>(X1)</span>
<span id="cb62-10"><a href="blocking.html#cb62-10" aria-hidden="true" tabindex="-1"></a>ones <span class="ot">&lt;-</span> H1 <span class="sc">%*%</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">32</span>) <span class="co"># H1 times vector of 1s is also a vector of 1s</span></span>
<span id="cb62-11"><a href="blocking.html#cb62-11" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">t</span>(X2) <span class="sc">%*%</span> X2 <span class="sc">-</span> <span class="fu">t</span>(X2) <span class="sc">%*%</span> H1 <span class="sc">%*%</span> X2 <span class="co"># X2t(I - H1)X2</span></span>
<span id="cb62-12"><a href="blocking.html#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="fu">qr</span>(A)<span class="sc">$</span>rank <span class="co"># rank 3</span></span>
<span id="cb62-13"><a href="blocking.html#cb62-13" aria-hidden="true" tabindex="-1"></a>X2tH1 <span class="ot">&lt;-</span> <span class="fu">t</span>(X2) <span class="sc">%*%</span> H1 <span class="co"># adjustment to y</span></span>
<span id="cb62-14"><a href="blocking.html#cb62-14" aria-hidden="true" tabindex="-1"></a>W <span class="ot">&lt;-</span> <span class="fu">cbind</span>(ones, X1, X2) <span class="co"># overall model matrix</span></span>
<span id="cb62-15"><a href="blocking.html#cb62-15" aria-hidden="true" tabindex="-1"></a><span class="fu">qr</span>(W)<span class="sc">$</span>rank <span class="co"># rank 11 (t+b - 1)</span></span></code></pre></div>
<p>For Example <a href="blocking.html#exm:blocks-tyres">3.2</a>:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="blocking.html#cb63-1" aria-hidden="true" tabindex="-1"></a>one <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb63-2"><a href="blocking.html#cb63-2" aria-hidden="true" tabindex="-1"></a>X1 <span class="ot">&lt;-</span> <span class="fu">kronecker</span>(<span class="fu">diag</span>(<span class="dv">1</span>, <span class="at">nrow =</span> <span class="dv">4</span>), one)</span>
<span id="cb63-3"><a href="blocking.html#cb63-3" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb63-4"><a href="blocking.html#cb63-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb63-5"><a href="blocking.html#cb63-5" aria-hidden="true" tabindex="-1"></a>          <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb63-6"><a href="blocking.html#cb63-6" aria-hidden="true" tabindex="-1"></a>          <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>,</span>
<span id="cb63-7"><a href="blocking.html#cb63-7" aria-hidden="true" tabindex="-1"></a>          <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb63-8"><a href="blocking.html#cb63-8" aria-hidden="true" tabindex="-1"></a>          <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb63-9"><a href="blocking.html#cb63-9" aria-hidden="true" tabindex="-1"></a>          <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>,</span>
<span id="cb63-10"><a href="blocking.html#cb63-10" aria-hidden="true" tabindex="-1"></a>          <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb63-11"><a href="blocking.html#cb63-11" aria-hidden="true" tabindex="-1"></a>          <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>,</span>
<span id="cb63-12"><a href="blocking.html#cb63-12" aria-hidden="true" tabindex="-1"></a>          <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>,</span>
<span id="cb63-13"><a href="blocking.html#cb63-13" aria-hidden="true" tabindex="-1"></a>          <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb63-14"><a href="blocking.html#cb63-14" aria-hidden="true" tabindex="-1"></a>          <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>,</span>
<span id="cb63-15"><a href="blocking.html#cb63-15" aria-hidden="true" tabindex="-1"></a>          <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">12</span>, <span class="at">byrow =</span> T</span>
<span id="cb63-16"><a href="blocking.html#cb63-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-17"><a href="blocking.html#cb63-17" aria-hidden="true" tabindex="-1"></a><span class="co">#incidence matrix</span></span>
<span id="cb63-18"><a href="blocking.html#cb63-18" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">t</span>(X2) <span class="sc">%*%</span> X1</span>
<span id="cb63-19"><a href="blocking.html#cb63-19" aria-hidden="true" tabindex="-1"></a>X1tX1 <span class="ot">&lt;-</span> <span class="fu">t</span>(X1) <span class="sc">%*%</span> X1 <span class="co"># diagonal</span></span>
<span id="cb63-20"><a href="blocking.html#cb63-20" aria-hidden="true" tabindex="-1"></a>X2tX2 <span class="ot">&lt;-</span> <span class="fu">t</span>(X2) <span class="sc">%*%</span> X2 <span class="co"># diagonal</span></span>
<span id="cb63-21"><a href="blocking.html#cb63-21" aria-hidden="true" tabindex="-1"></a>H1 <span class="ot">&lt;-</span> X1 <span class="sc">%*%</span> <span class="fu">solve</span>(<span class="fu">t</span>(X1) <span class="sc">%*%</span> X1) <span class="sc">%*%</span> <span class="fu">t</span>(X1)</span>
<span id="cb63-22"><a href="blocking.html#cb63-22" aria-hidden="true" tabindex="-1"></a>ones <span class="ot">&lt;-</span> H1 <span class="sc">%*%</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">12</span>) <span class="co"># H1 times vector of 1s is also a vector of 1s</span></span>
<span id="cb63-23"><a href="blocking.html#cb63-23" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">t</span>(X2) <span class="sc">%*%</span> X2 <span class="sc">-</span> <span class="fu">t</span>(X2) <span class="sc">%*%</span> H1 <span class="sc">%*%</span> X2 <span class="co"># X2t(I - H1)X2</span></span>
<span id="cb63-24"><a href="blocking.html#cb63-24" aria-hidden="true" tabindex="-1"></a><span class="fu">qr</span>(A)<span class="sc">$</span>rank <span class="co"># rank 3</span></span>
<span id="cb63-25"><a href="blocking.html#cb63-25" aria-hidden="true" tabindex="-1"></a>X2tH1 <span class="ot">&lt;-</span> <span class="fu">t</span>(X2) <span class="sc">%*%</span> H1 <span class="co"># adjustment to y</span></span>
<span id="cb63-26"><a href="blocking.html#cb63-26" aria-hidden="true" tabindex="-1"></a>W <span class="ot">&lt;-</span> <span class="fu">cbind</span>(ones, X1, X2) <span class="co"># overall model matrix</span></span>
<span id="cb63-27"><a href="blocking.html#cb63-27" aria-hidden="true" tabindex="-1"></a><span class="fu">qr</span>(W)<span class="sc">$</span>rank <span class="co"># rank 7 (t+b - 1)</span></span></code></pre></div>
<p>Notice that if we write <span class="math inline">\(X_{2|1} = (I_n - H_1)X2\)</span>, then the reduced normal equations become</p>
<p><span class="math display">\[
X_{2|1}^{\mathrm{T}}X_{2|1}\boldsymbol{\tau} = X_{2|1}^{\mathrm{T}}\boldsymbol{y}\,,
\]</span>
which have the same form as the CRD in Chapter <a href="crd.html#crd">2</a> albeit with a different <span class="math inline">\(X_{2|1}\)</span> matrix as we are adjusting for more complex nuisance parameters.</p>
<p>In general, the solution of these equations will depend on the exact form of the design. For the randomised complete block design, the solution turns out to be straighforward (see Section @ref(#rcdb) below). By default, to fit model <a href="blocking.html#eq:block-plm">(3.2)</a>, the <code>lm</code> function in <code>R</code> applies the constraint <span class="math inline">\(\tau_t = \beta_b = 0\)</span>, and removes the corresponding columns from <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span>, to leave a <span class="math inline">\(W\)</span> matrix with full column rank. Clearly, this solution is not unique but, as with CRDs, we will identify uniquely estimatable combinations of the model parameters (and use <code>emmeans</code> to extract these estimates from an <code>lm</code> object).</p>
</div>
<div id="analysis-of-variance" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Analysis of variance</h2>
<p>As was the case with the CRD, it can be shown that any solution to the normal equations <a href="blocking.html#eq:bne">(3.3)</a> will produce a unique solution to <span class="math inline">\(\widehat{W\alpha}\)</span>, and hence a unique analysis of variance decomposition can be obtained.</p>
<p>For a block experiment, the ANOVA table is comparing the full model <a href="blocking.html#eq:block-plm">(3.2)</a>, the model containing the block effects</p>
<p><span class="math display" id="eq:anova-bm">\[\begin{equation}
\boldsymbol{y}= \mu\boldsymbol{1} + X_1\boldsymbol{\beta} + \boldsymbol{\varepsilon}
\tag{3.5}
\end{equation}\]</span></p>
<p>and the null model</p>
<p><span class="math display" id="eq:anova-nm">\[\begin{equation}
\boldsymbol{y}= \mu\boldsymbol{1} + \boldsymbol{\varepsilon}\,,
\tag{3.6}
\end{equation}\]</span></p>
<p>and has the form:</p>
<table>
<colgroup>
<col width="12%" />
<col width="36%" />
<col width="30%" />
<col width="22%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Source</th>
<th align="center">Degrees of freedom</th>
<th align="left">Sums of squares</th>
<th align="left">Mean square</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Blocks</td>
<td align="center"><span class="math inline">\(b-1\)</span></td>
<td align="left">RSS <a href="blocking.html#eq:anova-nm">(3.6)</a> - RSS <a href="blocking.html#eq:anova-bm">(3.5)</a></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Treatments</td>
<td align="center"><span class="math inline">\(t-1\)</span></td>
<td align="left">RSS <a href="blocking.html#eq:anova-bm">(3.5)</a> - RSS <a href="blocking.html#eq:block-plm">(3.2)</a></td>
<td align="left">[RSS <a href="blocking.html#eq:anova-bm">(3.5)</a> - RSS <a href="blocking.html#eq:block-plm">(3.2)</a>] / <span class="math inline">\((t-1)\)</span></td>
</tr>
<tr class="odd">
<td align="left">Residual</td>
<td align="center"><span class="math inline">\(n - b - t + 1\)</span></td>
<td align="left">RSS <a href="blocking.html#eq:block-plm">(3.2)</a></td>
<td align="left">RSS <a href="blocking.html#eq:block-plm">(3.2)</a> / <span class="math inline">\((n - b - t + 1)\)</span></td>
</tr>
<tr class="even">
<td align="left">Total</td>
<td align="center"><span class="math inline">\(n - 1\)</span></td>
<td align="left">RSS <a href="blocking.html#eq:anova-nm">(3.6)</a></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p>We test the hypothesis <span class="math inline">\(H_0: \tau_1 = \cdots = \tau_t = 0\)</span> at the <span class="math inline">\(100\alpha\)</span>% significance level by comparing the ratio of treatment and residual mean squares to the <span class="math inline">\(1-\alpha\)</span> quantile of an <span class="math inline">\(F\)</span> distribution with <span class="math inline">\(t-1\)</span> and <span class="math inline">\(n-b-t+1\)</span> degrees of freedom.</p>
<p>For Example <a href="blocking.html#exm:blocks-bars">3.1</a>, we obtain the following ANOVA.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="blocking.html#cb64-1" aria-hidden="true" tabindex="-1"></a>bar.lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(strength <span class="sc">~</span> block <span class="sc">+</span> coating, <span class="at">data =</span> bar)</span>
<span id="cb64-2"><a href="blocking.html#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(bar.lm)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: strength
##           Df Sum Sq Mean Sq F value Pr(&gt;F)   
## block      7    215      31    0.55 0.7903   
## coating    3   1310     437    7.75 0.0011 **
## Residuals 21   1184      56                  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Clearly, the null hypothesis of no treatment effect is rejected. The <code>anova</code> function also compares the block mean square to the residual mean square to perform a test of the hypothesis <span class="math inline">\(H_0: \beta_1 = \cdots = \beta_b = 0\)</span>. This is not a hypothesis that should usually be tested. The blocks are a nuisance factor and are generally a feature of the experimental process that has not been subject to randomisation; we are not interested in testing for block-to-block differences.<a href="#fn20" class="footnote-ref" id="fnref20"><sup>20</sup></a></p>
<p>For Example <a href="blocking.html#exm:blocks-tyres">3.2</a>, we get the ANOVA table:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="blocking.html#cb66-1" aria-hidden="true" tabindex="-1"></a>tyre.lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(wear <span class="sc">~</span> block <span class="sc">+</span> compound, <span class="at">data =</span> tyre)</span>
<span id="cb66-2"><a href="blocking.html#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(tyre.lm)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: wear
##           Df Sum Sq Mean Sq F value  Pr(&gt;F)    
## block      3  39123   13041    37.2 0.00076 ***
## compound   3  20729    6910    19.7 0.00335 ** 
## Residuals  5   1751     350                    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Again, the null hypothesis is rejected, and hence we should investigate which tyre compounds differ in their mean response.</p>
<p>The residual mean square for model <a href="blocking.html#eq:block-plm">(3.2)</a> also provides an unbiased estimate, <span class="math inline">\(s^2\)</span>, of <span class="math inline">\(\sigma^2\)</span>, the variability of the <span class="math inline">\(\varepsilon_{ijl}\)</span>, <em>assuming the unit-block-treatment model is correct</em>.</p>
</div>
<div id="rcdb" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Randomised complete block designs</h2>
<p>A randomised complete block design (RCBD) has each treatment replicated exactly once in each block, that is <span class="math inline">\(n_{ij} = 1\)</span> for <span class="math inline">\(i=1,\ldots, b; j = 1, \ldots, t\)</span>. Therefore each block has common size <span class="math inline">\(k_1=\cdots =k_b = k\)</span>. For an RCBD, the matrix <span class="math inline">\(X_{2|1}\)</span> has the form</p>
<p><span class="math display">\[\begin{align*}
X_{2|1} &amp; = (I_n - H_1)X_2 \\
&amp; = X2 - H_1X_2 \\
&amp; = X2 - \frac{1}{t}J_{n \times t}
\end{align*}\]</span></p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Davies1954" class="csl-entry">
Davies, O. L. (ed.) (1954) <em>The Design and Analysis of Industrial Experiments</em>. London: <span>Oliver and Boyd</span>.
</div>
<div id="ref-KSN2005" class="csl-entry">
Kocaoz, S., Samaranayake, V. A. and Nani, A. (2005) Tensile characterization of glass <span>FRP</span> bars. <em>Composites: Part B</em>, <strong>36</strong>, 127–134.
</div>
<div id="ref-Morris2011" class="csl-entry">
Morris, M. D. (2011) <em>Design of Experiments: An Introduction Based on Linear Models</em>. Boca Raton: <span>Chapman and Hall/CRC Press</span>.
</div>
<div id="ref-WH2009" class="csl-entry">
Wu, C. F. J. and Hamada, M. (2009) <em>Experiments: Planning, Analysis, and Parameter Design Optimization</em>. 2nd ed. New York: Wiley.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="18">
<li id="fn18"><p>Thr four coatings were all made from Engineering Thermoplastic Polyurethane (ETPU); coating one was solely made from ETPU, coatings 2-4 had additional glass fibre, carbon fibre or aramid fibre added, respectively.<a href="blocking.html#fnref18" class="footnote-back">↩︎</a></p></li>
<li id="fn19"><p>This is our first example of (partial) confounding, which we will see again in Chapters <a href="block-factorial.html#block-factorial">5</a> and <a href="fractional-factorial.html#fractional-factorial">6</a><a href="blocking.html#fnref19" class="footnote-back">↩︎</a></p></li>
<li id="fn20"><p><code>R</code> and <code>anova</code> don’t, of course, know that this is a block design or that a blocking factor is being tested.<a href="blocking.html#fnref20" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="crd.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="factorial.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown_math3014-6027.pdf", "bookdown_math3014-6027.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
