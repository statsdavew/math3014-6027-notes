<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Blocking in factorial designs | MATH3014-6027 Design (and Analysis) of Experiments</title>
  <meta name="description" content="Lecture notes for the modules MATH3014 and MATH6027 at the University of Southampton" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Blocking in factorial designs | MATH3014-6027 Design (and Analysis) of Experiments" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Lecture notes for the modules MATH3014 and MATH6027 at the University of Southampton" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Blocking in factorial designs | MATH3014-6027 Design (and Analysis) of Experiments" />
  
  <meta name="twitter:description" content="Lecture notes for the modules MATH3014 and MATH6027 at the University of Southampton" />
  

<meta name="author" content="Dave Woods" />


<meta name="date" content="2022-04-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="factorial.html"/>
<link rel="next" href="fractional-factorial.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">MATH3014-6027</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Motivation, introduction and revision</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#motivation"><i class="fa fa-check"></i><b>1.1</b> Motivation</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#aims-of-experimentation-and-some-examples"><i class="fa fa-check"></i><b>1.2</b> Aims of experimentation and some examples</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#some-definitions"><i class="fa fa-check"></i><b>1.3</b> Some definitions</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#principles"><i class="fa fa-check"></i><b>1.4</b> Principles of experimentation</a><ul>
<li class="chapter" data-level="1.4.1" data-path="intro.html"><a href="intro.html#replication"><i class="fa fa-check"></i><b>1.4.1</b> Replication</a></li>
<li class="chapter" data-level="1.4.2" data-path="intro.html"><a href="intro.html#randomisation"><i class="fa fa-check"></i><b>1.4.2</b> Randomisation</a></li>
<li class="chapter" data-level="1.4.3" data-path="intro.html"><a href="intro.html#intro-blocking"><i class="fa fa-check"></i><b>1.4.3</b> Stratification (or blocking)</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#lin-model-rev"><i class="fa fa-check"></i><b>1.5</b> Revision on the linear model</a><ul>
<li class="chapter" data-level="1.5.1" data-path="intro.html"><a href="intro.html#variance-of-a-predictionfitted-value"><i class="fa fa-check"></i><b>1.5.1</b> Variance of a Prediction/Fitted Value</a></li>
<li class="chapter" data-level="1.5.2" data-path="intro.html"><a href="intro.html#anova-revision"><i class="fa fa-check"></i><b>1.5.2</b> Analysis of Variance and R<span class="math inline">\(^{2}\)</span> as Model Comparison</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#exercises"><i class="fa fa-check"></i><b>1.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="crd.html"><a href="crd.html"><i class="fa fa-check"></i><b>2</b> Completely randomised designs</a><ul>
<li class="chapter" data-level="2.1" data-path="crd.html"><a href="crd.html#a-unit-treatment-linear-model"><i class="fa fa-check"></i><b>2.1</b> A unit-treatment linear model</a></li>
<li class="chapter" data-level="2.2" data-path="crd.html"><a href="crd.html#the-partitioned-linear-model"><i class="fa fa-check"></i><b>2.2</b> The partitioned linear model</a></li>
<li class="chapter" data-level="2.3" data-path="crd.html"><a href="crd.html#reduced-normal-equations-for-the-crd"><i class="fa fa-check"></i><b>2.3</b> Reduced normal equations for the CRD</a></li>
<li class="chapter" data-level="2.4" data-path="crd.html"><a href="crd.html#contrasts"><i class="fa fa-check"></i><b>2.4</b> Contrasts</a></li>
<li class="chapter" data-level="2.5" data-path="crd.html"><a href="crd.html#contrast-crd"><i class="fa fa-check"></i><b>2.5</b> Treatment contrast estimators in the CRD</a></li>
<li class="chapter" data-level="2.6" data-path="crd.html"><a href="crd.html#r-crd"><i class="fa fa-check"></i><b>2.6</b> Analysing CRDs in R</a></li>
<li class="chapter" data-level="2.7" data-path="crd.html"><a href="crd.html#multiple-comp"><i class="fa fa-check"></i><b>2.7</b> Multiple comparisons</a></li>
<li class="chapter" data-level="2.8" data-path="crd.html"><a href="crd.html#impact-of-design-choices-on-estimation"><i class="fa fa-check"></i><b>2.8</b> Impact of design choices on estimation</a><ul>
<li class="chapter" data-level="2.8.1" data-path="crd.html"><a href="crd.html#crd-opt-all"><i class="fa fa-check"></i><b>2.8.1</b> Optimal treatment allocation</a></li>
<li class="chapter" data-level="2.8.2" data-path="crd.html"><a href="crd.html#crd-size"><i class="fa fa-check"></i><b>2.8.2</b> Overall size of the experiment</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="crd.html"><a href="crd.html#exercises-1"><i class="fa fa-check"></i><b>2.9</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="blocking.html"><a href="blocking.html"><i class="fa fa-check"></i><b>3</b> Blocking</a><ul>
<li class="chapter" data-level="3.1" data-path="blocking.html"><a href="blocking.html#unit-block-treatment-model"><i class="fa fa-check"></i><b>3.1</b> Unit-block-treatment model</a></li>
<li class="chapter" data-level="3.2" data-path="blocking.html"><a href="blocking.html#normal-equations"><i class="fa fa-check"></i><b>3.2</b> Normal equations</a></li>
<li class="chapter" data-level="3.3" data-path="blocking.html"><a href="blocking.html#block-anova"><i class="fa fa-check"></i><b>3.3</b> Analysis of variance</a></li>
<li class="chapter" data-level="3.4" data-path="blocking.html"><a href="blocking.html#rcdb"><i class="fa fa-check"></i><b>3.4</b> Randomised complete block designs</a></li>
<li class="chapter" data-level="3.5" data-path="blocking.html"><a href="blocking.html#blocks-orthogonal"><i class="fa fa-check"></i><b>3.5</b> Orthogonal blocking</a></li>
<li class="chapter" data-level="3.6" data-path="blocking.html"><a href="blocking.html#sec-bibd"><i class="fa fa-check"></i><b>3.6</b> Balanced incomplete block designs</a><ul>
<li class="chapter" data-level="3.6.1" data-path="blocking.html"><a href="blocking.html#construction-of-bibds"><i class="fa fa-check"></i><b>3.6.1</b> Construction of BIBDs</a></li>
<li class="chapter" data-level="3.6.2" data-path="blocking.html"><a href="blocking.html#reduced-normal-equations"><i class="fa fa-check"></i><b>3.6.2</b> Reduced normal equations</a></li>
<li class="chapter" data-level="3.6.3" data-path="blocking.html"><a href="blocking.html#estimation-and-inference"><i class="fa fa-check"></i><b>3.6.3</b> Estimation and inference</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="blocking.html"><a href="blocking.html#exercises-2"><i class="fa fa-check"></i><b>3.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="factorial.html"><a href="factorial.html"><i class="fa fa-check"></i><b>4</b> Factorial experiments</a><ul>
<li class="chapter" data-level="4.1" data-path="factorial.html"><a href="factorial.html#factorial-contrasts"><i class="fa fa-check"></i><b>4.1</b> Factorial contrasts</a><ul>
<li class="chapter" data-level="4.1.1" data-path="factorial.html"><a href="factorial.html#main-effects"><i class="fa fa-check"></i><b>4.1.1</b> Main effects</a></li>
<li class="chapter" data-level="4.1.2" data-path="factorial.html"><a href="factorial.html#interactions"><i class="fa fa-check"></i><b>4.1.2</b> Interactions</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="factorial.html"><a href="factorial.html#three-principles-for-factorial-effects"><i class="fa fa-check"></i><b>4.2</b> Three principles for factorial effects</a></li>
<li class="chapter" data-level="4.3" data-path="factorial.html"><a href="factorial.html#unreplicated-normal-plots"><i class="fa fa-check"></i><b>4.3</b> Normal effect plots for unreplicated factorial designs</a><ul>
<li class="chapter" data-level="4.3.1" data-path="factorial.html"><a href="factorial.html#lenths-method-for-approximate-hypothesis-testing"><i class="fa fa-check"></i><b>4.3.1</b> Lenth’s method for approximate hypothesis testing</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="factorial.html"><a href="factorial.html#regression-modelling-for-factorial-experiments"><i class="fa fa-check"></i><b>4.4</b> Regression modelling for factorial experiments</a><ul>
<li class="chapter" data-level="4.4.1" data-path="factorial.html"><a href="factorial.html#anova-for-factorial-experiments"><i class="fa fa-check"></i><b>4.4.1</b> ANOVA for factorial experiments</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="factorial.html"><a href="factorial.html#exercises-3"><i class="fa fa-check"></i><b>4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="block-factorial.html"><a href="block-factorial.html"><i class="fa fa-check"></i><b>5</b> Blocking in factorial designs</a><ul>
<li class="chapter" data-level="5.1" data-path="block-factorial.html"><a href="block-factorial.html#two-examples"><i class="fa fa-check"></i><b>5.1</b> Two examples</a></li>
<li class="chapter" data-level="5.2" data-path="block-factorial.html"><a href="block-factorial.html#general-method-of-constructing-a-confounded-block-design"><i class="fa fa-check"></i><b>5.2</b> General method of constructing a confounded block design</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="fractional-factorial.html"><a href="fractional-factorial.html"><i class="fa fa-check"></i><b>6</b> Fractional factorial designs</a></li>
<li class="chapter" data-level="7" data-path="response-surface-methodology.html"><a href="response-surface-methodology.html"><i class="fa fa-check"></i><b>7</b> Response surface methodology</a></li>
<li class="chapter" data-level="8" data-path="optimal-design-of-experiments.html"><a href="optimal-design-of-experiments.html"><i class="fa fa-check"></i><b>8</b> Optimal design of experiments</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MATH3014-6027 Design (and Analysis) of Experiments</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="block-factorial" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Blocking in factorial designs</h1>
<p>We now consider splitting the treatments in a factorial design into blocks. As in Chapter <a href="blocking.html#blocking">3</a>, the simplest factorial blocked design is a <strong>randomised complete block design</strong>, where the blocks are large enough for a complete replicate of the factorial treatments to occur in each block. Analysis then proceeds as in Chapter <a href="blocking.html#blocking">3</a>, with the contrasts of interest being those corresponding to the factorial effects (main effects and interactions).</p>
<p>However, the number of treatments grows rapidly in a factorial design, and it is unusual for the block sizes to be sufficiently large to accomodate a complete replication within each block. Hence, <strong>incomplete block designs</strong> must be employed. While balanced incomplete block designs (Section <a href="blocking.html#sec-bibd">3.6</a>) can be used, they do not tend to have good statistical properties and their construction is complicated. In this chapter, we will focus on a class of methods specific to splitting a two-level factorial design in to blocks who common size <span class="math inline">\(k\)</span> is a power of two.</p>
<div id="two-examples" class="section level2">
<h2><span class="header-section-number">5.1</span> Two examples</h2>
<p>We will use two simple examples to illustrate this approach, based on a <span class="math inline">\(2^3\)</span> experiment with factors labelled <span class="math inline">\(A\)</span>, <span class="math inline">\(B\)</span> and <span class="math inline">\(C\)</span> (Table <a href="block-factorial.html#tab:example-factorial">5.1</a>).</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="block-factorial.html#cb157-1"></a>example.design &lt;-<span class="st"> </span>FrF2<span class="op">::</span><span class="kw">FrF2</span>(<span class="dt">nruns =</span> <span class="dv">8</span>, <span class="dt">nfactors =</span> <span class="dv">3</span>, <span class="dt">randomize =</span> F)</span>
<span id="cb157-2"><a href="block-factorial.html#cb157-2"></a>knitr<span class="op">::</span><span class="kw">kable</span>(example.design, <span class="dt">caption =</span> <span class="st">&quot;Treatments from a $2^3$ factorial design&quot;</span>, <span class="dt">align =</span> <span class="kw">rep</span>(<span class="st">&quot;r&quot;</span>, <span class="dv">3</span>))</span></code></pre></div>
<table>
<caption><span id="tab:example-factorial">Table 5.1: </span>Treatments from a <span class="math inline">\(2^3\)</span> factorial design</caption>
<thead>
<tr class="header">
<th align="right">A</th>
<th align="right">B</th>
<th align="right">C</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">-1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">-1</td>
</tr>
<tr class="odd">
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">-1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">-1</td>
</tr>
<tr class="odd">
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="example">
<p><span id="exm:block-frac-1" class="example"><strong>Example 5.1  </strong></span>Consider splitting the treatments between two blocks of size <span class="math inline">\(2^{3-1}=4\)</span>. One choice is given in Table <a href="block-factorial.html#tab:block-frac-1">5.2</a>.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="block-factorial.html#cb158-1"></a>block1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb158-2"><a href="block-factorial.html#cb158-2"></a>example.design.a &lt;-<span class="st"> </span><span class="kw">cbind</span>(example.design, <span class="dt">Block =</span> block1)</span>
<span id="cb158-3"><a href="block-factorial.html#cb158-3"></a>knitr<span class="op">::</span><span class="kw">kable</span>(example.design.a, <span class="dt">caption =</span> <span class="st">&quot;Treatments from a $2^3$ factorial design split into two blocks of size four.&quot;</span>, <span class="dt">align =</span> <span class="kw">rep</span>(<span class="st">&quot;r&quot;</span>, <span class="dv">4</span>))</span></code></pre></div>
<table>
<caption><span id="tab:block-frac-1">Table 5.2: </span>Treatments from a <span class="math inline">\(2^3\)</span> factorial design split into two blocks of size four.</caption>
<thead>
<tr class="header">
<th align="right">A</th>
<th align="right">B</th>
<th align="right">C</th>
<th align="right">Block</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<p>To assess the impact of this choice of blocking scheme on the analysis of the experiment, we need to consider the (unscaled) contrasts corresponding to all the factorial effects, see Table <a href="block-factorial.html#tab:block-frac-1-mm">5.3</a>.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="block-factorial.html#cb159-1"></a>X &lt;-<span class="st"> </span><span class="kw">model.matrix</span>( <span class="op">~</span><span class="st"> </span>Block <span class="op">+</span><span class="st"> </span>(A <span class="op">+</span><span class="st"> </span>B <span class="op">+</span><span class="st"> </span>C)<span class="op">^</span><span class="dv">3</span>, <span class="dt">data =</span> example.design.a)</span>
<span id="cb159-2"><a href="block-factorial.html#cb159-2"></a>Xdf &lt;-<span class="st"> </span><span class="kw">data.frame</span>(X[, <span class="dv">-1</span>])</span>
<span id="cb159-3"><a href="block-factorial.html#cb159-3"></a><span class="kw">colnames</span>(Xdf) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Block&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;A:B&quot;</span>, <span class="st">&quot;A:C&quot;</span>, <span class="st">&quot;B:C&quot;</span>, <span class="st">&quot;A:B:C&quot;</span>)</span>
<span id="cb159-4"><a href="block-factorial.html#cb159-4"></a>Xdf &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(Xdf, <span class="dt">Treatment =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">8</span>, <span class="dt">.before =</span> Block)</span>
<span id="cb159-5"><a href="block-factorial.html#cb159-5"></a>knitr<span class="op">::</span><span class="kw">kable</span>(Xdf, <span class="dt">caption =</span> <span class="st">&quot;Unscaled factorial effect contrasts for a $2^3$ design with one possible assignment of treatments to blocks&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:block-frac-1-mm">Table 5.3: </span>Unscaled factorial effect contrasts for a <span class="math inline">\(2^3\)</span> design with one possible assignment of treatments to blocks</caption>
<thead>
<tr class="header">
<th align="right">Treatment</th>
<th align="right">Block</th>
<th align="right">A</th>
<th align="right">B</th>
<th align="right">C</th>
<th align="right">A:B</th>
<th align="right">A:C</th>
<th align="right">B:C</th>
<th align="right">A:B:C</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">-1</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">2</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">-1</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">2</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">-1</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">-1</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Each contrast vector in Table <a href="block-factorial.html#tab:block-frac-1-mm">5.3</a> is orthogonal, in the sense of -1 and +1 occuring equally often (twice) in each block, except for the contrast vector for the three-factor interaction. This vector has all -1 entries occuring in block 1, and all +1 entries occuring in block 2.</p>
<p>The difference in average response between blocks 1 and 2 in this design is estimated by</p>
<p><span class="math display">\[
\widehat{\beta_1 - \beta_2} = \frac{1}{4}\left\{(y_{11} + y_{14} + y_{16}+ y_{17}) - (y_{22} + y_{23} + y_{25} + y_{28})\right\}\,,
\]</span></p>
<p>where <span class="math inline">\(\beta_i\)</span> is the effect of the <span class="math inline">\(i\)</span>th block in unit-block-treatment model <a href="blocking.html#eq:block-model">(3.1)</a> and <span class="math inline">\(y_{ij}\)</span> is the response from applying treatment <span class="math inline">\(j\)</span> to a unit in block <span class="math inline">\(i\)</span> (<span class="math inline">\(i = 1, 2;\, j = 1, \ldots, 8\)</span>).</p>
<p>This contrast is <strong>exactly</strong> the same as the contrast for estimating the three-factor interaction.</p>
<p><span class="math display">\[
\mathrm{Int}(A, B, C) = \frac{1}{4}\left\{(y_{11} + y_{14} + y_{16}+ y_{17}) - (y_{22} + y_{23} + y_{25} + y_{28})\right\}\,.
\]</span>
Hence this choice of blocking makes it impossible for us to estimate this interaction. If the contrast is large, we would anticipate it was because there is a large difference in average response between blocks, not because of the three-factor interaction.</p>
<p>So why choose this particular blocking? Well, it is impossible to split this set of treatments into incomplete blocks (with <span class="math inline">\(k&lt;8\)</span>) and not lose some information about the factorial effects.</p>
<ol style="list-style-type: decimal">
<li><p>From effect hierarchy, the three-factor interaction is the least likely factorial effect to be important, and hence this is the interaction we care least about losing information about. Choosing any of the other factorial effects to determine the blocking would be a worst choice<a href="#fn30" class="footnote-ref" id="fnref30"><sup>30</sup></a></p></li>
<li><p>What about if we don’t use a column of Table <a href="block-factorial.html#tab:block-frac-1-mm">5.3</a> to assign treatments to blocks? We now longer lose all information about a particular factorial effect, but instead we lose some information about many, or even all, factorial effects.</p></li>
</ol>
<p>We can study this information lose by assessing all <span class="math inline">\({8 \choose 4}! = 70\)</span> possible assignments of treatments to blocks. For each, we will calculate the average variance of the main effect and two-factor interaction contrasts (up to a constant <span class="math inline">\(\sigma^2\)</span>).</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="block-factorial.html#cb160-1"></a>no.assign &lt;-<span class="st"> </span><span class="kw">choose</span>(<span class="dv">8</span>, <span class="dv">4</span>)</span>
<span id="cb160-2"><a href="block-factorial.html#cb160-2"></a>assignments &lt;-<span class="st"> </span>combinat<span class="op">::</span><span class="kw">combn</span>(<span class="dv">8</span>, <span class="dv">4</span>)</span>
<span id="cb160-3"><a href="block-factorial.html#cb160-3"></a>yfake &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">8</span>)</span>
<span id="cb160-4"><a href="block-factorial.html#cb160-4"></a>Xadf &lt;-<span class="st"> </span><span class="kw">cbind</span>(Xdf[, <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">-9</span>)], <span class="dt">y =</span> yfake)</span>
<span id="cb160-5"><a href="block-factorial.html#cb160-5"></a>avgvar &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb160-6"><a href="block-factorial.html#cb160-6"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>no.assign) {</span>
<span id="cb160-7"><a href="block-factorial.html#cb160-7"></a>  B &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">8</span>)</span>
<span id="cb160-8"><a href="block-factorial.html#cb160-8"></a>  B[assignments[, i]] &lt;-<span class="st"> </span><span class="dv">-1</span></span>
<span id="cb160-9"><a href="block-factorial.html#cb160-9"></a>  Xadf<span class="op">$</span>Block &lt;-<span class="st"> </span>B</span>
<span id="cb160-10"><a href="block-factorial.html#cb160-10"></a>  temp.lm &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>Block <span class="op">+</span><span class="st"> </span>(A <span class="op">+</span><span class="st"> </span>B <span class="op">+</span><span class="st"> </span>C)<span class="op">^</span><span class="dv">2</span>, <span class="dt">data =</span> Xadf)</span>
<span id="cb160-11"><a href="block-factorial.html#cb160-11"></a>  temp.lm<span class="op">$</span>residuals &lt;-<span class="st"> </span>yfake</span>
<span id="cb160-12"><a href="block-factorial.html#cb160-12"></a>  temp.lm<span class="op">$</span>df.residual &lt;-<span class="st"> </span><span class="dv">8</span></span>
<span id="cb160-13"><a href="block-factorial.html#cb160-13"></a>  vmat &lt;-<span class="st"> </span><span class="kw">vcov</span>(temp.lm) <span class="op">/</span><span class="st"> </span>(<span class="kw">summary</span>(temp.lm)<span class="op">$</span>sigma<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb160-14"><a href="block-factorial.html#cb160-14"></a>  vars &lt;-<span class="st"> </span>(<span class="kw">diag</span>(vmat[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>), <span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)]))</span>
<span id="cb160-15"><a href="block-factorial.html#cb160-15"></a>  tidyr<span class="op">::</span><span class="kw">replace_na</span>(vars, <span class="ot">Inf</span>)</span>
<span id="cb160-16"><a href="block-factorial.html#cb160-16"></a>  avgvar[i] &lt;-<span class="st"> </span><span class="kw">sum</span>(tidyr<span class="op">::</span><span class="kw">replace_na</span>(vars, <span class="ot">Inf</span>)) <span class="op">/</span><span class="st"> </span><span class="dv">6</span></span>
<span id="cb160-17"><a href="block-factorial.html#cb160-17"></a>}</span>
<span id="cb160-18"><a href="block-factorial.html#cb160-18"></a>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">table</span>(avgvar), <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Avg. variance&quot;</span>, <span class="st">&quot;Freq.&quot;</span>))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Avg. variance</th>
<th align="right">Freq.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">0.125</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">0.1875</td>
<td align="right">32</td>
</tr>
<tr class="odd">
<td align="left">Inf</td>
<td align="right">36</td>
</tr>
</tbody>
</table>
<p>From our study, we see that there are two allocations of treatments to blocks that give us the smallest average variance of <span class="math inline">\(0.125\sigma^2\)</span>. These two allocations are those that use the three-factor interaction column to assign treatments to blocks. For 32 other allocations, the average variance <span class="math inline">\(0.188\sigma^2\)</span>, and hence an efficiency of <span class="math inline">\(0.6649\)</span> compared to the first two allocations. There are also 36 allocations that have infinite average variance; these allocations use one of the six main effect or two-factor interaction columns to assign treatments to blocks. For any of these choices, the corresponding factorial effect cannot be estimated, equivalent to the estimator having infinite variance.</p>
<p>We now compare our original design to one of the 32 allocations with average variance <span class="math inline">\(0.188\sigma^2\)</span> (chosen arbitrarily).</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="block-factorial.html#cb161-1"></a>Xa &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(Xdf[, <span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>)])</span>
<span id="cb161-2"><a href="block-factorial.html#cb161-2"></a>Xb &lt;-<span class="st"> </span>Xa</span>
<span id="cb161-3"><a href="block-factorial.html#cb161-3"></a>B &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">8</span>)</span>
<span id="cb161-4"><a href="block-factorial.html#cb161-4"></a>B[assignments[, <span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="dv">-1</span></span>
<span id="cb161-5"><a href="block-factorial.html#cb161-5"></a>Xb[,<span class="dv">1</span>] &lt;-<span class="st"> </span>B</span></code></pre></div>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="block-factorial.html#cb162-1"></a>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">cor</span>(Xa), <span class="dt">caption =</span> <span class="st">&quot;Scaled inner-products between contrast vectors for $2^3$ with treatments assigned to blocks so $</span><span class="ch">\\</span><span class="st">mathrm{Blocks} = ABC$.&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:cor-optimal">Table 5.4: </span>Scaled inner-products between contrast vectors for <span class="math inline">\(2^3\)</span> with treatments assigned to blocks so <span class="math inline">\(\mathrm{Blocks} = ABC\)</span>.</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Block</th>
<th align="right">A</th>
<th align="right">B</th>
<th align="right">C</th>
<th align="right">A:B</th>
<th align="right">A:C</th>
<th align="right">B:C</th>
<th align="right">A:B:C</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Block</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">A</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">B</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">C</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">A:B</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">A:C</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">B:C</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">A:B:C</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="block-factorial.html#cb163-1"></a>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">cor</span>(Xb), <span class="dt">caption =</span> <span class="st">&quot;Scaled inner-products between contrast vectors for $2^3$ with treatments assigned to blocks arbitrarily.&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:cor-partial">Table 5.5: </span>Scaled inner-products between contrast vectors for <span class="math inline">\(2^3\)</span> with treatments assigned to blocks arbitrarily.</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Block</th>
<th align="right">A</th>
<th align="right">B</th>
<th align="right">C</th>
<th align="right">A:B</th>
<th align="right">A:C</th>
<th align="right">B:C</th>
<th align="right">A:B:C</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Block</td>
<td align="right">1.0</td>
<td align="right">0.5</td>
<td align="right">0.5</td>
<td align="right">0.5</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">-0.5</td>
</tr>
<tr class="even">
<td align="left">A</td>
<td align="right">0.5</td>
<td align="right">1.0</td>
<td align="right">0.0</td>
<td align="right">0.0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0</td>
</tr>
<tr class="odd">
<td align="left">B</td>
<td align="right">0.5</td>
<td align="right">0.0</td>
<td align="right">1.0</td>
<td align="right">0.0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0</td>
</tr>
<tr class="even">
<td align="left">C</td>
<td align="right">0.5</td>
<td align="right">0.0</td>
<td align="right">0.0</td>
<td align="right">1.0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0</td>
</tr>
<tr class="odd">
<td align="left">A:B</td>
<td align="right">0.0</td>
<td align="right">0.0</td>
<td align="right">0.0</td>
<td align="right">0.0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0</td>
</tr>
<tr class="even">
<td align="left">A:C</td>
<td align="right">0.0</td>
<td align="right">0.0</td>
<td align="right">0.0</td>
<td align="right">0.0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0.0</td>
</tr>
<tr class="odd">
<td align="left">B:C</td>
<td align="right">0.0</td>
<td align="right">0.0</td>
<td align="right">0.0</td>
<td align="right">0.0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.0</td>
</tr>
<tr class="even">
<td align="left">A:B:C</td>
<td align="right">-0.5</td>
<td align="right">0.0</td>
<td align="right">0.0</td>
<td align="right">0.0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1.0</td>
</tr>
</tbody>
</table>
<p>From Table <a href="block-factorial.html#tab:cor-optimal">5.4</a>, we can see that the block contrast is orthogonal to (has zero inner product with) all the main effect and two-factor interaction contrasts. In comparison, the design with arbitrary treatment assignment has non-zero inner products between blocks and the main effect contrasts (Table <a href="block-factorial.html#tab:cor-partial">5.5</a>). However, this design does allow estimation of the three-factor interaction (although it too has non-zero inner-product with the block contrast).<a href="#fn31" class="footnote-ref" id="fnref31"><sup>31</sup></a></p>
<p>Clearly, if interest is in estimation of the main effects and two-factor interactions, it is best to use the design which assigns treatments to blocks via the three-factor interaction contrast coefficients.</p>
</div>
<div class="definition">
<p><span id="def:confounding" class="definition"><strong>Definition 5.1  </strong></span>A factorial effect is said to be <strong>confounded</strong> with blocks if the same contrast in the observations estimates both the factorial effect and a difference between blocks.</p>
</div>
<p>In Example <a href="block-factorial.html#exm:block-frac-1">5.1</a>, the three-factor interaction <span class="math inline">\(ABC\)</span> is confounded with blocks. We write <span class="math inline">\(\mathrm{Blocks} = ABC\)</span> as a shorthand to represent this confounding.</p>
<div class="example">
<p><span id="exm:block-frac-2" class="example"><strong>Example 5.2  </strong></span>Now consider splitting the treatments between four blocks of size <span class="math inline">\(2^{3-2}=2\)</span>. One choice is given in Table <a href="block-factorial.html#tab:block-frac-2">5.6</a>.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="block-factorial.html#cb164-1"></a>block2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb164-2"><a href="block-factorial.html#cb164-2"></a>example.design.b &lt;-<span class="st"> </span><span class="kw">cbind</span>(example.design, <span class="dt">Block =</span> block2)</span>
<span id="cb164-3"><a href="block-factorial.html#cb164-3"></a>knitr<span class="op">::</span><span class="kw">kable</span>(example.design.b, <span class="dt">caption =</span> <span class="st">&quot;Treatments from a $2^3$ factorial design split into four blocks of size two.&quot;</span>, <span class="dt">align =</span> <span class="kw">rep</span>(<span class="st">&quot;r&quot;</span>, <span class="dv">4</span>))</span></code></pre></div>
<table>
<caption><span id="tab:block-frac-2">Table 5.6: </span>Treatments from a <span class="math inline">\(2^3\)</span> factorial design split into four blocks of size two.</caption>
<thead>
<tr class="header">
<th align="right">A</th>
<th align="right">B</th>
<th align="right">C</th>
<th align="right">Block</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">4</td>
</tr>
</tbody>
</table>
<p>Clearly, we cannot use a single factorial contrast (taking only two values) to divide treatments between four blocks. The obvious extension to the approach from Example <a href="block-factorial.html#exm:block-frac-1">5.1</a> is to use the combination of two columns. Here, we have used the contrasts for the <span class="math inline">\(AB\)</span> and <span class="math inline">\(AC\)</span> interactions.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="block-factorial.html#cb165-1"></a>X &lt;-<span class="st"> </span><span class="kw">model.matrix</span>( <span class="op">~</span><span class="st"> </span>Block <span class="op">+</span><span class="st"> </span>(A <span class="op">+</span><span class="st"> </span>B <span class="op">+</span><span class="st"> </span>C)<span class="op">^</span><span class="dv">3</span>, <span class="dt">data =</span> example.design.b)</span>
<span id="cb165-2"><a href="block-factorial.html#cb165-2"></a>Xdf &lt;-<span class="st"> </span><span class="kw">data.frame</span>(X[, <span class="dv">-1</span>])</span>
<span id="cb165-3"><a href="block-factorial.html#cb165-3"></a><span class="kw">colnames</span>(Xdf) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Block&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;A:B&quot;</span>, <span class="st">&quot;A:C&quot;</span>, <span class="st">&quot;B:C&quot;</span>, <span class="st">&quot;A:B:C&quot;</span>)</span>
<span id="cb165-4"><a href="block-factorial.html#cb165-4"></a>Xdf &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(Xdf, <span class="dt">Treatment =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">8</span>, <span class="dt">.before =</span> Block)</span>
<span id="cb165-5"><a href="block-factorial.html#cb165-5"></a>knitr<span class="op">::</span><span class="kw">kable</span>(Xdf, <span class="dt">caption =</span> <span class="st">&quot;Unscaled factorial effect contrasts for a $2^3$ design with one possible assignment of treatments to four blocks of size two.&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:block-frac-2-mm">Table 5.7: </span>Unscaled factorial effect contrasts for a <span class="math inline">\(2^3\)</span> design with one possible assignment of treatments to four blocks of size two.</caption>
<thead>
<tr class="header">
<th align="right">Treatment</th>
<th align="right">Block</th>
<th align="right">A</th>
<th align="right">B</th>
<th align="right">C</th>
<th align="right">A:B</th>
<th align="right">A:C</th>
<th align="right">B:C</th>
<th align="right">A:B:C</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">4</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">-1</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">2</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">-1</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">-1</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">3</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">-1</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">-1</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">4</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>In Table <a href="block-factorial.html#tab:block-frac-2-mm">5.7</a> we can see that the contrasts for <span class="math inline">\(AB\)</span> and <span class="math inline">\(AC\)</span> are confounded with blocks (the contrast coefficients are constant within each blocks).</p>
<ul>
<li><p>Block 1 contains treatments 4 and 5, which have <span class="math inline">\(AB = +1\)</span> and <span class="math inline">\(AC = -1\)</span>.</p></li>
<li><p>Block 2 contains treatments 3 and 6, which have <span class="math inline">\(AB = -1\)</span> and <span class="math inline">\(AC = +1\)</span>.</p></li>
<li><p>Block 3 contains treatments 2 and 7, whicn have <span class="math inline">\(AB = AC = -1\)</span>.</p></li>
<li><p>Block 4 contains treatments 1 and 8, which have <span class="math inline">\(AB = AC = +1\)</span>.</p></li>
</ul>
<p>However, by confounding interactions <span class="math inline">\(AB\)</span> and <span class="math inline">\(AC\)</span> we have also confounded the elementwise (Hadamard) product of these two interactions:</p>
<p><span class="math display">\[
AB \odot AC = A \odot B \odot A \odot C = B \odot C = BC\,.
\]</span>
If the contrast vectors for <span class="math inline">\(AB\)</span> and <span class="math inline">\(AC\)</span> are constant, the contrast vector for interaction <span class="math inline">\(BC\)</span> must also be constant. Hence, interaction <span class="math inline">\(BC\)</span> is also confounded with blocks.</p>
<p>We write this confounding as</p>
<p><span class="math display">\[
\mathrm{Block}_1 = AB\,,\quad \mathrm{Block}_2 = AC\,,\quad \mathrm{Block}_3 = \mathrm{Block}_1\times\mathrm{Block}_2 = BC\,.
\]</span>
Clearly, alternative blocking schemes are possible. However, we must be careful not to inadvertently confound low-order factorial effects. For example, if we chose to confound the three-factor interaction <span class="math inline">\(ABC\)</span> with blocks, along with one two-factor interaction, say <span class="math inline">\(BC\)</span>, then we also confound</p>
<p><span class="math display">\[
ABC \odot BC = A \odot B \odot C \odot B \odot C = A\,.
\]</span>
Hence, the main effect of factor <span class="math inline">\(A\)</span> is also confounded with blocks. This is clearly undesirable, e.g. by effect hierarchy.</p>
<p>We shouldn’t be surprised that a third factorial effect was confounded with blocks. In the unit-block-treatment model <a href="blocking.html#eq:block-plm">(3.2)</a>, the rank of the block model matrix <span class="math inline">\(X_1\)</span> is equal to 3, and hence there will be three degrees of freedom required to estimate the blocking effects.</p>
<p>As in Example <a href="block-factorial.html#exm:block-frac-1">5.1</a>, we could also explore alternative blocking schemes that do not completely confound factorial effects with blocks. However, as before, these alternatives would lead to higher average variance for the estimation of main effects compared to the design that confounds the three two-factor interactions.<a href="#fn32" class="footnote-ref" id="fnref32"><sup>32</sup></a></p>
</div>
<div class="definition">
<p><span id="def:block-clear-effects" class="definition"><strong>Definition 5.2  </strong></span>In a blocked factorial design, those effects which are not confounded with blocks are called <strong>clear</strong>.</p>
</div>
<p>In Example <a href="block-factorial.html#exm:block-frac-1">5.1</a> the clear effects are <span class="math inline">\(A\)</span>, <span class="math inline">\(B\)</span>, <span class="math inline">\(C\)</span>, <span class="math inline">\(AB\)</span>, <span class="math inline">\(AC\)</span> and <span class="math inline">\(BC\)</span>. In Example <a href="block-factorial.html#exm:block-frac-2">5.2</a>, the clear effects are <span class="math inline">\(A\)</span>, <span class="math inline">\(B\)</span>, <span class="math inline">\(C\)</span> and <span class="math inline">\(ABC\)</span>.</p>
</div>
<div id="general-method-of-constructing-a-confounded-block-design" class="section level2">
<h2><span class="header-section-number">5.2</span> General method of constructing a confounded block design</h2>
<p>To arrange a <span class="math inline">\(2^{f}\)</span> design in <span class="math inline">\(b=2^{q}\)</span> blocks of size <span class="math inline">\(k=2^{f-q}\)</span>:</p>
<ul>
<li>choose <span class="math inline">\(q\)</span> independent factorial contrasts for the <strong>defining blocks</strong>. Typically, we choose higher-order interactions (due to effect hierarchy):</li>
</ul>
<p><span class="math display">\[
\mathrm{Block}_{1}=\boldsymbol{c}_{1},\ldots,\mathrm{Block}_{q} = \boldsymbol{c}_{q}\,.
\]</span></p>
<ul>
<li>all the hadamard products of <span class="math inline">\(\boldsymbol{c}_{1},\dots,\boldsymbol{c}_{q}\)</span> are also confounded with blocks:</li>
</ul>
<p><span class="math display">\[
\begin{array}{ccc}
\mathrm{Block}_{1}\mathrm{Block}_{2}&amp;=&amp;\boldsymbol{c}_{1}\odot\boldsymbol{c}_{2} \\
\mathrm{Block}_{1}\mathrm{Block}_{3}&amp;=&amp;\boldsymbol{c}_{1}\odot\boldsymbol{c}_{3} \\
\vdots&amp;=&amp;\vdots\\
\mathrm{Block}_{1}\mathrm{Block}_{2}\dots \mathrm{Block}_{q}&amp;=&amp;\boldsymbol{c}_{1}\odot\boldsymbol{c}_{2}\odot\dots\odot \boldsymbol{c}_{q}\
\end{array}
\]</span>
- in total, <span class="math inline">\(2^q -1\)</span> factorial effects will be confounded with blocks.</p>
<p>For example, a <span class="math inline">\(2^{8}\)</span> design in <span class="math inline">\(b = 2^{3}=8\)</span> blocks of size <span class="math inline">\(k = 2^{8-3}=2^{5}=32\)</span>. We choose the following <span class="math inline">\(q=3\)</span> defining blocks:</p>
<p><span class="math display">\[
\mathrm{Block}_{1}=ACEGH\,,\quad \mathrm{Block}_{2}=BCFGH\,,\quad \mathrm{Block}_{3}= BDEGH\,.
\]</span></p>
<p>We obtain the other confounded effects by hadamard multiplication:</p>
<p><span class="math display">\[\begin{eqnarray}
\mathrm{Block}_{1}\odot \mathrm{Block}_{2} &amp; = &amp; ABEF \nonumber\\
\mathrm{Block}_{1}\odot \mathrm{Block}_{3} &amp; = &amp; ABCD \nonumber\\
\mathrm{Block}_{2}\odot \mathrm{Block}_{3} &amp; = &amp; CDEF \nonumber\\
\mathrm{Block}_{1}\odot \mathrm{Block}_{2} \odot \mathrm{Block}_{3} &amp; = &amp; ADFGH\,. \nonumber
\end{eqnarray}\]</span></p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="30">
<li id="fn30"><p>In the absence of any prior information telling us that certain effects are of particular interest, we always favour losing information on higher order effects.<a href="block-factorial.html#fnref30" class="footnote-back">↩︎</a></p></li>
<li id="fn31"><p>Also, simultaneous estimation of the intercept, blocking effect and all 8 factorial effects is not possible, as there are insufficient degrees of freedom. In fact, the rank of the combined treatment and block model matrices for the unit-block-treatment model (<a href="#eq:eq:block-plm">(<strong>??</strong>)</a>) is t+b-3.<a href="block-factorial.html#fnref31" class="footnote-back">↩︎</a></p></li>
<li id="fn32"><p>This design is too small to split into four blocks and still be able to estimate all two-factor interactions clear of blocks.<a href="block-factorial.html#fnref32" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="factorial.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="fractional-factorial.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown_math3014-6027.pdf", "bookdown_math3014-6027.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
