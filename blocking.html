<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Blocking | MATH3014-6027 Design (and Analysis) of Experiments</title>
  <meta name="description" content="Lecture notes for the modules MATH3014 and MATH6027 at the University of Southampton" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Blocking | MATH3014-6027 Design (and Analysis) of Experiments" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Lecture notes for the modules MATH3014 and MATH6027 at the University of Southampton" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Blocking | MATH3014-6027 Design (and Analysis) of Experiments" />
  
  <meta name="twitter:description" content="Lecture notes for the modules MATH3014 and MATH6027 at the University of Southampton" />
  

<meta name="author" content="Dave Woods" />


<meta name="date" content="2022-03-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="crd.html"/>
<link rel="next" href="factorial.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">MATH3014-6027</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Motivation, introduction and revision</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#motivation"><i class="fa fa-check"></i><b>1.1</b> Motivation</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#aims-of-experimentation-and-some-examples"><i class="fa fa-check"></i><b>1.2</b> Aims of experimentation and some examples</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#some-definitions"><i class="fa fa-check"></i><b>1.3</b> Some definitions</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#principles"><i class="fa fa-check"></i><b>1.4</b> Principles of experimentation</a><ul>
<li class="chapter" data-level="1.4.1" data-path="intro.html"><a href="intro.html#replication"><i class="fa fa-check"></i><b>1.4.1</b> Replication</a></li>
<li class="chapter" data-level="1.4.2" data-path="intro.html"><a href="intro.html#randomisation"><i class="fa fa-check"></i><b>1.4.2</b> Randomisation</a></li>
<li class="chapter" data-level="1.4.3" data-path="intro.html"><a href="intro.html#intro-blocking"><i class="fa fa-check"></i><b>1.4.3</b> Stratification (or blocking)</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#lin-model-rev"><i class="fa fa-check"></i><b>1.5</b> Revision on the linear model</a><ul>
<li class="chapter" data-level="1.5.1" data-path="intro.html"><a href="intro.html#variance-of-a-predictionfitted-value"><i class="fa fa-check"></i><b>1.5.1</b> Variance of a Prediction/Fitted Value</a></li>
<li class="chapter" data-level="1.5.2" data-path="intro.html"><a href="intro.html#analysis-of-variance-and-r2-as-model-comparison"><i class="fa fa-check"></i><b>1.5.2</b> Analysis of Variance and R<span class="math inline">\(^{2}\)</span> as Model Comparison</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#exercises"><i class="fa fa-check"></i><b>1.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="crd.html"><a href="crd.html"><i class="fa fa-check"></i><b>2</b> Completely randomised designs</a><ul>
<li class="chapter" data-level="2.1" data-path="crd.html"><a href="crd.html#a-unit-treatment-linear-model"><i class="fa fa-check"></i><b>2.1</b> A unit-treatment linear model</a></li>
<li class="chapter" data-level="2.2" data-path="crd.html"><a href="crd.html#the-partitioned-linear-model"><i class="fa fa-check"></i><b>2.2</b> The partitioned linear model</a></li>
<li class="chapter" data-level="2.3" data-path="crd.html"><a href="crd.html#reduced-normal-equations-for-the-crd"><i class="fa fa-check"></i><b>2.3</b> Reduced normal equations for the CRD</a></li>
<li class="chapter" data-level="2.4" data-path="crd.html"><a href="crd.html#contrasts"><i class="fa fa-check"></i><b>2.4</b> Contrasts</a></li>
<li class="chapter" data-level="2.5" data-path="crd.html"><a href="crd.html#contrast-crd"><i class="fa fa-check"></i><b>2.5</b> Treatment contrast estimators in the CRD</a></li>
<li class="chapter" data-level="2.6" data-path="crd.html"><a href="crd.html#r-crd"><i class="fa fa-check"></i><b>2.6</b> Analysing CRDs in R</a></li>
<li class="chapter" data-level="2.7" data-path="crd.html"><a href="crd.html#multiple-comp"><i class="fa fa-check"></i><b>2.7</b> Multiple comparisons</a></li>
<li class="chapter" data-level="2.8" data-path="crd.html"><a href="crd.html#impact-of-design-choices-on-estimation"><i class="fa fa-check"></i><b>2.8</b> Impact of design choices on estimation</a><ul>
<li class="chapter" data-level="2.8.1" data-path="crd.html"><a href="crd.html#crd-opt-all"><i class="fa fa-check"></i><b>2.8.1</b> Optimal treatment allocation</a></li>
<li class="chapter" data-level="2.8.2" data-path="crd.html"><a href="crd.html#crd-size"><i class="fa fa-check"></i><b>2.8.2</b> Overall size of the experiment</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="crd.html"><a href="crd.html#exercises-1"><i class="fa fa-check"></i><b>2.9</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="blocking.html"><a href="blocking.html"><i class="fa fa-check"></i><b>3</b> Blocking</a><ul>
<li class="chapter" data-level="3.1" data-path="blocking.html"><a href="blocking.html#unit-block-treatment-model"><i class="fa fa-check"></i><b>3.1</b> Unit-block-treatment model</a></li>
<li class="chapter" data-level="3.2" data-path="blocking.html"><a href="blocking.html#normal-equations"><i class="fa fa-check"></i><b>3.2</b> Normal equations</a></li>
<li class="chapter" data-level="3.3" data-path="blocking.html"><a href="blocking.html#block-anova"><i class="fa fa-check"></i><b>3.3</b> Analysis of variance</a></li>
<li class="chapter" data-level="3.4" data-path="blocking.html"><a href="blocking.html#rcdb"><i class="fa fa-check"></i><b>3.4</b> Randomised complete block designs</a></li>
<li class="chapter" data-level="3.5" data-path="blocking.html"><a href="blocking.html#blocks-orthogonal"><i class="fa fa-check"></i><b>3.5</b> Orthogonal blocking</a></li>
<li class="chapter" data-level="3.6" data-path="blocking.html"><a href="blocking.html#balanced-incomplete-block-designs"><i class="fa fa-check"></i><b>3.6</b> Balanced incomplete block designs</a><ul>
<li class="chapter" data-level="3.6.1" data-path="blocking.html"><a href="blocking.html#construction-of-bibds"><i class="fa fa-check"></i><b>3.6.1</b> Construction of BIBDs</a></li>
<li class="chapter" data-level="3.6.2" data-path="blocking.html"><a href="blocking.html#reduced-normal-equations"><i class="fa fa-check"></i><b>3.6.2</b> Reduced normal equations</a></li>
<li class="chapter" data-level="3.6.3" data-path="blocking.html"><a href="blocking.html#estimation-and-inference"><i class="fa fa-check"></i><b>3.6.3</b> Estimation and inference</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="blocking.html"><a href="blocking.html#exercises-2"><i class="fa fa-check"></i><b>3.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="factorial.html"><a href="factorial.html"><i class="fa fa-check"></i><b>4</b> Factorial experiments</a></li>
<li class="chapter" data-level="5" data-path="block-factorial.html"><a href="block-factorial.html"><i class="fa fa-check"></i><b>5</b> Blocking in factorial designs</a></li>
<li class="chapter" data-level="6" data-path="fractional-factorial.html"><a href="fractional-factorial.html"><i class="fa fa-check"></i><b>6</b> Fractional factorial designs</a></li>
<li class="chapter" data-level="7" data-path="response-surface-methodology.html"><a href="response-surface-methodology.html"><i class="fa fa-check"></i><b>7</b> Response surface methodology</a></li>
<li class="chapter" data-level="8" data-path="optimal-design-of-experiments.html"><a href="optimal-design-of-experiments.html"><i class="fa fa-check"></i><b>8</b> Optimal design of experiments</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MATH3014-6027 Design (and Analysis) of Experiments</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="blocking" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Blocking</h1>
<p>The completely randomised design (CRD) works well when there is sufficient homogeneous experimental units to perform the whole experiment under the same, or very similar, conditions and there are no restrictions on the randomisation of treatments to units. The only systematic (non-random) differences in the observed responses result from differences between the treatments. While such designs are commonly and successfully used, especially in smaller experiments, their application can often be unrealistic or impractical in many settings.</p>
<p>A common way in which the CRD fails is a lack of sufficiently similar experimental units. If there are systemtic differences between different batches, or <strong>blocks</strong> of units, these differences should be taken into account in both the allocation of treatments to units and the modelling of the resultant data. Otherwise, block-to-block differences may bias treatment comparisons and/or inflate our estimate of the background variability and hence reduce our ability to detect important treatment effects.</p>
<div class="example">
<p><span id="exm:blocks-bars" class="example"><strong>Example 3.1  </strong></span>Steel bar experiment <span class="citation">(Morris, <a href="#ref-Morris2011" role="doc-biblioref">2011</a>, ch. 4)</span></p>
<p><span class="citation">Kocaoz <em>et al.</em> (<a href="#ref-KSN2005" role="doc-biblioref">2005</a>)</span> described an experiment to assess the strength of steel reinforcement bars from <span class="math inline">\(t=4\)</span> coatings<a href="#fn18" class="footnote-ref" id="fnref18"><sup>18</sup></a> (treatments). In total <span class="math inline">\(n=32\)</span> different bars (units) were available, but the testing process meant sets of four bars were tested together. To account for potential test-specific features (e.g. environmental or operational), these different test sets were assumed to form <span class="math inline">\(b=8\)</span> blocks of size <span class="math inline">\(k=4\)</span>. The data are shown in Table <a href="blocking.html#tab:bar-expt-data">3.1</a> below.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="blocking.html#cb58-1"></a>bar &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">coating =</span> <span class="kw">rep</span>(<span class="kw">factor</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>), <span class="dv">8</span>),</span>
<span id="cb58-2"><a href="blocking.html#cb58-2"></a>                   <span class="dt">block =</span> <span class="kw">rep</span>(<span class="kw">factor</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">8</span>), <span class="kw">rep</span>(<span class="dv">4</span>, <span class="dv">8</span>)), </span>
<span id="cb58-3"><a href="blocking.html#cb58-3"></a>                   <span class="dt">strength =</span> <span class="kw">c</span>(<span class="dv">136</span>, <span class="dv">147</span>, <span class="dv">138</span>, <span class="dv">149</span>, <span class="dv">136</span>, <span class="dv">143</span>, <span class="dv">122</span>, <span class="dv">153</span>, <span class="dv">150</span>, <span class="dv">142</span>, <span class="dv">131</span>, <span class="dv">136</span>,</span>
<span id="cb58-4"><a href="blocking.html#cb58-4"></a>                                   <span class="dv">155</span>, <span class="dv">148</span>, <span class="dv">130</span>, <span class="dv">129</span>, <span class="dv">145</span>, <span class="dv">149</span>, <span class="dv">136</span>, <span class="dv">139</span>, <span class="dv">150</span>, <span class="dv">149</span>, <span class="dv">147</span>, <span class="dv">144</span>,</span>
<span id="cb58-5"><a href="blocking.html#cb58-5"></a>                                   <span class="dv">147</span>, <span class="dv">150</span>, <span class="dv">125</span>, <span class="dv">140</span>, <span class="dv">148</span>, <span class="dv">149</span>, <span class="dv">118</span>, <span class="dv">145</span>)</span>
<span id="cb58-6"><a href="blocking.html#cb58-6"></a>                     )</span>
<span id="cb58-7"><a href="blocking.html#cb58-7"></a>knitr<span class="op">::</span><span class="kw">kable</span>(</span>
<span id="cb58-8"><a href="blocking.html#cb58-8"></a> tidyr<span class="op">::</span><span class="kw">pivot_wider</span>(bar, <span class="dt">names_from =</span> coating, <span class="dt">values_from =</span> strength),</span>
<span id="cb58-9"><a href="blocking.html#cb58-9"></a> <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Block&quot;</span>, <span class="kw">paste</span>(<span class="st">&quot;Coating&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)),</span>
<span id="cb58-10"><a href="blocking.html#cb58-10"></a> <span class="dt">caption =</span> <span class="st">&quot;Steel bar experiment: tensile strength values (kliograms per square inch, ksi) from steel bars with four different coatings.&quot;</span></span>
<span id="cb58-11"><a href="blocking.html#cb58-11"></a>)</span></code></pre></div>
<table>
<caption><span id="tab:bar-expt-data">Table 3.1: </span>Steel bar experiment: tensile strength values (kliograms per square inch, ksi) from steel bars with four different coatings.</caption>
<thead>
<tr class="header">
<th align="left">Block</th>
<th align="right">Coating 1</th>
<th align="right">Coating 2</th>
<th align="right">Coating 3</th>
<th align="right">Coating 4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">136</td>
<td align="right">147</td>
<td align="right">138</td>
<td align="right">149</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">136</td>
<td align="right">143</td>
<td align="right">122</td>
<td align="right">153</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">150</td>
<td align="right">142</td>
<td align="right">131</td>
<td align="right">136</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="right">155</td>
<td align="right">148</td>
<td align="right">130</td>
<td align="right">129</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="right">145</td>
<td align="right">149</td>
<td align="right">136</td>
<td align="right">139</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="right">150</td>
<td align="right">149</td>
<td align="right">147</td>
<td align="right">144</td>
</tr>
<tr class="odd">
<td align="left">7</td>
<td align="right">147</td>
<td align="right">150</td>
<td align="right">125</td>
<td align="right">140</td>
</tr>
<tr class="even">
<td align="left">8</td>
<td align="right">148</td>
<td align="right">149</td>
<td align="right">118</td>
<td align="right">145</td>
</tr>
</tbody>
</table>
<p>Here, each block has size 4, which is equal to the number of treatments in the experiment, and each treatment is applied in each block. This is an example of a <strong>randomised complete block design</strong>.</p>
<p>We can study the data graphically, plotting by treatment and by block.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="blocking.html#cb59-1"></a><span class="kw">boxplot</span>(strength <span class="op">~</span><span class="st"> </span>block, <span class="dt">data =</span> bar)</span>
<span id="cb59-2"><a href="blocking.html#cb59-2"></a><span class="kw">boxplot</span>(strength <span class="op">~</span><span class="st"> </span>coating, <span class="dt">data =</span> bar)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:bar-expt-boxplots"></span>
<img src="bookdown_math3014-6027_files/figure-html/bar-expt-boxplots-1.png" alt="Steel bar experiment: distributions of tensile strength (ksi) from the eight blocks (top) and the four coatings (bottom)." width="672" /><img src="bookdown_math3014-6027_files/figure-html/bar-expt-boxplots-2.png" alt="Steel bar experiment: distributions of tensile strength (ksi) from the eight blocks (top) and the four coatings (bottom)." width="672" />
<p class="caption">
Figure 3.1: Steel bar experiment: distributions of tensile strength (ksi) from the eight blocks (top) and the four coatings (bottom).
</p>
</div>
<p>The box plots within each plot in Figure <a href="blocking.html#fig:bar-expt-boxplots">3.1</a> are comparable, as every treatment has occured with every block the same number of times (once). For example, when we compare the box plots for treatments 1 and 3, we know each of then display one observation from each block. Therefore, differences between treatments will not be influenced by large differences between blocks. This <strong>balance</strong> makes our analysis more straighforward. By eye, it appears here there may be differences between both coating 3 and the other three coatings.</p>
</div>
<div class="example">
<p><span id="exm:blocks-tyres" class="example"><strong>Example 3.2  </strong></span>Tyre experiment <span class="citation">(Wu and Hamada, <a href="#ref-WH2009" role="doc-biblioref">2009</a>, ch. 3)</span></p>
<p><span class="citation">Davies (<a href="#ref-Davies1954" role="doc-biblioref">1954</a>)</span>, p.200, examined the effect of <span class="math inline">\(t=4\)</span> different rubber compounds (treatments) on the lifetime of a tyre. Each tyre is only large enough to split into <span class="math inline">\(k=3\)</span> segments whilst still containing a representative amount of each compound. When tested, each tyre is subjected to the same road conditions, and hence is treated as a block. A design with <span class="math inline">\(b=4\)</span> blocks was used, as displayed in Table <a href="blocking.html#tab:tyre-expt-data">3.2</a>.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="blocking.html#cb60-1"></a>tyre &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">compound =</span> <span class="kw">as.factor</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)),</span>
<span id="cb60-2"><a href="blocking.html#cb60-2"></a>                   <span class="dt">block =</span> <span class="kw">rep</span>(<span class="kw">factor</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>), <span class="kw">rep</span>(<span class="dv">3</span>, <span class="dv">4</span>)), </span>
<span id="cb60-3"><a href="blocking.html#cb60-3"></a>                   <span class="dt">wear =</span> <span class="kw">c</span>(<span class="dv">238</span>, <span class="dv">238</span>, <span class="dv">279</span>, <span class="dv">196</span>, <span class="dv">213</span>, <span class="dv">308</span>, <span class="dv">254</span>, <span class="dv">334</span>, <span class="dv">367</span>, <span class="dv">312</span>, <span class="dv">421</span>, <span class="dv">412</span>)</span>
<span id="cb60-4"><a href="blocking.html#cb60-4"></a>                     )</span>
<span id="cb60-5"><a href="blocking.html#cb60-5"></a><span class="kw">options</span>(<span class="dt">knitr.kable.NA =</span> <span class="st">&#39;&#39;</span>)</span>
<span id="cb60-6"><a href="blocking.html#cb60-6"></a>knitr<span class="op">::</span><span class="kw">kable</span>(</span>
<span id="cb60-7"><a href="blocking.html#cb60-7"></a> tidyr<span class="op">::</span><span class="kw">pivot_wider</span>(tyre, <span class="dt">names_from =</span> compound, <span class="dt">values_from =</span> wear),</span>
<span id="cb60-8"><a href="blocking.html#cb60-8"></a> <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Block&quot;</span>, <span class="kw">paste</span>(<span class="st">&quot;Compound&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)),</span>
<span id="cb60-9"><a href="blocking.html#cb60-9"></a> <span class="dt">caption =</span> <span class="st">&quot;Tyre experiment: relative wear measurements (unitless) from tires made with four different rubber compounds.&quot;</span></span>
<span id="cb60-10"><a href="blocking.html#cb60-10"></a>)</span></code></pre></div>
<table>
<caption><span id="tab:tyre-expt-data">Table 3.2: </span>Tyre experiment: relative wear measurements (unitless) from tires made with four different rubber compounds.</caption>
<thead>
<tr class="header">
<th align="left">Block</th>
<th align="right">Compound 1</th>
<th align="right">Compound 2</th>
<th align="right">Compound 3</th>
<th align="right">Compound 4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">238</td>
<td align="right">238</td>
<td align="right">279</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">196</td>
<td align="right">213</td>
<td align="right"></td>
<td align="right">308</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">254</td>
<td align="right"></td>
<td align="right">334</td>
<td align="right">367</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="right"></td>
<td align="right">312</td>
<td align="right">421</td>
<td align="right">412</td>
</tr>
</tbody>
</table>
<p>Here, each block has size <span class="math inline">\(k=3\)</span>, which is smaller than the number of treatments (<span class="math inline">\(t=4\)</span>). Hence, each block cannot contain an application of each treatment. This is an example of an <strong>incomplete block design</strong>.</p>
<p>Graphical exploration of the data is a little more problematic in this example. As each treatment does not occur in each block, box plots such as Figure <a href="blocking.html#fig:tyre-expt-boxplots">3.2</a> are not as informative. Do compounds three and four have higher average wear because they were the only compounds to both occur in blocks 3 and 4? Or do blocks 3 and 4 have a higher mean because they contain both compounds 3 and 4? The design cannot help us entirely disentangle the impact of blocks and treatments<a href="#fn19" class="footnote-ref" id="fnref19"><sup>19</sup></a>. In our modelling, we will assume variation should first be described by blocks (which are generally fixed aspects of the experiment) and then treatments (which are more directly under the experimenter’s control).</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="blocking.html#cb61-1"></a><span class="kw">boxplot</span>(wear <span class="op">~</span><span class="st"> </span>block, <span class="dt">data =</span> tyre)</span>
<span id="cb61-2"><a href="blocking.html#cb61-2"></a><span class="kw">boxplot</span>(wear <span class="op">~</span><span class="st"> </span>compound, <span class="dt">data =</span> tyre)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:tyre-expt-boxplots"></span>
<img src="bookdown_math3014-6027_files/figure-html/tyre-expt-boxplots-1.png" alt="Tyre experiment: distributions of wear from the four blocks (top) and the four compounds (bottom)." width="672" /><img src="bookdown_math3014-6027_files/figure-html/tyre-expt-boxplots-2.png" alt="Tyre experiment: distributions of wear from the four blocks (top) and the four compounds (bottom)." width="672" />
<p class="caption">
Figure 3.2: Tyre experiment: distributions of wear from the four blocks (top) and the four compounds (bottom).
</p>
</div>
</div>
<div id="unit-block-treatment-model" class="section level2">
<h2><span class="header-section-number">3.1</span> Unit-block-treatment model</h2>
<p>If <span class="math inline">\(n_{ij}\)</span> is the number of times treatment <span class="math inline">\(j\)</span> occurs in block <span class="math inline">\(i\)</span>, a common statistical model to describe data from a blocked experiment has the form</p>
<p><span class="math display" id="eq:block-model">\[\begin{equation}
y_{ijl} = \mu + \beta_i + \tau_j + \varepsilon_{ijl}\,, \qquad i = 1,\ldots, b; j = 1, \ldots, t; l = 1,\ldots,n_{ij}\,,
\tag{3.1}
\end{equation}\]</span>
where <span class="math inline">\(y_{ijl}\)</span> is the response from the <span class="math inline">\(l\)</span>th application of the <span class="math inline">\(j\)</span>th treatment in the <span class="math inline">\(i\)</span>th block, <span class="math inline">\(\mu\)</span> is a constant parameter, <span class="math inline">\(\beta_i\)</span> is the effect of the <span class="math inline">\(i\)</span>th block, <span class="math inline">\(\tau_j\)</span> is the effect of treatment <span class="math inline">\(j\)</span>, and <span class="math inline">\(\varepsilon_{ijl}\sim N(0, \sigma^2)\)</span> are once again random individual effects from each experimental unit, assumed independent. The total number of runs in the experiment is given by <span class="math inline">\(n = \sum_{i=1}^b\sum_{j=1}^t n_{ij}\)</span>.</p>
<p>For Example <a href="blocking.html#exm:blocks-bars">3.1</a>, there are <span class="math inline">\(t=4\)</span> experiments, <span class="math inline">\(b = 8\)</span> blocks and each treatment occurs once in each block, so <span class="math inline">\(n_{ij} = 1\)</span> for all <span class="math inline">\(i, j\)</span>. In Example <a href="blocking.html#exm:blocks-tyres">3.2</a>, there are again <span class="math inline">\(t=4\)</span> treatments but now only <span class="math inline">\(b=4\)</span> blocks and not every treatment occurs in every block. In fact, we have <span class="math inline">\(n_{11} = n_{12} = n_{13} = 1\)</span>, <span class="math inline">\(n_{14} = 0\)</span>, <span class="math inline">\(n_{21} = n_{22} =n_{24} = 1\)</span>, <span class="math inline">\(n_{23} = 0\)</span>, <span class="math inline">\(n_{31} = n_{33} =n_{34} = 1\)</span>, <span class="math inline">\(n_{32} = 0\)</span>, <span class="math inline">\(n_{41} = 0\)</span> and <span class="math inline">\(n_{42} = n_{43} =n_{44} = 1\)</span>.</p>
<p>Writing model <a href="blocking.html#eq:block-model">(3.1)</a> is matrix form as a partitioned linear model, we obtain</p>
<p><span class="math display" id="eq:block-plm">\[\begin{equation}
\boldsymbol{y}= \mu\boldsymbol{1}_n + X_1\boldsymbol{\beta} + X_2\boldsymbol{\tau} + \boldsymbol{\varepsilon}\,,
\tag{3.2}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\boldsymbol{y}\)</span> the <span class="math inline">\(n\)</span>-vector of responses, <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span> <span class="math inline">\(n\times b\)</span> and <span class="math inline">\(n\times t\)</span> model matrices for blocks and treatments, respectively, <span class="math inline">\(\boldsymbol{\beta} = (\beta_1,\ldots, \beta_b)^{\mathrm{T}}\)</span>, <span class="math inline">\(\boldsymbol{\tau} = (\tau_1,\ldots, \tau_t)^{\mathrm{T}}\)</span> and <span class="math inline">\(\boldsymbol{\varepsilon}\)</span> the <span class="math inline">\(n\)</span>-vector of errors.</p>
<p>In equation<a href="blocking.html#eq:block-plm">(3.2)</a>, assuming without loss of generality that runs of the experiment are ordered by block, the matrix <span class="math inline">\(X_1\)</span> has the form</p>
<p><span class="math display">\[
X_1 = \bigoplus_{i = 1}^b \boldsymbol{1}_{k_i} = \begin{bmatrix}
\boldsymbol{1}_{k_1} &amp; \boldsymbol{0}_{k_1} &amp; \cdots &amp;  \boldsymbol{0}_{k_1} \\
\boldsymbol{0}_{k_2} &amp; \boldsymbol{1}_{k_2} &amp; \cdots &amp;  \boldsymbol{0}_{k_2} \\
\vdots &amp; &amp; \ddots &amp; \vdots \\
\boldsymbol{0}_{k_b} &amp; \boldsymbol{0}_{k_b} &amp; \cdots &amp;  \boldsymbol{1}_{k_b} \\
\end{bmatrix}\,,
\]</span>
where <span class="math inline">\(k_i = \sum_{j=1}^t n_{ij}\)</span>, the number of units in the <span class="math inline">\(i\)</span>th block. The structure of matrix <span class="math inline">\(X_2\)</span> is harder to describe so distinctly, but each row includes a single non-zero entry, equal to one, indicating which treatment was applied in that run of the experiment. The first <span class="math inline">\(k_1\)</span> rows correspond to block 1, the second <span class="math inline">\(k_2\)</span> to block 2, and so on. We will see special cases later.</p>
</div>
<div id="normal-equations" class="section level2">
<h2><span class="header-section-number">3.2</span> Normal equations</h2>
<p>Writing as a partitioned model <span class="math inline">\(\boldsymbol{y}= W\boldsymbol{\alpha} + \boldsymbol{\varepsilon}\)</span>, with <span class="math inline">\(W = [\boldsymbol{1} | X_1 | X_2]\)</span> and <span class="math inline">\(\boldsymbol{\alpha}^{\mathrm{T}} = [\mu | \boldsymbol{\beta}^{\mathrm{T}} | \boldsymbol{\tau}^{\mathrm{T}}]\)</span>, the least squares normal equations</p>
<p><span class="math display" id="eq:bne">\[\begin{equation}
W^{\mathrm{T}}W \hat{\boldsymbol{\alpha}} = W^{\mathrm{T}}\boldsymbol{y}
\tag{3.3}
\end{equation}\]</span></p>
<p>can be written as a set of three matrix equations:</p>
<p><span class="math display" id="eq:blocks-normal-3" id="eq:blocks-normal-2" id="eq:blocks-normal-1">\[\begin{align}
n\hat{\mu} + \boldsymbol{1}_n^{\mathrm{T}}X_1\hat{\boldsymbol{\beta}} + \boldsymbol{1}_n^{\mathrm{T}}X_2\hat{\boldsymbol{\tau}} &amp; = \boldsymbol{1}_n^{\mathrm{T}}\boldsymbol{y}\,, \tag{3.4}\\
X_1^{\mathrm{T}}\boldsymbol{1}_n\hat{\mu} + X_1^{\mathrm{T}}X_1\hat{\boldsymbol{\beta}} + X_1^{\mathrm{T}}X_2\hat{\boldsymbol{\tau}} &amp; = X_1^{\mathrm{T}}\boldsymbol{y}\,, \tag{3.5}\\
X_2^{\mathrm{T}}\boldsymbol{1}_n\hat{\mu} + X_2^{\mathrm{T}}X_1\hat{\boldsymbol{\beta}} + X_2^{\mathrm{T}}X_2\hat{\boldsymbol{\tau}} &amp; = X_2^{\mathrm{T}}\boldsymbol{y}\,. \tag{3.6}\\
\end{align}\]</span></p>
<p>Above, the matrices <span class="math inline">\(X_1^{\mathrm{T}}X_1 = \mathrm{diag}(k_1,\ldots,k_b)\)</span> and <span class="math inline">\(X_2^{\mathrm{T}}X_2 = \mathrm{diag}(n_1,\ldots,n_t)\)</span> have simple forms as diagonal matrices with entries equal to the size of each block and the number of replications of each treatment, respectively.</p>
<p>The <span class="math inline">\(t\times b\)</span> matrix <span class="math inline">\(N = X_2^{\mathcal{T}}X_1\)</span> is particularly important in block designs, and is called the <strong>incidence</strong> matrix. Each of the <span class="math inline">\(i\)</span>th row of <span class="math inline">\(N\)</span> indicates in which blocks the <span class="math inline">\(i\)</span>th treatment occurs.</p>
<p>We can eliminate the explicit dependence on <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\boldsymbol{\beta}\)</span> to find reduced normal equations for <span class="math inline">\(\boldsymbol{\tau}\)</span> by multiplying the middle equation by <span class="math inline">\(X_2^{\mathrm{T}}X_1(X_1^{\mathrm{T}}X_1)^{-1}\)</span>:</p>
<p><span class="math display">\[\begin{multline}
X_2^{\mathrm{T}}X_1(X_1^{\mathrm{T}}X_1)^{-1}X_1^{\mathrm{T}}\boldsymbol{1}_n\hat{\mu} + X_2^{\mathrm{T}}X_1(X_1^{\mathrm{T}}X_1)^{-1}X_1^{\mathrm{T}}X_1\hat{\boldsymbol{\beta}} + X_2^{\mathrm{T}}X_1(X_1^{\mathrm{T}}X_1)^{-1}X_1^{\mathrm{T}}X_2\hat{\boldsymbol{\tau}} \\
 = X_2^{\mathrm{T}}X_1(X_1^{\mathrm{T}}X_1)^{-1}X_1^{\mathrm{T}}\boldsymbol{1}_n\hat{\mu} + X_2^{\mathrm{T}}X_1\hat{\boldsymbol{\beta}} + X_2^{\mathrm{T}}X_1(X_1^{\mathrm{T}}X_1)^{-1}X_1^{\mathrm{T}}X_2\hat{\boldsymbol{\tau}} \\
 = X_2^{\mathrm{T}}X_1(X_1^{\mathrm{T}}X_1)^{-1}X_1^{\mathrm{T}}\boldsymbol{y}\\
\end{multline}\]</span></p>
<p>and subtracting from the final equation:</p>
<p><span class="math display">\[\begin{multline}
X_2^{\mathrm{T}}\left(\boldsymbol{1}_n - X_1(X_1^{\mathrm{T}}X_1)^{-1}X_1^{\mathrm{T}}\boldsymbol{1}_n\right)\hat{\mu} + \left(X_2^{\mathrm{T}}X_1 - X_2^{\mathrm{T}}X_1\right)\boldsymbol{\beta} \\ + X_2^{\mathrm{T}}\left(I_n - X_1(X_1^{\mathrm{T}}X_1)^{-1}X_1^{\mathrm{T}}\right)X_2\boldsymbol{\tau}\\
= X_2^{\mathrm{T}}\left(I_n - X_1(X_1^{\mathrm{T}}X_1)^{-1}X_1^{\mathrm{T}}\right)\boldsymbol{y}\,.
\end{multline}\]</span>
Clearly, a zero matrix is multiplying the block effects <span class="math inline">\(\boldsymbol{\beta}\)</span>. Also,</p>
<p><span class="math display">\[
X_1(X_1^{\mathrm{T}}X_1)^{-1}X_1^{\mathrm{T}}\boldsymbol{1}_n = \boldsymbol{1}_n\,,
\]</span>
as</p>
<p><span class="math display">\[
X_1(X_1^{\mathrm{T}}X_1)^{-1} = \bigoplus_{i = 1}^b \frac{1}{k_i}\boldsymbol{1}_{k_i} = \begin{bmatrix}
\frac{1}{k_1}\boldsymbol{1}_{k_1} &amp; \boldsymbol{0}_{k_1} &amp; \cdots &amp;  \boldsymbol{0}_{k_1} \\
\boldsymbol{0}_{k_2} &amp; \frac{1}{k_2}\boldsymbol{1}_{k_2} &amp; \cdots &amp;  \boldsymbol{0}_{k_2} \\
\vdots &amp; &amp; \ddots &amp; \vdots \\
\boldsymbol{0}_{k_b} &amp; \boldsymbol{0}_{k_b} &amp; \cdots &amp;  \frac{1}{k_b}\boldsymbol{1}_{k_b} \\
\end{bmatrix}\,,
\]</span>
and hence</p>
<p><span class="math display">\[
X_1(X_1^{\mathrm{T}}X_1)^{-1}X_1^{\mathrm{T}} = \bigoplus_{i = 1}^b \frac{1}{k_i}J_{k_i} = \begin{bmatrix}
\frac{1}{k_1}J_{k_1} &amp; \boldsymbol{0}_{k_1\times k_2} &amp; \cdots &amp;  \boldsymbol{0}_{k_1\times k_b} \\
\boldsymbol{0}_{k_2\times k_1} &amp; \frac{1}{k_2}J_{k_2} &amp; \cdots &amp;  \boldsymbol{0}_{k_2\times k_b} \\
\vdots &amp; &amp; \ddots &amp; \vdots \\
\boldsymbol{0}_{k_b\times k_1} &amp; \boldsymbol{0}_{k_b\times k_2} &amp; \cdots &amp;  \frac{1}{k_b}J_{k_b} \\
\end{bmatrix}\,.
\]</span></p>
<p>Writing <span class="math inline">\(H_1 = X_1(X_1^{\mathrm{T}}X_1)^{-1}X_1^{\mathrm{T}}\)</span>, we then get the reduced normal equations for <span class="math inline">\(\boldsymbol{\tau}\)</span>:</p>
<p><span class="math display" id="eq:block-rne">\[\begin{equation}
X_2^{\mathrm{T}}\left(I_n - H_1\right)X_2\boldsymbol{\tau}= X_2^{\mathrm{T}}\left(I_n - H_1\right)\boldsymbol{y}\,.
\tag{3.7}
\end{equation}\]</span></p>
<p>We can demonstrate the form of these matrices through our two examples.</p>
<p>For Example <a href="blocking.html#exm:blocks-bars">3.1</a>:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="blocking.html#cb62-1"></a>one &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb62-2"><a href="blocking.html#cb62-2"></a>X1 &lt;-<span class="st"> </span><span class="kw">kronecker</span>(<span class="kw">diag</span>(<span class="dv">1</span>, <span class="dt">nrow =</span> <span class="dv">8</span>), one)</span>
<span id="cb62-3"><a href="blocking.html#cb62-3"></a>X2 &lt;-<span class="st"> </span><span class="kw">diag</span>(<span class="dv">1</span>, <span class="dt">nrow =</span> <span class="dv">4</span>)</span>
<span id="cb62-4"><a href="blocking.html#cb62-4"></a>X2 &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&quot;rbind&quot;</span>, <span class="kw">replicate</span>(<span class="dv">8</span>, X2, <span class="dt">simplify =</span> <span class="ot">FALSE</span>))</span>
<span id="cb62-5"><a href="blocking.html#cb62-5"></a><span class="co">#incidence matrix</span></span>
<span id="cb62-6"><a href="blocking.html#cb62-6"></a>N &lt;-<span class="st"> </span><span class="kw">t</span>(X2) <span class="op">%*%</span><span class="st"> </span>X1</span>
<span id="cb62-7"><a href="blocking.html#cb62-7"></a>X1tX1 &lt;-<span class="st"> </span><span class="kw">t</span>(X1) <span class="op">%*%</span><span class="st"> </span>X1 <span class="co"># diagonal</span></span>
<span id="cb62-8"><a href="blocking.html#cb62-8"></a>X2tX2 &lt;-<span class="st"> </span><span class="kw">t</span>(X2) <span class="op">%*%</span><span class="st"> </span>X2 <span class="co"># diagonal</span></span>
<span id="cb62-9"><a href="blocking.html#cb62-9"></a>H1 &lt;-<span class="st"> </span>X1 <span class="op">%*%</span><span class="st"> </span><span class="kw">solve</span>(<span class="kw">t</span>(X1) <span class="op">%*%</span><span class="st"> </span>X1) <span class="op">%*%</span><span class="st"> </span><span class="kw">t</span>(X1)</span>
<span id="cb62-10"><a href="blocking.html#cb62-10"></a>ones &lt;-<span class="st"> </span>H1 <span class="op">%*%</span><span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">32</span>) <span class="co"># H1 times vector of 1s is also a vector of 1s</span></span>
<span id="cb62-11"><a href="blocking.html#cb62-11"></a>A &lt;-<span class="st"> </span><span class="kw">t</span>(X2) <span class="op">%*%</span><span class="st"> </span>X2 <span class="op">-</span><span class="st"> </span><span class="kw">t</span>(X2) <span class="op">%*%</span><span class="st"> </span>H1 <span class="op">%*%</span><span class="st"> </span>X2 <span class="co"># X2t(I - H1)X2</span></span>
<span id="cb62-12"><a href="blocking.html#cb62-12"></a><span class="kw">qr</span>(A)<span class="op">$</span>rank <span class="co"># rank 3</span></span>
<span id="cb62-13"><a href="blocking.html#cb62-13"></a>X2tH1 &lt;-<span class="st"> </span><span class="kw">t</span>(X2) <span class="op">%*%</span><span class="st"> </span>H1 <span class="co"># adjustment to y</span></span>
<span id="cb62-14"><a href="blocking.html#cb62-14"></a>W &lt;-<span class="st"> </span><span class="kw">cbind</span>(ones, X1, X2) <span class="co"># overall model matrix</span></span>
<span id="cb62-15"><a href="blocking.html#cb62-15"></a><span class="kw">qr</span>(W)<span class="op">$</span>rank <span class="co"># rank 11 (t+b - 1)</span></span></code></pre></div>
<p>For Example <a href="blocking.html#exm:blocks-tyres">3.2</a>:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="blocking.html#cb63-1"></a>one &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb63-2"><a href="blocking.html#cb63-2"></a>X1 &lt;-<span class="st"> </span><span class="kw">kronecker</span>(<span class="kw">diag</span>(<span class="dv">1</span>, <span class="dt">nrow =</span> <span class="dv">4</span>), one)</span>
<span id="cb63-3"><a href="blocking.html#cb63-3"></a>X2 &lt;-<span class="st"> </span><span class="kw">matrix</span>(</span>
<span id="cb63-4"><a href="blocking.html#cb63-4"></a>        <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb63-5"><a href="blocking.html#cb63-5"></a>          <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb63-6"><a href="blocking.html#cb63-6"></a>          <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>,</span>
<span id="cb63-7"><a href="blocking.html#cb63-7"></a>          <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb63-8"><a href="blocking.html#cb63-8"></a>          <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb63-9"><a href="blocking.html#cb63-9"></a>          <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>,</span>
<span id="cb63-10"><a href="blocking.html#cb63-10"></a>          <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb63-11"><a href="blocking.html#cb63-11"></a>          <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>,</span>
<span id="cb63-12"><a href="blocking.html#cb63-12"></a>          <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>,</span>
<span id="cb63-13"><a href="blocking.html#cb63-13"></a>          <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb63-14"><a href="blocking.html#cb63-14"></a>          <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>,</span>
<span id="cb63-15"><a href="blocking.html#cb63-15"></a>          <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">nrow =</span> <span class="dv">12</span>, <span class="dt">byrow =</span> T</span>
<span id="cb63-16"><a href="blocking.html#cb63-16"></a>)</span>
<span id="cb63-17"><a href="blocking.html#cb63-17"></a><span class="co">#incidence matrix</span></span>
<span id="cb63-18"><a href="blocking.html#cb63-18"></a>N &lt;-<span class="st"> </span><span class="kw">t</span>(X2) <span class="op">%*%</span><span class="st"> </span>X1</span>
<span id="cb63-19"><a href="blocking.html#cb63-19"></a>X1tX1 &lt;-<span class="st"> </span><span class="kw">t</span>(X1) <span class="op">%*%</span><span class="st"> </span>X1 <span class="co"># diagonal</span></span>
<span id="cb63-20"><a href="blocking.html#cb63-20"></a>X2tX2 &lt;-<span class="st"> </span><span class="kw">t</span>(X2) <span class="op">%*%</span><span class="st"> </span>X2 <span class="co"># diagonal</span></span>
<span id="cb63-21"><a href="blocking.html#cb63-21"></a>H1 &lt;-<span class="st"> </span>X1 <span class="op">%*%</span><span class="st"> </span><span class="kw">solve</span>(<span class="kw">t</span>(X1) <span class="op">%*%</span><span class="st"> </span>X1) <span class="op">%*%</span><span class="st"> </span><span class="kw">t</span>(X1)</span>
<span id="cb63-22"><a href="blocking.html#cb63-22"></a>ones &lt;-<span class="st"> </span>H1 <span class="op">%*%</span><span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">12</span>) <span class="co"># H1 times vector of 1s is also a vector of 1s</span></span>
<span id="cb63-23"><a href="blocking.html#cb63-23"></a>A &lt;-<span class="st"> </span><span class="kw">t</span>(X2) <span class="op">%*%</span><span class="st"> </span>X2 <span class="op">-</span><span class="st"> </span><span class="kw">t</span>(X2) <span class="op">%*%</span><span class="st"> </span>H1 <span class="op">%*%</span><span class="st"> </span>X2 <span class="co"># X2t(I - H1)X2</span></span>
<span id="cb63-24"><a href="blocking.html#cb63-24"></a><span class="kw">qr</span>(A)<span class="op">$</span>rank <span class="co"># rank 3</span></span>
<span id="cb63-25"><a href="blocking.html#cb63-25"></a>X2tH1 &lt;-<span class="st"> </span><span class="kw">t</span>(X2) <span class="op">%*%</span><span class="st"> </span>H1 <span class="co"># adjustment to y</span></span>
<span id="cb63-26"><a href="blocking.html#cb63-26"></a>W &lt;-<span class="st"> </span><span class="kw">cbind</span>(ones, X1, X2) <span class="co"># overall model matrix</span></span>
<span id="cb63-27"><a href="blocking.html#cb63-27"></a><span class="kw">qr</span>(W)<span class="op">$</span>rank <span class="co"># rank 7 (t+b - 1)</span></span></code></pre></div>
<p>Notice that if we write <span class="math inline">\(X_{2|1} = (I_n - H_1)X_2\)</span>, then the reduced normal equations become</p>
<p><span class="math display">\[
X_{2|1}^{\mathrm{T}}X_{2|1}\boldsymbol{\tau} = X_{2|1}^{\mathrm{T}}\boldsymbol{y}\,,
\]</span>
which have the same form as the CRD in Chapter <a href="crd.html#crd">2</a> albeit with a different <span class="math inline">\(X_{2|1}\)</span> matrix as we are adjusting for more complex nuisance parameters.</p>
<p>In general, the solution of these equations will depend on the exact form of the design. For the randomised complete block design, the solution turns out to be straighforward (see Section @ref(#rcdb) below). By default, to fit model <a href="blocking.html#eq:block-plm">(3.2)</a>, the <code>lm</code> function in <code>R</code> applies the constraint <span class="math inline">\(\tau_t = \beta_b = 0\)</span>, and removes the corresponding columns from <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span>, to leave a <span class="math inline">\(W\)</span> matrix with full column rank. Clearly, this solution is not unique but, as with CRDs, we will identify uniquely estimatable combinations of the model parameters (and use <code>emmeans</code> to extract these estimates from an <code>lm</code> object).</p>
</div>
<div id="block-anova" class="section level2">
<h2><span class="header-section-number">3.3</span> Analysis of variance</h2>
<p>As was the case with the CRD, it can be shown that any solution to the normal equations <a href="blocking.html#eq:bne">(3.3)</a> will produce a unique solution to <span class="math inline">\(\widehat{W\alpha}\)</span>, and hence a unique analysis of variance decomposition can be obtained.</p>
<p>For a block experiment, the ANOVA table is comparing the full model <a href="blocking.html#eq:block-plm">(3.2)</a>, the model containing the block effects</p>
<p><span class="math display" id="eq:anova-bm">\[\begin{equation}
\boldsymbol{y}= \mu\boldsymbol{1} + X_1\boldsymbol{\beta} + \boldsymbol{\varepsilon}
\tag{3.8}
\end{equation}\]</span></p>
<p>and the null model</p>
<p><span class="math display" id="eq:anova-nm">\[\begin{equation}
\boldsymbol{y}= \mu\boldsymbol{1} + \boldsymbol{\varepsilon}\,,
\tag{3.9}
\end{equation}\]</span></p>
<p>and has the form:</p>
<table>
<colgroup>
<col width="12%" />
<col width="36%" />
<col width="30%" />
<col width="22%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Source</th>
<th align="center">Degrees of freedom</th>
<th align="left">Sums of squares</th>
<th align="left">Mean square</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Blocks</td>
<td align="center"><span class="math inline">\(b-1\)</span></td>
<td align="left">RSS <a href="blocking.html#eq:anova-nm">(3.9)</a> - RSS <a href="blocking.html#eq:anova-bm">(3.8)</a></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Treatments</td>
<td align="center"><span class="math inline">\(t-1\)</span></td>
<td align="left">RSS <a href="blocking.html#eq:anova-bm">(3.8)</a> - RSS <a href="blocking.html#eq:block-plm">(3.2)</a></td>
<td align="left">[RSS <a href="blocking.html#eq:anova-bm">(3.8)</a> - RSS <a href="blocking.html#eq:block-plm">(3.2)</a>] / <span class="math inline">\((t-1)\)</span></td>
</tr>
<tr class="odd">
<td align="left">Residual</td>
<td align="center"><span class="math inline">\(n - b - t + 1\)</span></td>
<td align="left">RSS <a href="blocking.html#eq:block-plm">(3.2)</a></td>
<td align="left">RSS <a href="blocking.html#eq:block-plm">(3.2)</a> / <span class="math inline">\((n - b - t + 1)\)</span></td>
</tr>
<tr class="even">
<td align="left">Total</td>
<td align="center"><span class="math inline">\(n - 1\)</span></td>
<td align="left">RSS <a href="blocking.html#eq:anova-nm">(3.9)</a></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p>We test the hypothesis <span class="math inline">\(H_0: \tau_1 = \cdots = \tau_t = 0\)</span> at the <span class="math inline">\(100\alpha\)</span>% significance level by comparing the ratio of treatment and residual mean squares to the <span class="math inline">\(1-\alpha\)</span> quantile of an <span class="math inline">\(F\)</span> distribution with <span class="math inline">\(t-1\)</span> and <span class="math inline">\(n-b-t+1\)</span> degrees of freedom.</p>
<p>For Example <a href="blocking.html#exm:blocks-bars">3.1</a>, we obtain the following ANOVA.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="blocking.html#cb64-1"></a>bar.lm &lt;-<span class="st"> </span><span class="kw">lm</span>(strength <span class="op">~</span><span class="st"> </span>block <span class="op">+</span><span class="st"> </span>coating, <span class="dt">data =</span> bar)</span>
<span id="cb64-2"><a href="blocking.html#cb64-2"></a><span class="kw">anova</span>(bar.lm)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: strength
##           Df Sum Sq Mean Sq F value Pr(&gt;F)   
## block      7    215      31    0.55 0.7903   
## coating    3   1310     437    7.75 0.0011 **
## Residuals 21   1184      56                  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Clearly, the null hypothesis of no treatment effect is rejected. The <code>anova</code> function also compares the block mean square to the residual mean square to perform a test of the hypothesis <span class="math inline">\(H_0: \beta_1 = \cdots = \beta_b = 0\)</span>. This is not a hypothesis that should usually be tested. The blocks are a nuisance factor and are generally a feature of the experimental process that has not been subject to randomisation; we are not interested in testing for block-to-block differences.<a href="#fn20" class="footnote-ref" id="fnref20"><sup>20</sup></a></p>
<p>For Example <a href="blocking.html#exm:blocks-tyres">3.2</a>, we get the ANOVA table:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="blocking.html#cb66-1"></a>tyre.lm &lt;-<span class="st"> </span><span class="kw">lm</span>(wear <span class="op">~</span><span class="st"> </span>block <span class="op">+</span><span class="st"> </span>compound, <span class="dt">data =</span> tyre)</span>
<span id="cb66-2"><a href="blocking.html#cb66-2"></a><span class="kw">anova</span>(tyre.lm)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: wear
##           Df Sum Sq Mean Sq F value  Pr(&gt;F)    
## block      3  39123   13041    37.2 0.00076 ***
## compound   3  20729    6910    19.7 0.00335 ** 
## Residuals  5   1751     350                    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Again, the null hypothesis is rejected, and hence we should investigate which tyre compounds differ in their mean response.</p>
<p>The residual mean square for model <a href="blocking.html#eq:block-plm">(3.2)</a> also provides an unbiased estimate, <span class="math inline">\(s^2\)</span>, of <span class="math inline">\(\sigma^2\)</span>, the variability of the <span class="math inline">\(\varepsilon_{ijl}\)</span>, <em>assuming the unit-block-treatment model is correct</em>. For Example <a href="blocking.html#exm:blocks-bars">3.1</a>,
<span class="math inline">\(s^2 = 56.3869\)</span> and for Example <a href="blocking.html#exm:blocks-tyres">3.2</a>, <span class="math inline">\(s^2 = 350.1833\)</span>.</p>
</div>
<div id="rcdb" class="section level2">
<h2><span class="header-section-number">3.4</span> Randomised complete block designs</h2>
<p>A randomised complete block design (RCBD) has each treatment replicated exactly once in each block, that is <span class="math inline">\(n_{ij} = 1\)</span> for <span class="math inline">\(i=1,\ldots, b; j = 1, \ldots, t\)</span>. Therefore each block has common size <span class="math inline">\(k_1=\cdots =k_b = t\)</span>. The <span class="math inline">\(t\)</span> treatments are randomised to the <span class="math inline">\(t\)</span> units in each block. We can drop the index <span class="math inline">\(l\)</span> from our unit-block-treatment model, as every treatment is replicated just once:</p>
<p><span class="math display">\[\begin{equation*}
y_{ij} = \mu + \beta_i + \tau_j + \varepsilon_{ij}\,, \qquad i = 1,\ldots, b; j = 1, \ldots, t\,.
\end{equation*}\]</span></p>
<p>For an RCBD, the matrix <span class="math inline">\(X_{2|1}\)</span> has the form</p>
<p><span class="math display" id="eq:rcbd-x21">\[\begin{align}
X_{2|1} &amp; = (I_n - H_1)X_2 \nonumber \\
&amp; = X_2 - H_1X_2 \nonumber \\
&amp; = X_2 - \frac{1}{t}J_{n \times t} \tag{3.10}\,,
\end{align}\]</span></p>
<p>following from the fact that</p>
<p><span class="math display">\[\begin{align}
H_1X_2 &amp; = X_1(X_1^{\mathrm{T}}X_1)^{-1}X_1^{\mathrm{T}}X_2 \\
&amp; = \frac{1}{t}X_1X_1^{\mathrm{T}}X_2 \\
&amp; = \frac{1}{t}X_1N^{\mathrm{T}} \\
&amp; = \frac{1}{t}X_1J_{b\times t} \\
&amp; = \frac{1}{t}J_{n\times t}\,,
\end{align}\]</span></p>
<p>as for a RCBD <span class="math inline">\(X_1^{\mathrm{T}}X_1 = \mathrm{diag}(k_1,\ldots, k_b) = tI_b\)</span> and <span class="math inline">\(X_2^{\mathrm{T}}X_1 = N = J_{t\times b}\)</span>.</p>
<p>Comparing <a href="blocking.html#eq:rcbd-x21">(3.10)</a> to the form of <span class="math inline">\(X_{2|1}\)</span> for a CRD, equation <a href="crd.html#eq:crd-x21">(2.6)</a>, we see that for the RCBD, <span class="math inline">\(X_{2|1}\)</span> has the same form as a CRD with <span class="math inline">\(b\)</span> replicates of each treatment (that is, <span class="math inline">\(n_i = b\)</span> for <span class="math inline">\(i=1,\ldots, t\)</span>). This is a powerful result, as it tell us</p>
<ul>
<li><p>The reduced normal equations for the RCBD take the same form as for the CRD,</p>
<p><span class="math display">\[
  \hat{\tau}_j - \hat{\tau}_w = \bar{y}_{.j} - \bar{y}_{..}\,,
\]</span></p>
<p>with <span class="math inline">\(\hat{\tau}_w = \frac{1}{t}\sum_{j=1}^t\hat{\tau}_j\)</span>, <span class="math inline">\(\bar{y}_{.j} = \frac{1}{b}\sum_{i=1}^b y_{ij}\)</span> and <span class="math inline">\(\bar{y}_{..} = \frac{1}{n}\sum_{i=1}^b\sum_{j=1}^t y_{ij}\)</span>. Hence, as with a CRD, we can estimate any contrast <span class="math inline">\(\boldsymbol{c}^{\mathrm{T}}\boldsymbol{\tau}\)</span>, having <span class="math inline">\(\sum_{j=1}^tc_j = 0\)</span>, with estimator</p>
<p><span class="math display">\[
\widehat{\boldsymbol{c}^{\mathrm{T}}\boldsymbol{\tau}} = \sum_{j=1}^tc_j\bar{y}_{.j}\,.
\]</span></p>
<p>Hence, the <strong>point estimate</strong> for a contrast <span class="math inline">\(\boldsymbol{c}^{\mathrm{T}}\boldsymbol{\tau}\)</span> is exactly the same as would be obtained by ignoring blocks and treating the experiment as a CRD with <span class="math inline">\(n = bt\)</span> and <span class="math inline">\(n_i = b\)</span>, for <span class="math inline">\(i=1,\ldots, t\)</span>.</p></li>
<li><p>Inference for a contrast takes exactly the same form as for a CRD (Section <a href="crd.html#contrast-crd">2.5</a>), with in particular:</p>
<p><span class="math display">\[
\mathrm{var}\left(\widehat{\boldsymbol{c}^{\mathrm{T}}\boldsymbol{\tau}}\right) = \frac{\sigma^2}{b}\sum_{j=1}^tc_j^2\,,
\]</span></p>
<p>and</p>
<p><span class="math display">\[
  \widehat{\boldsymbol{c}^{\mathrm{T}}\boldsymbol{\tau}} \sim N\left(\boldsymbol{c}^{\mathrm{T}}\boldsymbol{\tau}, \frac{\sigma^2}{b}\sum_{j=1}^t c_j^2\right)\,.
\]</span></p></li>
</ul>
<p>Although these equations have the same form as for a CRD, note that <span class="math inline">\(\sigma^2\)</span> is representing different quantities in each case.</p>
<ul>
<li><p>In a CRD, <span class="math inline">\(\sigma^2\)</span> is the uncontrolled variation in the response <em>among all experimental units</em>.</p></li>
<li><p>In a RCBD, <span class="math inline">\(\sigma^2\)</span> is the uncontrolled variation in the response <em>among all units within a common block</em>.</p></li>
</ul>
<p>Block-to-block differences are modelled via inclusion of the block effects <span class="math inline">\(\beta_i\)</span> in the model, and hence if blocking is effective, we would expect <span class="math inline">\(\sigma^2\)</span> from a RCBD to be substantially smaller than from a corresponding CRD with <span class="math inline">\(n_i = b\)</span>.</p>
<p>Example <a href="blocking.html#exm:blocks-bars">3.1</a> is a RCBD. We can estimate the contrasts</p>
<p><span class="math display">\[
\tau_{1} - \tau_{2} \\
\tau_{1} - \tau_{3} \\
\tau_{1} - \tau_{4} \\
\]</span></p>
<p>between coatings<a href="#fn21" class="footnote-ref" id="fnref21"><sup>21</sup></a> using <code>emmeans</code>.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="blocking.html#cb68-1"></a>bar.emm &lt;-<span class="st"> </span>emmeans<span class="op">::</span><span class="kw">emmeans</span>(bar.lm, <span class="op">~</span><span class="st"> </span>coating)</span>
<span id="cb68-2"><a href="blocking.html#cb68-2"></a>contrastv1.emmc &lt;-<span class="st"> </span><span class="cf">function</span>(levs)</span>
<span id="cb68-3"><a href="blocking.html#cb68-3"></a>  <span class="kw">data.frame</span>(<span class="st">&#39;t1 v t2&#39;</span> =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">-1</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="st">&#39;t1 v t3&#39;</span> =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">-1</span>, <span class="dv">0</span>), </span>
<span id="cb68-4"><a href="blocking.html#cb68-4"></a>  <span class="st">&#39;t1 v t4&#39;</span> =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">-1</span>))</span>
<span id="cb68-5"><a href="blocking.html#cb68-5"></a>emmeans<span class="op">::</span><span class="kw">contrast</span>(bar.emm, <span class="st">&#39;contrastv1&#39;</span>)</span></code></pre></div>
<pre><code>##  contrast estimate   SE df t.ratio p.value
##  t1.v.t2     -1.25 3.75 21  -0.333  0.7425
##  t1.v.t3     15.00 3.75 21   3.995  0.0007
##  t1.v.t4      4.00 3.75 21   1.065  0.2988
## 
## Results are averaged over the levels of: block</code></pre>
<p>It is important to once again adjust for mulitple comparisons. Here we can use a Bonferroni adjustment, and multiply each p-value by the number of tests (3). We obtain p-values of 1 (coating 1 versus 2), 0.002 (1 versus 3) and 0.8964 (2 versus 3). Hence, there is a significant difference between coatings 1 and 3, with <span class="math inline">\(H_0: \tau_1 = \tau_3\)</span> rejected at the 1% significant level.</p>
<p>We can demonstrate the equivalence of the contrast point estimates between a RCBD and a CRD by fitting a unit-treatment model that ignores blocks:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="blocking.html#cb70-1"></a>bar_crd.lm &lt;-<span class="st"> </span><span class="kw">lm</span>(strength <span class="op">~</span><span class="st"> </span>coating, <span class="dt">data =</span> bar)</span>
<span id="cb70-2"><a href="blocking.html#cb70-2"></a>bar_crd.emm &lt;-<span class="st"> </span>emmeans<span class="op">::</span><span class="kw">emmeans</span>(bar_crd.lm, <span class="op">~</span><span class="st"> </span>coating)</span>
<span id="cb70-3"><a href="blocking.html#cb70-3"></a>emmeans<span class="op">::</span><span class="kw">contrast</span>(bar_crd.emm, <span class="st">&#39;contrastv1&#39;</span>)</span></code></pre></div>
<pre><code>##  contrast estimate   SE df t.ratio p.value
##  t1.v.t2     -1.25 3.54 28  -0.354  0.7263
##  t1.v.t3     15.00 3.54 28   4.243  0.0002
##  t1.v.t4      4.00 3.54 28   1.132  0.2674</code></pre>
<p>As expected the point estimates of the three contrasts are identical. In this case, the standard error of each contrast is actually smaller assuming a CRD without blocks, suggesting block-to-block differences were actually small here (further evidence is provided by the small block sums of squares in the ANOVA table). Here the estimate of <span class="math inline">\(\sigma\)</span> from the RCBD is <span class="math inline">\(s_{RCBD} = 7.5091\)</span> and from the CRD is <span class="math inline">\(s_{CRD} = 7.0698\)</span>, so for this example the unit-to-unit variation within and between blocks is not so different, and actually estimated to be slightly smaller in the CRD<a href="#fn22" class="footnote-ref" id="fnref22"><sup>22</sup></a>.</p>
</div>
<div id="blocks-orthogonal" class="section level2">
<h2><span class="header-section-number">3.5</span> Orthogonal blocking</h2>
<p>The equality of the point estimates from the RCBD and the CRD is a consequence of the block and treatment parameters in model <a href="blocking.html#eq:block-model">(3.1)</a> being <strong>orthogonal</strong>. That is, the least squares estimators for <span class="math inline">\(\boldsymbol{\beta}\)</span> and <span class="math inline">\(\boldsymbol{\tau}\)</span> are independent in the sense that the estimators obtained from model <a href="blocking.html#eq:block-plm">(3.2)</a> are the same as those obtained from the sub-models</p>
<p><span class="math display">\[
\boldsymbol{y}= \mu\boldsymbol{1}_n + X_1\boldsymbol{\beta} + \boldsymbol{\varepsilon}\,,
\]</span></p>
<p>and</p>
<p><span class="math display">\[
\boldsymbol{y}= \mu\boldsymbol{1}_n + X_2\boldsymbol{\tau} + \boldsymbol{\varepsilon}\,.
\]</span></p>
<p>That is, the presence or absence of the block parameters does not affect the estimator of the treatment parameters (and vice versa).</p>
<p>A condition for <span class="math inline">\(\boldsymbol{\beta}\)</span> and <span class="math inline">\(\boldsymbol{\tau}\)</span> to be estimated orthogonally can be derived from normal equations <a href="blocking.html#eq:blocks-normal-1">(3.4)</a> - <a href="blocking.html#eq:blocks-normal-2">(3.5)</a>. Firstly. we premultiply <a href="blocking.html#eq:blocks-normal-1">(3.4)</a> by <span class="math inline">\(\frac{1}{n}X_1^{\mathrm{T}}\boldsymbol{1}_n\)</span> and substract it from <a href="blocking.html#eq:blocks-normal-2">(3.5)</a>:</p>
<p><span class="math display" id="eq:blocks-orth-ne1">\[\begin{align}
 &amp; \left(X_1^{\mathrm{T}}\boldsymbol{1}_n - X_1^{\mathrm{T}}\boldsymbol{1}_n\right)\hat{\mu} + \left(X_1^{\mathrm{T}}X_1 - \frac{1}{n}X_1^{\mathrm{T}}\boldsymbol{1}_n\boldsymbol{1}_n^{\mathrm{T}}X_1\right)\hat{\boldsymbol{\beta}} + \left(X_1^{\mathrm{T}}X_2 - \frac{1}{n}X_1^{\mathrm{T}}\boldsymbol{1}_n\boldsymbol{1}_n^{\mathrm{T}}X_2\right)\hat{\boldsymbol{\tau}} \nonumber \\
 &amp; = X_1^{\mathrm{T}}\left(I_n - \frac{1}{n}J_n\right)X_1\hat{\boldsymbol{\beta}} + X_1^{\mathrm{T}}\left(I_n - \frac{1}{n}J_n\right)X_2\hat{\boldsymbol{\tau}} \nonumber \\
 &amp; =  X_1^{\mathrm{T}}\left(I_n - \frac{1}{n}J_n\right) \tag{3.11}\,.
\end{align}\]</span></p>
<p>Secondly, we premultiply <a href="blocking.html#eq:blocks-normal-1">(3.4)</a> by <span class="math inline">\(\frac{1}{n}X_2^{\mathrm{T}}\boldsymbol{1}_n\)</span> and substract it from <a href="blocking.html#eq:blocks-normal-3">(3.6)</a>:</p>
<p><span class="math display" id="eq:blocks-orth-ne2">\[\begin{equation}
X_2^{\mathrm{T}}\left(I_n - \frac{1}{n}J_n\right)X_1\hat{\boldsymbol{\beta}} + X_2^{\mathrm{T}}\left(I_n - \frac{1}{n}J_n\right)X_2\hat{\boldsymbol{\tau}} = X_2^{\mathrm{T}}\left(I_n - \frac{1}{n}J_n\right)\,.
\tag{3.12}
\end{equation}\]</span></p>
<p>For equations <a href="blocking.html#eq:blocks-orth-ne1">(3.11)</a> and <a href="blocking.html#eq:blocks-orth-ne2">(3.12)</a> to be independent, we require</p>
<p><span class="math display">\[
X_2^{\mathrm{T}}\left(I_n - \frac{1}{n}J_n\right)X_1 = \boldsymbol{0}_{t\times b}\,.
\]</span>
Hence, we obtain the following condition on the incidence matrix <span class="math inline">\(N = X_2^{\mathrm{T}}X_1\)</span> for a block design to be orthogonal:</p>
<p><span class="math display">\[\begin{align}
N &amp; = \frac{1}{n}X_2^{\mathrm{T}}J_nX_1 \\
&amp; = \frac{1}{n}\boldsymbol{n}\boldsymbol{k}^{\mathrm{T}}\,,
\end{align}\]</span></p>
<p>where <span class="math inline">\(\boldsymbol{n}^{\mathrm{T}} = (n_1,\ldots, n_t)\)</span> is the vector of treatment replications and <span class="math inline">\(\boldsymbol{k}^{\mathrm{T}} = (k_1,\ldots, k_b)\)</span> is the vector of block sizes.</p>
<p>The most common orthogonal block design for unstructured treatments is the RCBD, which has <span class="math inline">\(n = bt\)</span>, <span class="math inline">\(\boldsymbol{n} = b\boldsymbol{1}_t\)</span>, <span class="math inline">\(\boldsymbol{k} = t\boldsymbol{1}_b\)</span>, and</p>
<p><span class="math display">\[\begin{align}
N &amp; = J_{t \times b}
&amp; = \frac{1}{bt}\boldsymbol{n}\boldsymbol{k}^{\mathrm{T}}\,.
\end{align}\]</span></p>
<p>Hence, the condition for orthogonality is met. In an orthogonal design, such as a RCBD, all information about the treatment comparisons is contained in comparisons made within blocks. For more complex blocking structures, such as incomplete block designs, this is not the case. We shall see orthogonal blocking again in Chapter <a href="block-factorial.html#block-factorial">5</a>.</p>
</div>
<div id="balanced-incomplete-block-designs" class="section level2">
<h2><span class="header-section-number">3.6</span> Balanced incomplete block designs</h2>
<p>When the blocks sizes are less than the number of treatments, i.e. <span class="math inline">\(k_i &lt; t\)</span> for all <span class="math inline">\(i=1,\ldots, b\)</span>, by necessity the design is incomplete, in that not all treatments can be allocated to every block. We will restrict ourselves now to considering binary designs with common block size <span class="math inline">\(k&lt;t\)</span>. In a binary design, each treatment occurs within a block either 0 or 1 times (<span class="math inline">\(n_{ij}=0\)</span> or <span class="math inline">\(n_{ij}=1\)</span>).</p>
<p>Example <a href="blocking.html#exm:blocks-tyres">3.2</a> is an example of an incomplete design with <span class="math inline">\(k=3&lt;t=4\)</span>. For incomplete designs, it is often useful to study the <em>treatment concurrence</em> matrix, given by <span class="math inline">\(NN^{\mathrm{T}}\)</span>.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="blocking.html#cb72-1"></a>N &lt;-<span class="st"> </span><span class="kw">matrix</span>(</span>
<span id="cb72-2"><a href="blocking.html#cb72-2"></a>  <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>,</span>
<span id="cb72-3"><a href="blocking.html#cb72-3"></a>    <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>,</span>
<span id="cb72-4"><a href="blocking.html#cb72-4"></a>    <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span>
<span id="cb72-5"><a href="blocking.html#cb72-5"></a>    <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb72-6"><a href="blocking.html#cb72-6"></a>  <span class="dt">nrow =</span> <span class="dv">4</span>, <span class="dt">byrow =</span> T</span>
<span id="cb72-7"><a href="blocking.html#cb72-7"></a>)</span>
<span id="cb72-8"><a href="blocking.html#cb72-8"></a>N <span class="op">%*%</span><span class="st"> </span><span class="kw">t</span>(N)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    3    2    2    2
## [2,]    2    3    2    2
## [3,]    2    2    3    2
## [4,]    2    2    2    3</code></pre>
<p>This matrix has the number of treatment replications, <span class="math inline">\(n_j\)</span>, on the diagonal and the off-diagonal elements are equal to the number of blocks within which each pair of treatments occurs together. We will denote as <span class="math inline">\(\lambda_{ij}\)</span> the number of blocks that contain both treatment <span class="math inline">\(i\)</span> and treatment <span class="math inline">\(j\)</span> (<span class="math inline">\(i\ne j\)</span>). For Example <a href="blocking.html#exm:blocks-tyres">3.2</a>, <span class="math inline">\(\lambda_{ij} = 2\)</span> for all <span class="math inline">\(i,j = 1,\ldots, 4\)</span>; that is, each pair of treatments occurs together in two blocks.</p>
<div class="definition">
<p><span id="def:bibd" class="definition"><strong>Definition 3.1  </strong></span>A <strong>balanced incomplete block design</strong> (BIBD) is an incomplete block design with <span class="math inline">\(k&lt;t\)</span> that meets three requirements:</p>
<ol style="list-style-type: decimal">
<li><p>The design is binary.</p></li>
<li><p>Each treatment is applied to a unit in the same number of blocks. It follows that the common number of units applied to each treatment must be <span class="math inline">\(r = n_j = bk / t\)</span> (<span class="math inline">\(j=1,\ldots, t\)</span>), where <span class="math inline">\(n = bk\)</span>. (Sometimes referred to as first-order balance).</p></li>
<li><p>Each pair of treatments is applied to two units in the same number of blocks, that is <span class="math inline">\(\lambda_{ij} = \lambda\)</span>. (Sometimes referred to as second-order balance).</p>
<p>In fact, we can deduce that <span class="math inline">\(\lambda(t-1) = r(k - 1)\)</span>. To see this, focus on treatment 1. This treatment occurs in <span class="math inline">\(r\)</span> blocks, and in each of these blocks, it occurs together with <span class="math inline">\(k-1\)</span> other treatments. But also, treatment 1 occurs <span class="math inline">\(\lambda\)</span> times with each of the other <span class="math inline">\(t-1\)</span> treatments. Hence <span class="math inline">\(\lambda(t-1) = r(k - 1)\)</span>, or <span class="math inline">\(\lambda = r(k - 1) / (t-1)\)</span>.</p></li>
</ol>
</div>
<p>The design in Example <a href="blocking.html#exm:blocks-tyres">3.2</a> is a BIBD with <span class="math inline">\(b=4\)</span>, <span class="math inline">\(k=3\)</span>, <span class="math inline">\(t = 4\)</span>, <span class="math inline">\(r = 4\times 3 / 4 = 3\)</span>, <span class="math inline">\(\lambda = 3 \times (3-1) / (4-1) = 2\)</span>.</p>
<div id="construction-of-bibds" class="section level3">
<h3><span class="header-section-number">3.6.1</span> Construction of BIBDs</h3>
<p>BIBDs do not exist for all combinations of values of <span class="math inline">\(t\)</span>, <span class="math inline">\(k\)</span> and <span class="math inline">\(b\)</span>. In particular, we must ensure</p>
<ul>
<li><span class="math inline">\(r=bk/t\)</span> is integer, and</li>
<li><span class="math inline">\(\lambda = r(k - 1) / (t-1)\)</span> is integer.</li>
</ul>
<p>In general, we can always construct a BIBD for <span class="math inline">\(t\)</span> treatments in <span class="math inline">\(b = {t \choose k}\)</span> blocks of size <span class="math inline">\(k\)</span>, although it may not be the smallest possible BIBD. Each of the possible choices of <span class="math inline">\(k\)</span> treatments from the total <span class="math inline">\(t\)</span> forms one block. Such a design will have <span class="math inline">\(r = {t-1 \choose k-1}\)</span> and <span class="math inline">\(\lambda = {t-2 \choose k-2}\)</span>. The design in Example <a href="blocking.html#exm:blocks-tyres">3.2</a> was constructed this way, with <span class="math inline">\(b = 4\)</span>, <span class="math inline">\(r = 3\)</span> and <span class="math inline">\(\lambda = 2\)</span>.</p>
<p>Sometimes, smaller BIBDs that satisfy the two conditions above can be constructed. Finding these designs is an combinatorial problem, and tables of designs are available in the literature<a href="#fn23" class="footnote-ref" id="fnref23"><sup>23</sup></a>. A large collection of BIBDs has also been catalogued in the <code>R</code> package <code>ibd</code>. The function <code>bibd</code> generates BIBDs for given values of <span class="math inline">\(t\)</span>, <span class="math inline">\(b\)</span>, <span class="math inline">\(r\)</span>, <span class="math inline">\(k\)</span> and <span class="math inline">\(\lambda\)</span>, or returns a message that a design is not available for those values. We can use the function to find the design used in Example <a href="blocking.html#exm:blocks-tyres">3.2</a>.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="blocking.html#cb74-1"></a>tyre.bibd &lt;-<span class="st"> </span>ibd<span class="op">::</span><span class="kw">bibd</span>(<span class="dt">v =</span> <span class="dv">4</span>, <span class="dt">b =</span> <span class="dv">4</span>, <span class="dt">r =</span> <span class="dv">3</span>, <span class="dt">k =</span> <span class="dv">3</span>, <span class="dt">lambda =</span> <span class="dv">2</span>) <span class="co"># note, v is the notation for the number of treatments</span></span>
<span id="cb74-2"><a href="blocking.html#cb74-2"></a>tyre.bibd<span class="op">$</span>N <span class="co"># incidence matrix</span></span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    0    1    1    1
## [2,]    1    0    1    1
## [3,]    1    1    0    1
## [4,]    1    1    1    0</code></pre>
<p>We can also use the package to find a design for bigger experiments, for example <span class="math inline">\(t=8\)</span> treatments in <span class="math inline">\(b=14\)</span> blocks of size <span class="math inline">\(k=4\)</span>. Here, <span class="math inline">\(r = 14\times 4 / 8 = 7\)</span> and <span class="math inline">\(\lambda = 7 \times 3 / 7 = 3\)</span>.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="blocking.html#cb76-1"></a>larger.bibd &lt;-<span class="st"> </span>ibd<span class="op">::</span><span class="kw">bibd</span>(<span class="dt">v =</span> <span class="dv">8</span>, <span class="dt">b =</span> <span class="dv">14</span>, <span class="dt">r =</span> <span class="dv">7</span>, <span class="dt">k =</span> <span class="dv">4</span>, <span class="dt">lambda =</span> <span class="dv">3</span>) </span>
<span id="cb76-2"><a href="blocking.html#cb76-2"></a>larger.bibd<span class="op">$</span>N</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13] [,14]
## [1,]    0    0    1    1    0    0    0    1    1     1     0     1     0     1
## [2,]    1    0    0    0    0    0    1    0    0     1     1     1     1     1
## [3,]    0    0    0    1    0    1    1    1    1     0     1     0     1     0
## [4,]    1    0    1    1    1    1    0    0    0     0     0     0     1     1
## [5,]    0    1    0    0    1    1    0    0    1     0     1     1     0     1
## [6,]    0    1    1    0    1    0    1    0    1     1     0     0     1     0
## [7,]    1    1    0    1    1    0    0    1    0     1     1     0     0     0
## [8,]    1    1    1    0    0    1    1    1    0     0     0     1     0     0</code></pre>
<p>Although larger than the examples we have considered before, this design is small compared to the design that would be obtained from the naive construction above with <span class="math inline">\(b = {t \choose k} = {8 \choose 4} = 70\)</span> blocks.</p>
</div>
<div id="reduced-normal-equations" class="section level3">
<h3><span class="header-section-number">3.6.2</span> Reduced normal equations</h3>
<p>It can be shown that the reduced normal equations <a href="blocking.html#eq:block-rne">(3.7)</a> for a BIBD can be written as</p>
<p><span class="math display" id="eq:blocks-bibd-rne">\[\begin{equation}
\left(I_t - \frac{1}{t}J_t\right)\hat{\boldsymbol{\tau}} = \frac{k}{\lambda t}\left(X_2^{\mathrm{T}}\boldsymbol{y}- \frac{1}{k}NX_1^{\mathrm{T}}\right)\boldsymbol{y}\,.
\tag{3.13}
\end{equation}\]</span></p>
<p>Equation <a href="blocking.html#eq:blocks-bibd-rne">(3.13)</a> defines a series of <span class="math inline">\(t\)</span> equations of the form</p>
<p><span class="math display">\[\begin{align*}
\hat{\tau_j} - \hat{\tau}_w &amp; = \frac{k}{\lambda t}\left(\sum_{i = 1}^b n_{ij}y_{ij} - \frac{1}{k}\sum_{i=1}^bn_{ij}\sum_{j=1}^tn_{ij}y_{ij}\right) \\
&amp; = \frac{k}{\lambda t} q_j\,,
\end{align*}\]</span></p>
<p>with <span class="math inline">\(q_j = \sum_{i = 1}^b n_{ij}y_{ij} - \frac{1}{k}\sum_{i=1}^bn_{ij}\sum_{j=1}^tn_{ij}y_{ij}\)</span>.</p>
<p>Notice that unlike for the RCBD, the reduced normal equations for a BIBD do not correspond to the equations for a CRD. Although the first term in <span class="math inline">\(q_i\)</span> is the sum of the responses for the <span class="math inline">\(j\)</span>th treatment (mirroring the CRD), the second term is no longer the overall sum (or average) of the responses. In fact, for <span class="math inline">\(q_j\)</span> this second term is an adjusted total, just involving observations from those blocks that contain treatment <span class="math inline">\(j\)</span>.</p>
</div>
<div id="estimation-and-inference" class="section level3">
<h3><span class="header-section-number">3.6.3</span> Estimation and inference</h3>
<p>As with the CRD and RCD we can estimate contrasts in the <span class="math inline">\(\tau_i\)</span>, with estimator</p>
<p><span class="math display">\[
\widehat{\boldsymbol{c}^{\mathrm{T}}\boldsymbol{\tau}} = \frac{k}{\lambda t}\sum_{j=1}^tc_jq_j\,.
\]</span>
Due to the form of the reduced normal equations for the BIBD, the estimator is no longer just a linear combination of the treatment means; <span class="math inline">\(q_j\)</span> includes a term that adjusts for the blocks in which treatment <span class="math inline">\(j\)</span> has occurred.</p>
<p>The simplest way to derive the variance of this estimator is to rewrite it in the form</p>
<p><span class="math display">\[
\widehat{\boldsymbol{c}^{\mathrm{T}}\boldsymbol{\tau}} = \frac{k}{\lambda t}\boldsymbol{c}^{\mathrm{T}}\boldsymbol{q}\,, 
\]</span>
with <span class="math inline">\(\boldsymbol{q} = \left(X_2^{\mathrm{T}}\boldsymbol{y}- \frac{1}{k}NX_1^{\mathrm{T}}\right)\boldsymbol{y}\)</span>. Then</p>
<p><span class="math display">\[
\mathrm{var}\left(\widehat{\boldsymbol{c}^{\mathrm{T}}\boldsymbol{\tau}}\right) = \frac{k^2}{\lambda^2t^2}\boldsymbol{c}^{\mathrm{T}}\mathrm{var}(\boldsymbol{q}) \boldsymbol{c}\,.
\]</span>
Recalling that <span class="math inline">\(NN^{\mathrm{T}}\)</span> is the treatment coincidence matrix, the variance-covariance matrix of <span class="math inline">\(\boldsymbol{q}\)</span> is given by</p>
<p><span class="math display">\[\begin{align*}
\mathrm{var}(\boldsymbol{q}) &amp; = \left(X_2^{\mathrm{T}} - \frac{1}{k}NX_1^{\mathrm{T}}\right)\left(X_2 - \frac{1}{k}X_1N\right)\sigma^2 \\
&amp; = \sigma^2\left\{rI_t - \frac{1}{k}NN^{\mathrm{T}}\right\} \\
&amp; = \sigma^2\left\{rI_t - \frac{1}{k}\left[(r-\lambda)I_t + \lambda J_t\right]\right\} \\
&amp; = \sigma^2\left\{\left(\frac{r(k-1) + \lambda}{k}\right)I_t - \frac{\lambda}{k}J_t\right\} \\
&amp; = \sigma^2\left\{\left(\frac{\lambda(t-1) + \lambda}{k}\right)I_t - \frac{\lambda}{k}J_t\right\} \\
&amp; = \sigma^2\left\{\frac{\lambda t}{k}I_t - \frac{\lambda}{k}J_t\right\}\,.
\end{align*}\]</span></p>
<p>Hence</p>
<p><span class="math display">\[\begin{align*}
\mathrm{var}\left(\widehat{\boldsymbol{c}^{\mathrm{T}}\boldsymbol{\tau}}\right)
&amp; = \frac{k^2}{\lambda^2t^2}\boldsymbol{c}^{\mathrm{T}}\left(\frac{\lambda t}{k}I_t - \frac{\lambda}{k}J_t\right)\boldsymbol{c}\sigma^2 \\
&amp; = \frac{k\sigma^2}{\lambda t}\boldsymbol{c}^{\mathrm{T}}\boldsymbol{c} \\
&amp; = \frac{k\sigma^2}{\lambda t}\sum_{j=1}^tc_i^2\,,
\end{align*}\]</span></p>
<p>as <span class="math inline">\(\boldsymbol{c}^{\mathrm{T}}J_t = \boldsymbol{0}\)</span> as <span class="math inline">\(\sum_{j=1}^tc_j = 0\)</span>. The estimator is also unbiased (<span class="math inline">\(E(\widehat{\boldsymbol{c}^{\mathrm{T}}\boldsymbol{\tau}}) = \boldsymbol{c}^{\mathrm{T}}\boldsymbol{\tau}\)</span>), and hence the sampling distribution, upon which inference can be based, is given by</p>
<p><span class="math display" id="eq:exercises-rcbd-model">\[
\widehat{\boldsymbol{c}^{\mathrm{T}}\boldsymbol{\tau}} \sim N\left(\boldsymbol{c}^{\mathrm{T}}\boldsymbol{\tau}, \frac{k\sigma^2}{\lambda t}\sum_{j=1}^t c_j^2\right)\,.
\]</span></p>
<p>Returning to Example <a href="blocking.html#exm:blocks-tyres">3.2</a>, we can use these results to estimate all pairwise differences between the four treatments. Firstly, we directly calculate the <span class="math inline">\(q_j\)</span> from treatment and block sums, using the incidence matrix.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="blocking.html#cb78-1"></a>trtsum &lt;-<span class="st"> </span><span class="kw">aggregate</span>(wear <span class="op">~</span><span class="st"> </span>compound, <span class="dt">data =</span> tyre, <span class="dt">FUN =</span> sum)[, <span class="dv">2</span>]</span>
<span id="cb78-2"><a href="blocking.html#cb78-2"></a>blocksum &lt;-<span class="st"> </span><span class="kw">aggregate</span>(wear <span class="op">~</span><span class="st"> </span>block, <span class="dt">data =</span> tyre, <span class="dt">FUN =</span> sum)[, <span class="dv">2</span>]</span>
<span id="cb78-3"><a href="blocking.html#cb78-3"></a>q &lt;-<span class="st"> </span>trtsum <span class="op">-</span><span class="st"> </span>N <span class="op">%*%</span><span class="st"> </span>blocksum <span class="op">/</span><span class="st"> </span><span class="dv">3</span></span>
<span id="cb78-4"><a href="blocking.html#cb78-4"></a>C &lt;-<span class="st"> </span><span class="kw">matrix</span>(</span>
<span id="cb78-5"><a href="blocking.html#cb78-5"></a>  <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">-1</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb78-6"><a href="blocking.html#cb78-6"></a>    <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">-1</span>, <span class="dv">0</span>,</span>
<span id="cb78-7"><a href="blocking.html#cb78-7"></a>    <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">-1</span>,</span>
<span id="cb78-8"><a href="blocking.html#cb78-8"></a>    <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">-1</span>, <span class="dv">0</span>,</span>
<span id="cb78-9"><a href="blocking.html#cb78-9"></a>    <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">-1</span>,</span>
<span id="cb78-10"><a href="blocking.html#cb78-10"></a>    <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">-1</span>),</span>
<span id="cb78-11"><a href="blocking.html#cb78-11"></a>  <span class="dt">ncol =</span> <span class="dv">4</span>, <span class="dt">byrow =</span> T</span>
<span id="cb78-12"><a href="blocking.html#cb78-12"></a>)</span>
<span id="cb78-13"><a href="blocking.html#cb78-13"></a>k &lt;-<span class="st"> </span><span class="dv">3</span>; lambda &lt;-<span class="st"> </span><span class="dv">2</span>; t &lt;-<span class="st"> </span><span class="dv">4</span></span>
<span id="cb78-14"><a href="blocking.html#cb78-14"></a>pe &lt;-<span class="st"> </span>k <span class="op">*</span><span class="st"> </span>C <span class="op">%*%</span><span class="st"> </span>q <span class="op">/</span><span class="st"> </span>(lambda <span class="op">*</span><span class="st"> </span>t) <span class="co"># point estimates</span></span>
<span id="cb78-15"><a href="blocking.html#cb78-15"></a>se &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>k <span class="op">*</span><span class="st"> </span>tyre.s2 <span class="op">/</span><span class="st"> </span>(lambda <span class="op">*</span><span class="st"> </span>t)) <span class="co"># st error (same for each contrast)</span></span>
<span id="cb78-16"><a href="blocking.html#cb78-16"></a>t.ratio &lt;-<span class="st"> </span>pe <span class="op">/</span><span class="st"> </span>se</span>
<span id="cb78-17"><a href="blocking.html#cb78-17"></a>p.value &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">ptukey</span>(<span class="kw">abs</span>(t.ratio) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">2</span>), <span class="dv">4</span>, <span class="dv">5</span>)</span>
<span id="cb78-18"><a href="blocking.html#cb78-18"></a><span class="kw">data.frame</span>(<span class="dt">Pair =</span> <span class="kw">c</span>(<span class="st">&#39;1v2&#39;</span>, <span class="st">&#39;1v3&#39;</span>, <span class="st">&#39;1v4&#39;</span>, <span class="st">&#39;2v3&#39;</span>, <span class="st">&#39;2v4&#39;</span>, <span class="st">&#39;3v4&#39;</span>),</span>
<span id="cb78-19"><a href="blocking.html#cb78-19"></a>  <span class="dt">Estimate =</span> pe, <span class="dt">St.err =</span> se, <span class="dt">t.ratio =</span> t.ratio, </span>
<span id="cb78-20"><a href="blocking.html#cb78-20"></a>           <span class="dt">p.value =</span> p.value, <span class="dt">reject =</span> p.value <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>)</span></code></pre></div>
<pre><code>##   Pair Estimate St.err t.ratio  p.value reject
## 1  1v2   -4.375  16.21  -0.270 0.992273  FALSE
## 2  1v3  -76.250  16.21  -4.705 0.019509   TRUE
## 3  1v4 -100.875  16.21  -6.225 0.005912   TRUE
## 4  2v3  -71.875  16.21  -4.435 0.024757   TRUE
## 5  2v4  -96.500  16.21  -5.955 0.007188   TRUE
## 6  3v4  -24.625  16.21  -1.519 0.491534  FALSE</code></pre>
<p>Secondly, we can use <code>emmeans</code> to generate the same output from an <code>lm</code> object.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="blocking.html#cb80-1"></a>tyre.emm &lt;-<span class="st"> </span>emmeans<span class="op">::</span><span class="kw">emmeans</span>(tyre.lm, <span class="op">~</span><span class="st"> </span>compound)</span>
<span id="cb80-2"><a href="blocking.html#cb80-2"></a><span class="kw">pairs</span>(tyre.emm)</span></code></pre></div>
<pre><code>##  contrast estimate   SE df t.ratio p.value
##  1 - 2       -4.37 16.2  5  -0.270  0.9923
##  1 - 3      -76.25 16.2  5  -4.705  0.0195
##  1 - 4     -100.87 16.2  5  -6.225  0.0059
##  2 - 3      -71.88 16.2  5  -4.435  0.0248
##  2 - 4      -96.50 16.2  5  -5.955  0.0072
##  3 - 4      -24.62 16.2  5  -1.519  0.4915
## 
## Results are averaged over the levels of: block 
## P value adjustment: tukey method for comparing a family of 4 estimates</code></pre>
<p>For this experiment, treatments 1 and 3, 1 and 4, 2 and 3, and 2 and 4 are significantly different at an experiment-wise type I error rate of 5%.</p>
</div>
</div>
<div id="exercises-2" class="section level2">
<h2><span class="header-section-number">3.7</span> Exercises</h2>
<ol style="list-style-type: decimal">
<li><p>Consider the below randomised complete block design for comparing two catalysts, <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>, for a chemical reaction using six batches of material. The response is the yield (%) from the reaction.</p>
<table>
<thead>
<tr class="header">
<th align="left">Catalyst</th>
<th align="center">Batch 1</th>
<th align="center">Batch 2</th>
<th align="center">Batch 3</th>
<th align="center">Batch 4</th>
<th align="center">Batch 5</th>
<th align="center">Batch 6</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">A</td>
<td align="center">9</td>
<td align="center">19</td>
<td align="center">28</td>
<td align="center">22</td>
<td align="center">18</td>
<td align="center">8</td>
</tr>
<tr class="even">
<td align="left">B</td>
<td align="center">10</td>
<td align="center">22</td>
<td align="center">30</td>
<td align="center">21</td>
<td align="center">23</td>
<td align="center">12</td>
</tr>
</tbody>
</table>
<ol style="list-style-type: lower-roman">
<li>Write down a unit-block-treatment model for this example.</li>
<li>Test if there is a significant difference between catalysts at the 5% level.</li>
<li>Fit a unit-treatment model ignoring blocks and test again for a difference between catalysts. Comment on difference between this analysis and the one including blocks.</li>
</ol></li>
</ol>
<details>
<p><summary><b>Solution</b></summary>
i. The unit-block-treatment model for this RCBD is given by</p>
<pre><code>\begin{equation}</code></pre>
<p>y_{ij} = + _i + <em>j + </em>{ij},i = 1, , 6; j = , ,,
\tag{3.14}
\end{equation}</p>
<pre><code>where $y_{ij}$ is the yield from the application of catalyst $j$ to block $i$, $\mu$ is a constant parameter, $\beta_i$ is the effect of block $i$ and $\tau_j$ is the effect of treatment $j$. The errors follow a normal distribution $\varepsilon_{ij}\sim N(0, \sigma^2)$ with mean 0 and constant variance, and are assumed independent for different experimental units.</code></pre>
<ol style="list-style-type: lower-roman">
<li><p>To test if there is a difference between catalysts, we compare model <a href="blocking.html#eq:exercises-rcbd-model">(3.14)</a> with the model that only includes block effects:</p>
<p><span class="math display" id="eq:exercises-rcbd-model-block">\[\begin{equation}
y_{ij} = \mu + \beta_i + \varepsilon_{ij}\,\qquad i = 1, \ldots, 6; j = \mathrm{A}, \mathrm{B}\,.
\tag{3.15}
 \end{equation}\]</span></p>
<p>The relative difference in the residual mean squares between these two models follows an F distribution under <span class="math inline">\(H_0: \tau_1 = \tau_2 = 0\)</span>, see Section <a href="blocking.html#block-anova">3.3</a>. These test statistic and associated p-value can be calculated in <code>R</code> using <code>anova</code>.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="blocking.html#cb84-1"></a>reaction &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb84-2"><a href="blocking.html#cb84-2"></a>  <span class="dt">catalyst =</span> <span class="kw">factor</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&#39;A&#39;</span>, <span class="st">&#39;B&#39;</span>), <span class="dv">6</span>)),</span>
<span id="cb84-3"><a href="blocking.html#cb84-3"></a>  <span class="dt">batch =</span> <span class="kw">factor</span>(<span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="kw">rep</span>(<span class="dv">2</span>, <span class="dv">6</span>))),</span>
<span id="cb84-4"><a href="blocking.html#cb84-4"></a>  <span class="dt">yield =</span> <span class="kw">c</span>(<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">19</span>, <span class="dv">22</span>, <span class="dv">28</span>, <span class="dv">30</span>, <span class="dv">22</span>, <span class="dv">21</span>, <span class="dv">18</span>, <span class="dv">23</span>, <span class="dv">8</span>, <span class="dv">12</span>)</span>
<span id="cb84-5"><a href="blocking.html#cb84-5"></a>)</span>
<span id="cb84-6"><a href="blocking.html#cb84-6"></a>reaction.lm &lt;-<span class="st"> </span><span class="kw">lm</span>(yield <span class="op">~</span><span class="st"> </span>batch <span class="op">+</span><span class="st"> </span>catalyst, <span class="dt">data =</span> reaction)</span>
<span id="cb84-7"><a href="blocking.html#cb84-7"></a><span class="kw">anova</span>(reaction.lm)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: yield
##           Df Sum Sq Mean Sq F value  Pr(&gt;F)    
## batch      5    561   112.2    48.1 0.00031 ***
## catalyst   1     16    16.3     7.0 0.04566 *  
## Residuals  5     12     2.3                    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The p-value is (just) less than 0.05, and so we can reject <span class="math inline">\(H_0\)</span> (no treatment difference) at the 5% level.</p></li>
<li><p>The unit-treatment model is given by</p>
<p><span class="math display">\[
y_{ij} = \mu + \tau_j + \varepsilon_{ij}\,,\qquad i = 1,\ldots, 6; j = 1,2\,,
 \]</span></p>
<p>where now <strong>all</strong> the between unit differences, including any block-to-block differences, are modelled by the unit errors <span class="math inline">\(\varepsilon_{ij}\)</span>. We can fit this model in <code>R</code>.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="blocking.html#cb86-1"></a>reaction2.lm &lt;-<span class="st"> </span><span class="kw">lm</span>(yield <span class="op">~</span><span class="st"> </span>catalyst, <span class="dt">data =</span> reaction)</span>
<span id="cb86-2"><a href="blocking.html#cb86-2"></a><span class="kw">anova</span>(reaction2.lm)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: yield
##           Df Sum Sq Mean Sq F value Pr(&gt;F)
## catalyst   1     16    16.3    0.29    0.6
## Residuals 10    573    57.3</code></pre>
<p>There is no longer evidence to reject the null hypothesis of no treatment difference. This is because the residual mean square is now so much larger (57.2667 versus 2.3333). The residual mean square is also an unbiased estimate of <span class="math inline">\(\sigma^2\)</span>, and our estimate of <span class="math inline">\(\sigma^2\)</span> from the unit-treatment model is clearly much larger, as block-to-block variation has also been included.</p></li>
</ol>
</details>
<ol start="2" style="list-style-type: decimal">
<li><p>Consider the data below obtained from an agricultural experiment in which six different fertilizers were given to a crop of blackcurrants in a field. The field was divided into four equal areas of land so that the land in each area was fairly homogeneous. Each area of land was further subdivided into six plots and one of the fertilizers, chosen by a random procedure, was applied to each plot. The yields of blackcurrants obtained from each plot were recorded (in lbs) and are given in Table <a href="blocking.html#tab:blackcurrent-data">3.3</a>. In this randomised block design the treatments are the six fertilizers and the blocks are the four areas of land.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="blocking.html#cb88-1"></a>blackcurrent &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">fertilizer =</span> <span class="kw">rep</span>(<span class="kw">factor</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>), <span class="dv">4</span>),</span>
<span id="cb88-2"><a href="blocking.html#cb88-2"></a>               <span class="dt">block =</span> <span class="kw">rep</span>(<span class="kw">factor</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>), <span class="kw">rep</span>(<span class="dv">6</span>, <span class="dv">4</span>)), </span>
<span id="cb88-3"><a href="blocking.html#cb88-3"></a>               <span class="dt">yield =</span> <span class="kw">c</span>(<span class="fl">14.5</span>, <span class="fl">13.5</span>, <span class="fl">11.5</span>, <span class="fl">13.0</span>, <span class="fl">15.0</span>, <span class="fl">12.5</span>,</span>
<span id="cb88-4"><a href="blocking.html#cb88-4"></a>                            <span class="fl">12.0</span>, <span class="fl">10.0</span>, <span class="fl">11.0</span>, <span class="fl">13.0</span>, <span class="fl">12.0</span>, <span class="fl">13.5</span>,</span>
<span id="cb88-5"><a href="blocking.html#cb88-5"></a>                            <span class="fl">9.0</span>, <span class="fl">9.0</span>, <span class="fl">14.0</span>, <span class="fl">13.5</span>, <span class="fl">8.0</span>, <span class="fl">14.0</span>,</span>
<span id="cb88-6"><a href="blocking.html#cb88-6"></a>                            <span class="fl">6.5</span>, <span class="fl">8.5</span>, <span class="fl">10.0</span>, <span class="fl">7.5</span>, <span class="fl">7.0</span>, <span class="fl">8.0</span>)</span>
<span id="cb88-7"><a href="blocking.html#cb88-7"></a>)</span>
<span id="cb88-8"><a href="blocking.html#cb88-8"></a>knitr<span class="op">::</span><span class="kw">kable</span>(</span>
<span id="cb88-9"><a href="blocking.html#cb88-9"></a> tidyr<span class="op">::</span><span class="kw">pivot_wider</span>(blackcurrent, <span class="dt">names_from =</span> fertilizer, <span class="dt">values_from =</span> yield),</span>
<span id="cb88-10"><a href="blocking.html#cb88-10"></a> <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Block&quot;</span>, <span class="kw">paste</span>(<span class="st">&quot;Ferilizer&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>)),</span>
<span id="cb88-11"><a href="blocking.html#cb88-11"></a> <span class="dt">caption =</span> <span class="st">&quot;Blackcurrent experiment: yield (lbs) from six different fertilizers.&quot;</span></span>
<span id="cb88-12"><a href="blocking.html#cb88-12"></a>)</span></code></pre></div>
<table>
<caption><span id="tab:blackcurrent-data">Table 3.3: </span>Blackcurrent experiment: yield (lbs) from six different fertilizers.</caption>
<thead>
<tr class="header">
<th align="left">Block</th>
<th align="right">Ferilizer 1</th>
<th align="right">Ferilizer 2</th>
<th align="right">Ferilizer 3</th>
<th align="right">Ferilizer 4</th>
<th align="right">Ferilizer 5</th>
<th align="right">Ferilizer 6</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">14.5</td>
<td align="right">13.5</td>
<td align="right">11.5</td>
<td align="right">13.0</td>
<td align="right">15</td>
<td align="right">12.5</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">12.0</td>
<td align="right">10.0</td>
<td align="right">11.0</td>
<td align="right">13.0</td>
<td align="right">12</td>
<td align="right">13.5</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">9.0</td>
<td align="right">9.0</td>
<td align="right">14.0</td>
<td align="right">13.5</td>
<td align="right">8</td>
<td align="right">14.0</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="right">6.5</td>
<td align="right">8.5</td>
<td align="right">10.0</td>
<td align="right">7.5</td>
<td align="right">7</td>
<td align="right">8.0</td>
</tr>
</tbody>
</table>
<p>Conduct a full analysis of this experiment, including</p>
<ol style="list-style-type: lower-alpha">
<li>exploratory data analysis;</li>
<li>fitting an appropriate linear model, and conducting an F-test to compare a model that explains variation between the six fertilizers to the model only containing blocks;</li>
<li>Linear model diagnostics;</li>
<li>if appropriate, multiple comparisons of all pairwise differences between treatments.</li>
</ol></li>
<li><p>Prove that <span class="math inline">\(2k/\lambda t &gt; 2/b\)</span>, and use this result to compare the precision of a pairwise treatment comparison from a BIBD with block size <span class="math inline">\(k\)</span> and an RCBD, both with <span class="math inline">\(t\)</span> treatments in <span class="math inline">\(b\)</span> blocks.</p></li>
<li><p>Construct a BIBD for <span class="math inline">\(t=5\)</span> treatments in <span class="math inline">\(b=5\)</span> blocks of size <span class="math inline">\(k=4\)</span> units. What are <span class="math inline">\(r\)</span> and <span class="math inline">\(k\)</span> for your design? Compare your design to a RCBD via the efficiency for estimating a pairwise treatment difference.</p></li>
<li><p>Consider an experiment for testing the abrasion resistance of rubber-coated fabric. There are four types of material, denoted A - D. The response is the loss in weight in 0.1 milligrams (mg) over a standard period of time. The testing machine has four positions, so four samples of material can be tested at a time. Past experience suggests that there may be differences between these positions, and there may be differences between each application of the testing machine (due to changes in set-up). Therefore, we have two blocking variables, “Position” and “Application”. For this experiment, we use a <strong>latin square</strong> design, as follows.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="blocking.html#cb89-1"></a>fabric &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">material =</span> <span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&#39;C&#39;</span>, <span class="st">&#39;D&#39;</span>, <span class="st">&#39;B&#39;</span>, <span class="st">&#39;A&#39;</span>, <span class="st">&#39;A&#39;</span>, <span class="st">&#39;B&#39;</span>, <span class="st">&#39;D&#39;</span>, <span class="st">&#39;C&#39;</span>, </span>
<span id="cb89-2"><a href="blocking.html#cb89-2"></a>                           <span class="st">&#39;D&#39;</span>, <span class="st">&#39;C&#39;</span>, <span class="st">&#39;A&#39;</span>, <span class="st">&#39;B&#39;</span>, <span class="st">&#39;B&#39;</span>, <span class="st">&#39;A&#39;</span>, <span class="st">&#39;C&#39;</span>, <span class="st">&#39;D&#39;</span>)),</span>
<span id="cb89-3"><a href="blocking.html#cb89-3"></a>               <span class="dt">position =</span> <span class="kw">rep</span>(<span class="kw">factor</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>), <span class="dv">4</span>),</span>
<span id="cb89-4"><a href="blocking.html#cb89-4"></a>               <span class="dt">application =</span> <span class="kw">rep</span>(<span class="kw">factor</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>), <span class="kw">rep</span>(<span class="dv">4</span>, <span class="dv">4</span>)),</span>
<span id="cb89-5"><a href="blocking.html#cb89-5"></a>               <span class="dt">weight =</span> <span class="kw">c</span>(<span class="dv">235</span>, <span class="dv">236</span>, <span class="dv">218</span>, <span class="dv">268</span>,</span>
<span id="cb89-6"><a href="blocking.html#cb89-6"></a>                            <span class="dv">251</span>, <span class="dv">241</span>, <span class="dv">227</span>, <span class="dv">229</span>, </span>
<span id="cb89-7"><a href="blocking.html#cb89-7"></a>                            <span class="dv">234</span>, <span class="dv">273</span>, <span class="dv">274</span>, <span class="dv">226</span>,</span>
<span id="cb89-8"><a href="blocking.html#cb89-8"></a>                            <span class="dv">195</span>, <span class="dv">270</span>, <span class="dv">230</span>, <span class="dv">225</span>)</span>
<span id="cb89-9"><a href="blocking.html#cb89-9"></a>                 )</span>
<span id="cb89-10"><a href="blocking.html#cb89-10"></a>knitr<span class="op">::</span><span class="kw">kable</span>(</span>
<span id="cb89-11"><a href="blocking.html#cb89-11"></a> tidyr<span class="op">::</span><span class="kw">pivot_wider</span>(fabric, <span class="dt">id_cols =</span> application, <span class="dt">names_from =</span> position, </span>
<span id="cb89-12"><a href="blocking.html#cb89-12"></a>                <span class="dt">values_from =</span> material),</span>
<span id="cb89-13"><a href="blocking.html#cb89-13"></a> <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Application&quot;</span>, <span class="kw">paste</span>(<span class="st">&quot;Position&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Application</th>
<th align="left">Position 1</th>
<th align="left">Position 2</th>
<th align="left">Position 3</th>
<th align="left">Position 4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">C</td>
<td align="left">D</td>
<td align="left">B</td>
<td align="left">A</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">A</td>
<td align="left">B</td>
<td align="left">D</td>
<td align="left">C</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">D</td>
<td align="left">C</td>
<td align="left">A</td>
<td align="left">B</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="left">B</td>
<td align="left">A</td>
<td align="left">C</td>
<td align="left">D</td>
</tr>
</tbody>
</table>
<p>The blocking variables are represented as the rows and columns of the square; the latin letters represent the different treatments. A latin square of order <span class="math inline">\(k\)</span> is a <span class="math inline">\(k\times k\)</span> square of <span class="math inline">\(k\)</span> latin letters arranged so that each letter appears exactly once in each row and column (Sudoko squares are also examples of latin squares). To perform the experiment, the levels of the blocking factors are randomly assigned to the rows and the columns, and the different treatments to the letters.</p>
<p>A suitable unit-block-treatment model for a latin square design has the form</p>
<p><span class="math display">\[
 y_{ijk} = \mu + \beta_i + \gamma_j + \tau_k + \varepsilon_{ijk}\,,\qquad i,j,k = 1,\ldots, t\,,
 \]</span></p>
<p>with <span class="math inline">\(\mu\)</span> a constant parameter, <span class="math inline">\(\beta_i\)</span> row block effects, <span class="math inline">\(\gamma_j\)</span> column block effects and <span class="math inline">\(\tau_k\)</span> the treatment effects. As usual, <span class="math inline">\(\varepsilon_{ijk}\sim N(0, \sigma^2)\)</span>, with errors from different units assumed independent. Note that not all combinations of <span class="math inline">\(i,j,k\)</span> actually occur in the design; at the intersection of the <span class="math inline">\(i\)</span>th row and <span class="math inline">\(j\)</span>th column, only one of the <span class="math inline">\(t\)</span> treatments is applied.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Write down a set of normal equations for the model parameters.</p></li>
<li><p>It can be shown that the reduced normal equations for the treatment parameters <span class="math inline">\(\tau_1,\ldots, \tau_t\)</span> have the form
<span class="math display">\[
 \hat{\tau}_k - \hat{\tau}_w = \bar{y}_{..j} - \bar{y}_{...}\,,
 \]</span>
with <span class="math inline">\(\hat{\tau}_w = \frac{1}{t}\sum_{k=1}^t\hat{\tau}_k\)</span>, <span class="math inline">\(\bar{y}_{..k} = \frac{1}{t}\sum_{i=1}^t\sum_{j=1}^tn_{ijk}y_{ijk}\)</span> (mean for treatment <span class="math inline">\(k\)</span>) and <span class="math inline">\(\bar{y}_{...} = \frac{1}{n}\sum_{i=1}^t\sum_{j=1}^t\sum_{k=1}^tn_{ij}y_{ijk}\)</span> (overall mean) where <span class="math inline">\(n_{ijk} = 1\)</span> if treatment <span class="math inline">\(k\)</span> occurs at the intersection of row <span class="math inline">\(i\)</span> and column <span class="math inline">\(j\)</span> and zero otherwise, and <span class="math inline">\(\sum_{i=1}^t\sum_{j=1}^tn_{ijk} = t\)</span> for all <span class="math inline">\(k=1, \ldots, t\)</span>.</p>
<p>Demonstrate that any contrast can therefore be estimated from this design, and derive the variance of the estimator of <span class="math inline">\(\sum_{k=1}^tc_k\tau_k\)</span>.</p></li>
</ol>
<p>The data for this experiment is as follows, where the entries in the table give the response for the corresponding treatment:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="blocking.html#cb90-1"></a>knitr<span class="op">::</span><span class="kw">kable</span>(</span>
<span id="cb90-2"><a href="blocking.html#cb90-2"></a> tidyr<span class="op">::</span><span class="kw">pivot_wider</span>(fabric, <span class="dt">id_cols =</span> application, <span class="dt">names_from =</span> position, </span>
<span id="cb90-3"><a href="blocking.html#cb90-3"></a>                <span class="dt">values_from =</span> weight),</span>
<span id="cb90-4"><a href="blocking.html#cb90-4"></a> <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Application&quot;</span>, <span class="kw">paste</span>(<span class="st">&quot;Position&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Application</th>
<th align="right">Position 1</th>
<th align="right">Position 2</th>
<th align="right">Position 3</th>
<th align="right">Position 4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">235</td>
<td align="right">236</td>
<td align="right">218</td>
<td align="right">268</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">251</td>
<td align="right">241</td>
<td align="right">227</td>
<td align="right">229</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">234</td>
<td align="right">273</td>
<td align="right">274</td>
<td align="right">226</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="right">195</td>
<td align="right">270</td>
<td align="right">230</td>
<td align="right">225</td>
</tr>
</tbody>
</table>
<ol start="3" style="list-style-type: lower-alpha">
<li>For this data, test if there is a significant difference between materials. If there is, conduct multiple comparisons of all pairs at an experimentwise type I error rate of 5%.</li>
</ol></li>
</ol>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-CochranCox1957">
<p>Cochran, W. G. and Cox, G. M. (1957) <em>Experimental Designs</em>. 2nd ed. New York: John Wiley; Sons.</p>
</div>
<div id="ref-Davies1954">
<p>Davies, O. L. (ed.) (1954) <em>The Design and Analysis of Industrial Experiments</em>. London: Oliver and Boyd.</p>
</div>
<div id="ref-FisherYates1963">
<p>Fisher, R. A. and Yates, F. (1963) <em>Statistical Tables for Biological, Agricultural and Medical Research</em>. 6th ed. Edinburgh: Oliver and Boyd.</p>
</div>
<div id="ref-KSN2005">
<p>Kocaoz, S., Samaranayake, V. A. and Nani, A. (2005) Tensile characterization of glass FRP bars. <em>Composites: Part B</em>, <strong>36</strong>, 127–134.</p>
</div>
<div id="ref-Morris2011">
<p>Morris, M. D. (2011) <em>Design of Experiments: An Introduction Based on Linear Models</em>. Boca Raton: Chapman and Hall/CRC Press.</p>
</div>
<div id="ref-WH2009">
<p>Wu, C. F. J. and Hamada, M. (2009) <em>Experiments: Planning, Analysis, and Parameter Design Optimization</em>. 2nd ed. New York: Wiley.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="18">
<li id="fn18"><p>The four coatings were all made from Engineering Thermoplastic Polyurethane (ETPU); coating one was solely made from ETPU, coatings 2-4 had additional glass fibre, carbon fibre or aramid fibre added, respectively.<a href="blocking.html#fnref18" class="footnote-back">↩︎</a></p></li>
<li id="fn19"><p>This is our first example of (partial) confounding, which we will see again in Chapters <a href="block-factorial.html#block-factorial">5</a> and <a href="fractional-factorial.html#fractional-factorial">6</a><a href="blocking.html#fnref19" class="footnote-back">↩︎</a></p></li>
<li id="fn20"><p><code>R</code> and <code>anova</code> don’t, of course, know that this is a block design or that a blocking factor is being tested.<a href="blocking.html#fnref20" class="footnote-back">↩︎</a></p></li>
<li id="fn21"><p>These contrasts measure the difference between the coating only made from ETPU and the three coatings with added fibres.<a href="blocking.html#fnref21" class="footnote-back">↩︎</a></p></li>
<li id="fn22"><p>Of course, the CRD has seven more degrees of freedom for estimating <span class="math inline">\(\sigma^2\)</span> as block effects do not require estimation.<a href="blocking.html#fnref22" class="footnote-back">↩︎</a></p></li>
<li id="fn23"><p>See <span class="citation">Cochran and Cox (<a href="#ref-CochranCox1957" role="doc-biblioref">1957</a>)</span> and <span class="citation">Fisher and Yates (<a href="#ref-FisherYates1963" role="doc-biblioref">1963</a>)</span><a href="blocking.html#fnref23" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="crd.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="factorial.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown_math3014-6027.pdf", "bookdown_math3014-6027.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
