<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 1 Factorial experiments | 04-factorial.knit</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 1 Factorial experiments | 04-factorial.knit" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 1 Factorial experiments | 04-factorial.knit" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  


<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">MATH3014-6027</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path=""><a href="#factorial"><i class="fa fa-check"></i><b>1</b> Factorial experiments</a>
<ul>
<li class="chapter" data-level="1.1" data-path=""><a href="#factorial-contrasts"><i class="fa fa-check"></i><b>1.1</b> Factorial contrasts</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path=""><a href="#main-effects"><i class="fa fa-check"></i><b>1.1.1</b> Main effects</a></li>
<li class="chapter" data-level="1.1.2" data-path=""><a href="#interactions"><i class="fa fa-check"></i><b>1.1.2</b> Interactions</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:title:end-->
<!--bookdown:title:start-->
<div id="factorial" class="section level1" number="1">
<h1><span class="header-section-number">Chapter 1</span> Factorial experiments</h1>
<p>In Chapters <a href="#crd"><strong>??</strong></a> and <a href="#blocking"><strong>??</strong></a>, we assumed the objective of the experiment was to investigate <span class="math inline">\(t\)</span> <strong>unstructured</strong> treatments, defined only as a collection of distinct entities (drugs, advertisements, receipes, etc.). That is, there was not necessarily any explicit relationship between the treatments (although we could clearly choose which paticular comparisons between treatments were of interest via choice of contrast).</p>
<p>In many experiments, particularly in industry, engineering and the physical sciences, the treatments are actually defined via the choice of a <strong>level</strong> relating to each of a set of <strong>factors</strong>. We will focus on the commonly occurring case of factors at <strong>two levels</strong>. For example, consider the below experiment from the pharmaceutical industry.</p>
<div class="example">
<p><span id="exm:factorial-desilylation" class="example"><strong>Example 1.1  </strong></span>Desilylation experiment <span class="citation">[@Owen2001]</span></p>
<p>In this experiment, performed at GlaxoSmithKline, the aim was to optimise the desilylation<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> of an ether into an alcohol, which was a key step in the synthesis of a particular antibiotic. There were <span class="math inline">\(t=16\)</span> treatments, defined via the settings of four different factors, as given in Table <a href="#tab:factorial-desilylation-data">1.1</a>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>desilylation <span class="ot">&lt;-</span> FrF2<span class="sc">::</span><span class="fu">FrF2</span>(<span class="at">nruns =</span> <span class="dv">16</span>, <span class="at">nfactors =</span> <span class="dv">4</span>, <span class="at">randomize =</span> F,</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">factor.names =</span> <span class="fu">list</span>(<span class="at">temp =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>), <span class="at">time =</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">25</span>),</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">solvent =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">7</span>), <span class="at">reagent =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">1.33</span>)))</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>yield <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">82.93</span>, <span class="fl">94.04</span>, <span class="fl">88.07</span>, <span class="fl">93.97</span>, <span class="fl">77.21</span>, <span class="fl">92.99</span>, <span class="fl">83.60</span>, <span class="fl">94.38</span>, </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>           <span class="fl">88.68</span>, <span class="fl">94.30</span>, <span class="fl">93.00</span>, <span class="fl">93.42</span>, <span class="fl">84.86</span>, <span class="fl">94.26</span>, <span class="fl">88.71</span>, <span class="fl">94.66</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>desilylation <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(desilylation, <span class="at">yield =</span> yield)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(desilylation) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;Trt&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(desilylation, </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Temp (degrees C)&quot;</span>, <span class="st">&quot;Time (hours)&quot;</span>, <span class="st">&quot;Solvent (vol.)&quot;</span>, </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Reagent (equiv.)&quot;</span>, <span class="st">&quot;Yield (%)&quot;</span>),</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;Desilylation experiment: 16 treatments defined </span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="st">             by settings of four factors, with response (yield).&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:factorial-desilylation-data">Table 1.1: </span>Desilylation experiment: 16 treatments defined
by settings of four factors, with response (yield).</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">Temp (degrees C)</th>
<th align="left">Time (hours)</th>
<th align="left">Solvent (vol.)</th>
<th align="left">Reagent (equiv.)</th>
<th align="right">Yield (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Trt 1</td>
<td align="left">10</td>
<td align="left">19</td>
<td align="left">5</td>
<td align="left">1</td>
<td align="right">82.93</td>
</tr>
<tr class="even">
<td align="left">Trt 2</td>
<td align="left">20</td>
<td align="left">19</td>
<td align="left">5</td>
<td align="left">1</td>
<td align="right">94.04</td>
</tr>
<tr class="odd">
<td align="left">Trt 3</td>
<td align="left">10</td>
<td align="left">25</td>
<td align="left">5</td>
<td align="left">1</td>
<td align="right">88.07</td>
</tr>
<tr class="even">
<td align="left">Trt 4</td>
<td align="left">20</td>
<td align="left">25</td>
<td align="left">5</td>
<td align="left">1</td>
<td align="right">93.97</td>
</tr>
<tr class="odd">
<td align="left">Trt 5</td>
<td align="left">10</td>
<td align="left">19</td>
<td align="left">7</td>
<td align="left">1</td>
<td align="right">77.21</td>
</tr>
<tr class="even">
<td align="left">Trt 6</td>
<td align="left">20</td>
<td align="left">19</td>
<td align="left">7</td>
<td align="left">1</td>
<td align="right">92.99</td>
</tr>
<tr class="odd">
<td align="left">Trt 7</td>
<td align="left">10</td>
<td align="left">25</td>
<td align="left">7</td>
<td align="left">1</td>
<td align="right">83.60</td>
</tr>
<tr class="even">
<td align="left">Trt 8</td>
<td align="left">20</td>
<td align="left">25</td>
<td align="left">7</td>
<td align="left">1</td>
<td align="right">94.38</td>
</tr>
<tr class="odd">
<td align="left">Trt 9</td>
<td align="left">10</td>
<td align="left">19</td>
<td align="left">5</td>
<td align="left">1.33</td>
<td align="right">88.68</td>
</tr>
<tr class="even">
<td align="left">Trt 10</td>
<td align="left">20</td>
<td align="left">19</td>
<td align="left">5</td>
<td align="left">1.33</td>
<td align="right">94.30</td>
</tr>
<tr class="odd">
<td align="left">Trt 11</td>
<td align="left">10</td>
<td align="left">25</td>
<td align="left">5</td>
<td align="left">1.33</td>
<td align="right">93.00</td>
</tr>
<tr class="even">
<td align="left">Trt 12</td>
<td align="left">20</td>
<td align="left">25</td>
<td align="left">5</td>
<td align="left">1.33</td>
<td align="right">93.42</td>
</tr>
<tr class="odd">
<td align="left">Trt 13</td>
<td align="left">10</td>
<td align="left">19</td>
<td align="left">7</td>
<td align="left">1.33</td>
<td align="right">84.86</td>
</tr>
<tr class="even">
<td align="left">Trt 14</td>
<td align="left">20</td>
<td align="left">19</td>
<td align="left">7</td>
<td align="left">1.33</td>
<td align="right">94.26</td>
</tr>
<tr class="odd">
<td align="left">Trt 15</td>
<td align="left">10</td>
<td align="left">25</td>
<td align="left">7</td>
<td align="left">1.33</td>
<td align="right">88.71</td>
</tr>
<tr class="even">
<td align="left">Trt 16</td>
<td align="left">20</td>
<td align="left">25</td>
<td align="left">7</td>
<td align="left">1.33</td>
<td align="right">94.66</td>
</tr>
</tbody>
</table>
<p>Each treatment is defined by the choice of one of two levels for each of the four factors. In the <code>R</code> code above, we have used the function <code>FrF2</code> (from the package of the same name) to generate all <span class="math inline">\(t = 2^4 = 16\)</span> combinations of the two levels of these four factors. We come back to this function later in the chapter.</p>
</div>
<p>This <strong>factorial treatment structure</strong> lends itself to certain treatment contrasts being of natural interest.</p>
<div id="factorial-contrasts" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Factorial contrasts</h2>
<p>Throughout this chapter, we will assume there are no blocks or other restrictions on randomisation, and so we will assume a completely randomised design can be used. We start by assuming the same unit-treatment model as Chapter <a href="#crd"><strong>??</strong></a>:</p>
<p><span class="math display" id="eq:factorial-utm">\[\begin{equation}
y_{ij} = \mu + \tau_i + \varepsilon_{ij}\,, \quad i = 1, \ldots, t; j = 1, \ldots, n_i\,, \tag{1.1}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(y_{ij}\)</span> is the response from the <span class="math inline">\(j\)</span>th application of treatment <span class="math inline">\(i\)</span>, <span class="math inline">\(\mu\)</span> is a constant parameter, <span class="math inline">\(\tau_i\)</span> is the effect of the <span class="math inline">\(i\)</span>th treatment, and <span class="math inline">\(\varepsilon_{ij}\)</span> is the random individual effect from each experimental unit with <span class="math inline">\(\varepsilon_{ij} \sim N(0, \sigma^2)\)</span> independent of other errors.</p>
<p>Now, the number of treatments <span class="math inline">\(t = 2^f\)</span>, where <span class="math inline">\(f\)</span> equals the number of factors in the experiment.</p>
<p>For Example <a href="#exm:factorial-desilylation">1.1</a>, we have <span class="math inline">\(t = 2^4 = 16\)</span> and <span class="math inline">\(n_i = 1\)</span> for all <span class="math inline">\(i=1,\ldots, 16\)</span>; that is, each of the 16 treatments are replicated once. In general, we shall assume common treatment replication <span class="math inline">\(n_i = r \ge 1\)</span>.</p>
<p>If we fit model <a href="#eq:factorial-utm">(1.1)</a> and compute the ANOVA table, we notice a particular issue with this design.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>desilylation <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(desilylation, <span class="at">trt =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>desilylation.lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(yield <span class="sc">~</span> trt, <span class="at">data =</span> desilylation)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(desilylation.lm)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: yield
##           Df Sum Sq Mean Sq F value Pr(&gt;F)
## trt       15 427.28  28.486     NaN    NaN
## Residuals  0   0.00     NaN</code></pre>
<p>All available degrees of freedom are being used to estimate parameters in the mean (<span class="math inline">\(\mu\)</span> and the treatment effects <span class="math inline">\(\tau_i\)</span>). There are no degrees of freedom left to estimate <span class="math inline">\(\sigma^2\)</span>. This is due to a lack of treatment replication. Without replication in the design, model <a href="#eq:factorial-utm">(1.1)</a> is <strong>saturated</strong>, with as many treatments as there are observations and an unbiased estimate of <span class="math inline">\(\sigma^2\)</span> cannot be obtained. We will return to this issue later.</p>
<div id="main-effects" class="section level3" number="1.1.1">
<h3><span class="header-section-number">1.1.1</span> Main effects</h3>
<p>Studying Table <a href="#tab:factorial-desilylation-data">1.1</a>, there are some comparisons between treatments which are obviously of interest. For example, comparing the average effect from the first 8 treatments with the average effect of the second 8, using</p>
<p><span class="math display">\[
\boldsymbol{c}^{\mathrm{T}}\boldsymbol{\tau} = \sum_{i=1}^tc_i\tau_i\,,
\]</span>
with</p>
<p><span class="math display">\[
\boldsymbol{c}^{\mathrm{T}} = (-\boldsymbol{1}_8^{\mathrm{T}}, \boldsymbol{1}_8^{\mathrm{T}}) / 8\,.
\]</span></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>desilylation.emm <span class="ot">&lt;-</span> emmeans<span class="sc">::</span><span class="fu">emmeans</span>(desilylation.lm, <span class="sc">~</span> trt)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>reagent_me.emmc <span class="ot">&lt;-</span> <span class="cf">function</span>(levs) <span class="fu">data.frame</span>(<span class="st">&#39;reagent m.e.&#39;</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="fu">rep</span>(<span class="dv">8</span>, <span class="dv">2</span>)) <span class="sc">/</span> <span class="dv">8</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>emmeans<span class="sc">::</span><span class="fu">contrast</span>(desilylation.emm, <span class="st">&#39;reagent_me&#39;</span>)</span></code></pre></div>
<pre><code>##  contrast     estimate  SE df t.ratio p.value
##  reagent.m.e.     3.09 NaN  0     NaN     NaN</code></pre>
<p>This contrast compares the average treatment effect from the 8 treatments which have <code>reagent</code> set to its low level (1 equiv.) to the average effect from the 8 treatments which have <code>reagent</code> set to its high level. This is a “fair” comparison, as both of these sets of treatments have each of the combinations of the factors <code>temp</code>, <code>time</code> and <code>solvent</code> occuring equally often (twice here). Hence, the <strong>main effect</strong> of <code>reagent</code> is averaged over the levels of the other three factors.</p>
<p>As in Chapter <a href="#crd"><strong>??</strong></a>, we can estimate this treatment contrast by applying the same contrast coefficients to the treatment means,</p>
<p><span class="math display">\[
\widehat{\boldsymbol{c}^{\mathrm{T}}\boldsymbol{\tau}} = \sum_{i=1}^tc_i\bar{y}_{i.}\,,
\]</span>
where, for this experiment, each <span class="math inline">\(\bar{y}_{i.}\)</span> is the mean of a single observation (as there is no treatment replication). We see that inference about this contrast is not possible, as no standard error can be obtained.</p>
<div class="definition">
<p><span id="def:main-effect" class="definition"><strong>Definition 1.1  </strong></span>The <strong>main effect</strong> of a factor <span class="math inline">\(A\)</span> is defined as the difference in the average response from the high and low levels of the factor</p>
<p><span class="math display">\[
\mbox{ME}(A) = \bar{y}(A+) - \bar{y}(A-)\,,
\]</span>
where <span class="math inline">\(\bar{y}(A+)\)</span> is the average response when factor <span class="math inline">\(A\)</span> is set to its high level, averaged across all combinations of levels of the other factors (with <span class="math inline">\(\bar{y}(A+)\)</span> defined similarly for the low level of <span class="math inline">\(A\)</span>).</p>
</div>
<p>As we have averaged the response across the levels of the other factors, the intepretation of the main effect extends beyond this experiment. That is, we can use it to infer something about the system under study. Assuming model <a href="#eq:factorial-utm">(1.1)</a> is correct, any variation in the main effect can only come from random error in the observations. In fact,</p>
<p><span class="math display">\[\begin{align*}
\mbox{var}\{ME(A)\} &amp; = \frac{\sigma^2}{n/2} + \frac{\sigma^2}{n/2} \\
&amp; = \frac{4\sigma^2}{n}\,,
\end{align*}\]</span></p>
<p>and assuming <span class="math inline">\(r&gt;1\)</span>,</p>
<p><span class="math display" id="eq:factorial-sigma-hat-2">\[\begin{equation}
\hat{\sigma}^2 = \frac{1}{2^f(r-1)} \sum_{i=1}^{2^f}\sum_{j=1}^r(y_{ij} - \bar{y}_{i.})^2\,,
\tag{1.2}
\end{equation}\]</span></p>
<p>which is the residual mean square.</p>
<p>For Example <a href="#exm:factorial-desilylation">1.1</a>, we can also calculate main effect estimates for the other three factors by defining appropriate contrasts in the treatments.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>contrast.mat <span class="ot">&lt;-</span> FrF2<span class="sc">::</span><span class="fu">FrF2</span>(<span class="at">nruns =</span> <span class="dv">16</span>, <span class="at">nfactors =</span> <span class="dv">4</span>, <span class="at">randomize =</span> F, </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">factor.names =</span> <span class="fu">c</span>(<span class="st">&quot;temp&quot;</span>, <span class="st">&quot;time&quot;</span>, <span class="st">&quot;solvent&quot;</span>, <span class="st">&quot;reagent&quot;</span>))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>fac.contrasts.emmc <span class="ot">&lt;-</span> <span class="cf">function</span>(levs) </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate_all</span>(<span class="fu">data.frame</span>(contrast.mat), <span class="cf">function</span>(x) <span class="fu">scale</span>(<span class="fu">as.numeric</span>(<span class="fu">as.character</span>(x)), <span class="at">scale =</span> <span class="dv">8</span>))</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>main_effect_contrasts <span class="ot">&lt;-</span> <span class="fu">fac.contrasts.emmc</span>()</span></code></pre></div>
<pre><code>## Warning: replacing previous import &#39;lifecycle::last_warnings&#39; by
## &#39;rlang::last_warnings&#39; when loading &#39;pillar&#39;</code></pre>
<pre><code>## Warning: replacing previous import &#39;lifecycle::last_warnings&#39; by
## &#39;rlang::last_warnings&#39; when loading &#39;tibble&#39;</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(main_effect_contrasts) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;Trt&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(main_effect_contrasts, <span class="at">caption =</span> <span class="st">&#39;Desilylation experiment: main effect contrast coefficients&#39;</span>, <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Temperature&quot;</span>, <span class="st">&quot;Time&quot;</span>, <span class="st">&quot;Solvent&quot;</span>, <span class="st">&quot;Reagent&quot;</span>))</span></code></pre></div>
<table>
<caption><span id="tab:desilylation-all-me-contrasts">Table 1.2: </span>Desilylation experiment: main effect contrast coefficients</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Temperature</th>
<th align="right">Time</th>
<th align="right">Solvent</th>
<th align="right">Reagent</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Trt 1</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
</tr>
<tr class="even">
<td align="left">Trt 2</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
</tr>
<tr class="odd">
<td align="left">Trt 3</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
</tr>
<tr class="even">
<td align="left">Trt 4</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
</tr>
<tr class="odd">
<td align="left">Trt 5</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
</tr>
<tr class="even">
<td align="left">Trt 6</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
</tr>
<tr class="odd">
<td align="left">Trt 7</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
</tr>
<tr class="even">
<td align="left">Trt 8</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
</tr>
<tr class="odd">
<td align="left">Trt 9</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
</tr>
<tr class="even">
<td align="left">Trt 10</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
</tr>
<tr class="odd">
<td align="left">Trt 11</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
</tr>
<tr class="even">
<td align="left">Trt 12</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
</tr>
<tr class="odd">
<td align="left">Trt 13</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
</tr>
<tr class="even">
<td align="left">Trt 14</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
</tr>
<tr class="odd">
<td align="left">Trt 15</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
</tr>
<tr class="even">
<td align="left">Trt 16</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
</tr>
</tbody>
</table>
<p>Estimates can be obtained by applying these coefficients to the observed treatment means.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(<span class="fu">as.matrix</span>(main_effect_contrasts)) <span class="sc">%*%</span> yield</span></code></pre></div>
<pre><code>##            [,1]
## temp     8.1200
## time     2.5675
## solvent -2.2175
## reagent  3.0875</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>emmeans<span class="sc">::</span><span class="fu">contrast</span>(desilylation.emm, <span class="st">&#39;fac.contrasts&#39;</span>)</span></code></pre></div>
<pre><code>##  contrast estimate  SE df t.ratio p.value
##  temp         8.12 NaN  0     NaN     NaN
##  time         2.57 NaN  0     NaN     NaN
##  solvent     -2.22 NaN  0     NaN     NaN
##  reagent      3.09 NaN  0     NaN     NaN</code></pre>
<p>Main effects are often displayed graphically, using <strong>main effect plots</strong> which simply plot the average response for each factor level, joined by a line. The larger the main effect, the larger the slope of the line (or the bigger the difference between the averages). Figure <a href="#fig:desilylation-me-plots">1.1</a> presents the four main effect plots for Example <a href="#exm:factorial-desilylation">1.1</a>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">## calculate the means</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>temp_bar <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(yield <span class="sc">~</span> temp, <span class="at">data =</span> desilylation, <span class="at">FUN =</span> mean)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>time_bar <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(yield <span class="sc">~</span> time, <span class="at">data =</span> desilylation, <span class="at">FUN =</span> mean)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>solvent_bar <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(yield <span class="sc">~</span> solvent, <span class="at">data =</span> desilylation, <span class="at">FUN =</span> mean)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>reagent_bar <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(yield <span class="sc">~</span> reagent, <span class="at">data =</span> desilylation, <span class="at">FUN =</span> mean)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="do">## convert factors to numeric</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>fac_to_num <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(x))</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>temp_bar<span class="sc">$</span>temp <span class="ot">&lt;-</span> <span class="fu">fac_to_num</span>(temp_bar<span class="sc">$</span>temp)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>time_bar<span class="sc">$</span>time <span class="ot">&lt;-</span> <span class="fu">fac_to_num</span>(time_bar<span class="sc">$</span>time)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>solvent_bar<span class="sc">$</span>solvent <span class="ot">&lt;-</span> <span class="fu">fac_to_num</span>(solvent_bar<span class="sc">$</span>solvent)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>reagent_bar<span class="sc">$</span>reagent <span class="ot">&lt;-</span> <span class="fu">fac_to_num</span>(reagent_bar<span class="sc">$</span>reagent)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="do">## main effect plots</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>plotmin <span class="ot">&lt;-</span> <span class="fu">min</span>(temp_bar<span class="sc">$</span>yield, time_bar<span class="sc">$</span>yield, solvent_bar<span class="sc">$</span>yield, reagent_bar<span class="sc">$</span>yield)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>plotmax <span class="ot">&lt;-</span> <span class="fu">max</span>(temp_bar<span class="sc">$</span>yield, time_bar<span class="sc">$</span>yield, solvent_bar<span class="sc">$</span>yield, reagent_bar<span class="sc">$</span>yield)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex =</span> <span class="dv">2</span>)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>), <span class="at">respect =</span> T)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(temp_bar, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">type =</span> <span class="st">&quot;b&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(plotmin, plotmax))</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(time_bar, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">type =</span> <span class="st">&quot;b&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(plotmin, plotmax))</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(solvent_bar, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">type =</span> <span class="st">&quot;b&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(plotmin, plotmax))</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(reagent_bar, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">type =</span> <span class="st">&quot;b&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(plotmin, plotmax))</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:desilylation-me-plots"></span>
<img src="04-factorial_files/figure-html/desilylation-me-plots-1.png" alt="Desilylation experiment: main effect plots" width="672" />
<p class="caption">
Figure 1.1: Desilylation experiment: main effect plots
</p>
</div>
</div>
<div id="interactions" class="section level3" number="1.1.2">
<h3><span class="header-section-number">1.1.2</span> Interactions</h3>
<p>Another contrast that could be of interest in Example <a href="#exm:factorial-desilylation">1.1</a> has coefficients</p>
<p><span class="math display">\[
\boldsymbol{c}^{\mathrm{T}} = (\boldsymbol{1}_4^{\mathrm{T}}, -\boldsymbol{1}_8^{\mathrm{T}}, \boldsymbol{1}_4^{\mathrm{T}}) / 8\,.
\]</span>
This contrast measures the different between the average treatment effect from treatments 1-4, 13-16 and treatments 5-12. Checking back against Table <a href="#tab:factorial-desilylation-data">1.1</a>, we see this is comparing those treatments where <code>solvent</code> and <code>reagent</code> are both set to their low (1-4) or high (13-16) level against those treatments where one of the two factors is set high and the other is set low (5-12).</p>
<p>Focusing on <code>reagent</code>, if the effect of this factor on the response was independent of the level to which <code>solvent</code> has been set, you would expect this contrast to be zero - changing from the high to low level of <code>reagent</code> should affect the response in the same way, regardless of the setting of <code>solvent</code>. This argument can be reversed, focussing on the effect of <code>solvent</code>. Therefore, if this contrast is large, we say the two factors <strong>interact</strong>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>sol_reg_int.emmc <span class="ot">&lt;-</span> <span class="cf">function</span>(levels) </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="st">&#39;reagent x solvent&#39;</span> <span class="ot">=</span> .<span class="dv">125</span> <span class="sc">*</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">4</span>), <span class="fu">rep</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">8</span>), <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">4</span>)))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>emmeans<span class="sc">::</span><span class="fu">contrast</span>(desilylation.emm, <span class="st">&#39;sol_reg_int&#39;</span>)</span></code></pre></div>
<pre><code>##  contrast          estimate  SE df t.ratio p.value
##  reagent.x.solvent     0.49 NaN  0     NaN     NaN</code></pre>
<p>For Example <a href="#exm:factorial-desilylation">1.1</a>, this interaction contrast seems quite small, although of course without an estimate of the standard error we are still lacking a formal method to judge this.</p>
<p>It is somewhat more informative to consider the above interaction contrast as the average difference in two “sub-contrasts”</p>
<p><span class="math display">\[
\boldsymbol{c}^{\mathrm{T}}\boldsymbol{\tau} = \frac{1}{2}\left\{\frac{1}{4}\left(\tau_{13} + \tau_{14} + \tau_{15} + \tau_{16} - \tau_5 - \tau_6 - \tau_7 - \tau_8\right)
- \frac{1}{4}\left(\tau_9 + \tau_{10} + \tau_{11} + \tau_{12} - \tau_1 - \tau_2 - \tau_3 - \tau_4\right) \right\}\,,
\]</span>
The first component in the above expression is the effect of changing <code>reagent</code> from high to low <strong>given <code>solvent</code> is set to it’s high level</strong>. The second component the effect of changing <code>reagent</code> from high to low <strong>given <code>solvent</code> is set to it’s low level</strong>. This leads to our definition of a two-factor interaction.</p>
<div class="definition">
<p><span id="def:two-factor-interaction" class="definition"><strong>Definition 1.2  </strong></span>The <strong>two-factor interaction</strong> between factors <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> is defined as the average difference in main effect of factor <span class="math inline">\(A\)</span> when computed at the high and low levels of factor <span class="math inline">\(B\)</span>.</p>
<p><span class="math display">\[\begin{align*}
\mbox{Int}(A, B) &amp; = \frac{1}{2}\left\{\mbox{ME}(A\mid B+) - \mbox{ME}(A \mid B-)\right\} \\
&amp; = \frac{1}{2}\left\{\mbox{ME}(B \mid A+) - \mbox{ME}(B \mid A-)\right\} \\
&amp; = \frac{1}{2}\left\{\bar{y}(A+, B+) - \bar{y}(A-, B+) + \bar{y}(A+, B-) - \bar{y}(A-, B-)\right\}\,,
\end{align*}\]</span></p>
<p>where <span class="math inline">\(\bar{y}(A+, B-)\)</span> is the average response when factor <span class="math inline">\(A\)</span> is set to its high level and factor <span class="math inline">\(B\)</span> is set to its low level, averaged across all combinations of levels of the other factors, and other averages are defined similarly. The conditional main effects of factor <span class="math inline">\(A\)</span> when factor <span class="math inline">\(B\)</span> is set to its high level is defined as</p>
<p><span class="math display">\[
\mbox{ME}(A\mid B+) = \bar{y}(A+, B+) - \bar{y}(A-, B+)\,,
\]</span></p>
<p>with similar definitions for other conditional main effects.</p>
</div>
<p>As the sum of the squared contrast coefficients is the same for two-factor interactions as for main effects, the variance of the contrast estimator is also the same.</p>
<p><span class="math display">\[
\mbox{var}\left\{\mbox{Int}(A, B)\right\} = \frac{4\sigma^2}{n}\,.
\]</span>
For Example <a href="#exm:factorial-desilylation">1.1</a> we can calculate two-factor interactions for all <span class="math inline">\({4 \choose 2} = 6\)</span> pairs of factors. The simplest way to calculate the contrast coefficients is as the elementwise, or Hadamard, product<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> of the unscaled main effect contrasts (before dividing by <span class="math inline">\(n/2\)</span>).</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>fac.contrasts.int.emmc <span class="ot">&lt;-</span> <span class="cf">function</span>(levs) {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">sqrt</span>(<span class="dv">8</span>) <span class="sc">*</span> main_effect_contrasts, {</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="st">&#39;tem_x_tim&#39;</span> <span class="ot">=</span> temp <span class="sc">*</span> time,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>               <span class="st">&#39;tem_x_sol&#39;</span> <span class="ot">=</span> temp <span class="sc">*</span> solvent,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>               <span class="st">&#39;tem_x_rea&#39;</span> <span class="ot">=</span> temp <span class="sc">*</span> reagent,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>               <span class="st">&#39;tim_x_sol&#39;</span> <span class="ot">=</span> time <span class="sc">*</span> solvent,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>               <span class="st">&#39;tim_x_rea&#39;</span> <span class="ot">=</span> time <span class="sc">*</span> reagent,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>               <span class="st">&#39;sol_x_rea&#39;</span> <span class="ot">=</span> solvent <span class="sc">*</span> reagent)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>two_fi_contrasts <span class="ot">&lt;-</span> <span class="fu">fac.contrasts.int.emmc</span>()</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(two_fi_contrasts) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;Trt&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(two_fi_contrasts, <span class="at">caption =</span> <span class="st">&#39;Desilylation experiment: two-factor interaction contrast coefficients&#39;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:desilylation-2fi-interactions">Table 1.3: </span>Desilylation experiment: two-factor interaction contrast coefficients</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">tem_x_tim</th>
<th align="right">tem_x_sol</th>
<th align="right">tem_x_rea</th>
<th align="right">tim_x_sol</th>
<th align="right">tim_x_rea</th>
<th align="right">sol_x_rea</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Trt 1</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
</tr>
<tr class="even">
<td align="left">Trt 2</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
</tr>
<tr class="odd">
<td align="left">Trt 3</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
</tr>
<tr class="even">
<td align="left">Trt 4</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
</tr>
<tr class="odd">
<td align="left">Trt 5</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
</tr>
<tr class="even">
<td align="left">Trt 6</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
</tr>
<tr class="odd">
<td align="left">Trt 7</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
</tr>
<tr class="even">
<td align="left">Trt 8</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
</tr>
<tr class="odd">
<td align="left">Trt 9</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
</tr>
<tr class="even">
<td align="left">Trt 10</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
</tr>
<tr class="odd">
<td align="left">Trt 11</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
</tr>
<tr class="even">
<td align="left">Trt 12</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
</tr>
<tr class="odd">
<td align="left">Trt 13</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
</tr>
<tr class="even">
<td align="left">Trt 14</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
</tr>
<tr class="odd">
<td align="left">Trt 15</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
<td align="right">-0.125</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
</tr>
<tr class="even">
<td align="left">Trt 16</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
<td align="right">0.125</td>
</tr>
</tbody>
</table>
<p>Estimates of the interaction contrasts can again by found by considering the equivalent contrasts in the observed treatment means.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(<span class="fu">as.matrix</span>(two_fi_contrasts)) <span class="sc">%*%</span> yield</span></code></pre></div>
<pre><code>##              [,1]
## tem_x_tim -2.3575
## tem_x_sol  2.3575
## tem_x_rea -2.7725
## tim_x_sol  0.4400
## tim_x_rea -0.6450
## sol_x_rea  0.4900</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>emmeans<span class="sc">::</span><span class="fu">contrast</span>(desilylation.emm, <span class="st">&#39;fac.contrasts.int&#39;</span>)</span></code></pre></div>
<pre><code>##  contrast  estimate  SE df t.ratio p.value
##  tem_x_tim   -2.357 NaN  0     NaN     NaN
##  tem_x_sol    2.357 NaN  0     NaN     NaN
##  tem_x_rea   -2.772 NaN  0     NaN     NaN
##  tim_x_sol    0.440 NaN  0     NaN     NaN
##  tim_x_rea   -0.645 NaN  0     NaN     NaN
##  sol_x_rea    0.490 NaN  0     NaN     NaN</code></pre>
<p>As with main effects, interactions are often displayed graphically using <strong>interaction</strong> plots, plotting average responses for each pairwise combination of factors, joined by lines.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>plotmin <span class="ot">&lt;-</span> <span class="fu">min</span>(desilylation<span class="sc">$</span>yield)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>plotmax <span class="ot">&lt;-</span> <span class="fu">max</span>(desilylation<span class="sc">$</span>yield)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex =</span> <span class="dv">2</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>), <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>), <span class="at">respect =</span> T)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(desilylation, {</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">interaction.plot</span>(temp, time, yield, <span class="at">type =</span> <span class="st">&quot;b&quot;</span>, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">legend =</span> F, </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ylim =</span> <span class="fu">c</span>(plotmin, plotmax))</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Time = 19&quot;</span>, <span class="st">&quot;Time = 25&quot;</span>), <span class="at">lty =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">cex =</span> .<span class="dv">75</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">interaction.plot</span>(temp, solvent, yield, <span class="at">type =</span> <span class="st">&quot;b&quot;</span>, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">legend =</span> F, </span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ylim =</span> <span class="fu">c</span>(plotmin, plotmax))</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Solvent = 5&quot;</span>, <span class="st">&quot;Solvent = 7&quot;</span>), <span class="at">lty =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">cex =</span> .<span class="dv">75</span>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">interaction.plot</span>(temp, reagent, yield, <span class="at">type =</span> <span class="st">&quot;b&quot;</span>, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">legend =</span> F, </span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ylim =</span> <span class="fu">c</span>(plotmin, plotmax))</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Reagent = 1&quot;</span>, <span class="st">&quot;Reagent = 1.33&quot;</span>), <span class="at">lty =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">cex =</span> .<span class="dv">75</span>)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">interaction.plot</span>(time, solvent, yield, <span class="at">type =</span> <span class="st">&quot;b&quot;</span>, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">legend =</span> F, </span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ylim =</span> <span class="fu">c</span>(plotmin, plotmax))</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Solvent = 5&quot;</span>, <span class="st">&quot;Solvent = 7&quot;</span>), <span class="at">lty =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">cex =</span> .<span class="dv">75</span>)</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">interaction.plot</span>(time, reagent, yield, <span class="at">type =</span> <span class="st">&quot;b&quot;</span>, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">legend =</span> F, </span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ylim =</span> <span class="fu">c</span>(plotmin, plotmax))</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Reagent = 1&quot;</span>, <span class="st">&quot;Reagent = 1.33&quot;</span>), <span class="at">lty =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">cex =</span> .<span class="dv">75</span>)</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">interaction.plot</span>(solvent, reagent, yield, <span class="at">type =</span> <span class="st">&quot;b&quot;</span>, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">legend =</span> F, </span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ylim =</span> <span class="fu">c</span>(plotmin, plotmax))</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Reagent = 1&quot;</span>, <span class="st">&quot;Reagent = 1.33&quot;</span>), <span class="at">lty =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">cex =</span> .<span class="dv">75</span>)</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:desilylation-2fi-plots"></span>
<img src="04-factorial_files/figure-html/desilylation-2fi-plots-1.png" alt="Desilylation experiment: two-factor interaction plots" width="672" />
<p class="caption">
Figure 1.2: Desilylation experiment: two-factor interaction plots
</p>
</div>
<p>Parallel lines in an interaction plot indicate no (or very small) interaction (<code>time</code> and <code>solvent</code>, <code>time</code> and <code>reagent</code>, <code>solvent</code> and <code>reagent</code>). The three interactions with <code>temp</code> all demonstrate much more robust behaviour at the high level; changing <code>time</code>, <code>solvent</code> or <code>reagent</code> makes little difference to the response at the high level of <code>temp</code>, and much less difference than at the low level of <code>temp</code>.</p>
<p>If a system displays important interactions, the main effects of factors involved in those interactions should no longer be interpreted. For example, it makes little sense to discuss the main effect of <code>temp</code> when is changes so much with the level of <code>reagent</code> (from strongly positive when <code>reagent</code> is low to quite small when <code>reagent</code> is high).</p>
<p>Higher order interactions can be defined similarly, as average differences in lower-order effects. For example, a three-factor interaction measures how a two-factor interaction changes with the levels of a third factor.</p>
<p><span class="math display">\[\begin{align*}
\mbox{Int}(A, B, C) &amp; = \frac{1}{2}\left\{\mbox{Int}(A, B \mid C+) - \mbox{Int}(A, B \mid C-)\right\} \\
&amp; = \frac{1}{2}\left\{\mbox{Int}(A, C \mid B+) - \mbox{Int}(A, C \mid B-)\right\} \\
&amp; = \frac{1}{2}\left\{\mbox{Int}(B, C \mid A+) - \mbox{Int}(B, C \mid A-)\right\} \\
&amp; = \frac{1}{4}\left\{\bar{y}(A+, B+, C+) - \bar{y}(A-, B+, C+) + \bar{y}(A+, B-, C+) - \bar{y}(A-, B-, C+) - \bar{y}(A+, B+, C+) + \bar{y}(A-, B+, C+) - \bar{y}(A+, B-, C+) + \bar{y}(A-, B-, C+)\right\}
\end{align*}\]</span></p>
</div>
</div>
</div>







<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>Desilylation is a process of removing silyl, SiH<span class="math inline">\(_3\)</span> a silicon hydride, from a compound.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>For two matrices <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> of the same dimension <span class="math inline">\(m\times n\)</span>, the Hadamard product <span class="math inline">\(A\odot B\)</span> is a matrix of the same dimension with elements given by the elementwise product, <span class="math inline">\((A\odot B)_{ij} = A_{ij}B_{ij}\)</span>.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
},
"search": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
